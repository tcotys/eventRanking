<!DOCTYPE html>
<html>
  <head>
    <title>Event Ranking</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
    body {
  margin:0px;
}

header {
  display:block;
  position:fixed;
  background-color:lightgrey;
  padding-left:10px;
  top:0px;
  left:0px;
  width:220px;
  height:100%;
  overflow:hidden;
}
header h2, header h1{
  margin:0px;
  padding-right:10px;
  text-align:center;
}
header ol {
  padding-right:15px;
}

nav li {
    border-radius: 8px 0 0 8px;
    border: solid 2px lightgrey;
    border-right: solid 5px lightgrey;
    background-color:white;
    list-style-type: none;
    list-style-position: inside;
    padding-left: 10px;
    padding-top: 3px;
    padding-bottom: 2px;
    margin-left:20px;
}
nav ul {
    margin-top:10px;
    padding: 0px;
    list-style-position: inside;
    list-style-type: none;
}
nav a {
    color: black;
    text-decoration: none;
    display: inline-block;
    width: 100%;
}
nav ul.lineList {
  margin:auto;
  margin-left:10px;
}
nav li.selectedTab {
  border-right:none;
}
nav li:hover
{
  background-color:grey;
  border-right:none;
}
nav li.button {
  font-size:0%;
  border:none;
  margin:0px;
  background-color:transparent;
  display:inline-block;
  height:32px;
  width:32px;
  padding:0px;
  margin:4px;
}
nav li.button:hover {
  background-color:transparent;
  border-right:none;
  opacity: 0.4;
  filter: alpha(opacity=40); /* For IE8 and earlier */
}
nav li.new {
/*   background-image:url('images/new-32.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAABD9JREFUWIW1ls1uG1UUx3/n3hnbsWu7aaOEFDVFrWiEAuIB2LFmA2sehgWbPkKXvAEICXVRWLCg27aiqGnTJFYUpXGaNP6Kx56Ze1gkjmzPhx0q/tLojsf3nvO7555zZoT/SbpPmTo1DAWNGVChbQz96Xle2uKHDx8uhWEYzHJydHSUePbN139UV29tfnIKK6Yd1RA8lKh9UDhz3ePXBOGOWaI9mi/TBh4/fvx9pVL5QVULvu8DEIbh+a5Ucc6hqhPPnXM45/C9Q1te2PWrpSNb8E89v3gmqkNR9XQYFiNPjn+9e+fPn2DwwlQ5TETgwYMHVWPMj+vr63eiKEJVMcYkdimS4EZo49sAQxkrijUBQgeREFUfxWdvv/Bdu13frNVauHeDvlmiPQFQrVY9Y4zEcUyv10NV8X0f59yE4+kRwLdbGLeDsW8wdhcjHcQsAyXQPoYD6rW44BfMp2jpiJI7hvBZag6MO8i6nxz7WHOCZ9/h2SbWdhC7DnIbkSpoB3SPheJTa0XWMHYX/BXnwoVUgDSIPAAjHYx0MaaNkRZiVkDWEPs5yDKiTXCCsQdYad5UhjdE5To9ahMH3Gq1LhMsb/fTlzERxsQIMSIRSOl857KC2K9AloFrqJYE1SIqBcATSzERAVW9NDx+n3cUUAB8EO981ADogjbR+C/QJtBFJFBEBogOUSIcw1SA8WOYFYnzH3WQGqp1nNYx2kRd46LGr13A7OHiQ5xEx55171W0pWVamQBXS8QyyhJOl3F6QhyfYXmN6ilI6Twi2qQfFOKFQrznq9tHwrfG0E8ARFEEQLfbpVqt5kZjfHS6hpNTYr3otu4Q4RSRE1Q9kFXa3SA013a2FhaCNwThDqS04tG5VyoVrLWZVZDIA6njuI8goGXU3USkhWiMYhEWabfehtEgfrl4ffCPXLTjCYDxKrDW4pybgJgVCeUjYi2jsohyjGgHCFH1MPY6J52XwydPPn52/8ujtyOfmY0ordvNVxF1HF+g9BHpgA5QCsAiJ6dh+Nvvt9vw9NJmAiCO44lKmHY8G2CkMqplABQF8RJ2MwEmSmzKUVaU0l5Q8yiRA3maJxJ5a+M4zgcAJt73eS14Gmp0nweQdgSJl/2oDBuNxswdXeVKc54ZAYDV1dXMj5F5EjIrkWcCjM6pWCxe9oE8A9NQo98jjSKapcxGNG9Wz5OQWeFPAMyanOV01vM8u6lJ+CHKg0vTf4pAnq66PgEQhuFMI7MSa7ReVS+vuQD29/ctF8cyr5MP1TjA4qtXr9aCIChYa/F9H1WdKMPRmPdhkiURod/vF58/f34L6ABn4wAGKB4cHETb29u/PHr06FtjjCciyU40Q2klWC6Xz3q9nt9oNH5uNBo9oDgCGJ9dBG4A1Xv37n0GBHEcF68KkKaNjY2/Nzc3N7a2tl4ALeA94KYBxmUAm/P/VTW8sJVInH8Bv4YMp/gUaWUAAAAASUVORK5CYII=');
}
nav li.open {
/*   background-image:url('images/open-32.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAABUlJREFUWIXtl7+PG8cVxz8zO8vV2TpSAmTdBRDcCTaghjgXrmxDgCNAThmkEhAjSJAUUufKSKUAgtq4FZQigBOkkAsXhmDnL3BxiiM4CQIHF/kiM+Txjlxyyf0xOz9ScMkjebzTCTHgxg8Y7M57b9/3O++9md2F71jESbabN2/eCoKgKSoBJICUUiqlBCCVUkJKKYIgkFJKIYQQy7rpEEJI771rt9u/uHv3bgdAnUDAe+9/cufOnTeyLFs2MOGzeL/AvtIJIRZ8tre3h+12+1XgkMCtW7d+ZYx5TQhh5oMEQVAvioL19XXKslydphXgqySKIgCklF5rnU/16saNGz+6evXqB5ubm5ExZiHo9vY2zjnSNOXJkyeMRqNTE1jWN5tNhBAkSZILIYoZAedczzlXdLvdaDAYLDxUFAXee9I0XcjASSmfl83NTer1OgBpmiKEQGsda63H8wTiOI6LixcvMs0AgLWWjY0NjDGkaYr3HinlcxGI45jpohqNBmEYsrOzQ57nT2YElFKxtTaPomghyMHBAdevX+fg4ABjDHme470/FnQVgfmSKqXQWmOM2bl3794snaooirjX6+lms0kcx7OHx+MxjUaDVqtFnuckSXKqhlvlU6/XMcbQ7XYZjUafzdvUgwcPssuXL6fGGIpi0htFUXDp0iWGwyFZlpEkyTO321SmWZrqa7UaUkrSNOXx48etXq/38QKBarXdKj0A7O/vc+3aNXZ3dynLEmvtsaDz+316DcNwgVCapiRJQr/f/+L+/fv/PkJAa90JwxDvPd57kiQBYDQak5UOweKROSNwXEaEPULqq692xrs9fv/6z/+4MfX9/NI/u6pi2fLeo5QiTVO2trbodDr8rRvyjz1JqCT+CNSzxC/cjrKXpb3w6m/OVyrnvHh73PxIAVhrnw4GA7Iso91u02w22dvboztWvPPWFczzoPuVtwBr3vMKVNn0jj99+uicAsiy7Gm/33fGGKm1plarEYYhRkLp4CApFiIt7cZDIA++mvklo5/ZIQwEOsvLdGg/k5VbP03TLM9ztra2SJKEzEjOvrBGXjq8ZzZcFeRwPukbV42Zjwfv5p6p7GlhqCnJfzr9Tinsl9O3Yd9aO7LWvliv1yedWwrOnIkojZuxn1z8satbTLtfyJYHcm2xzlNTkm86o/5ffvfTf02bMB4Oh3mWZYRhiFKKpCgJwhqldbi5KCvBl8AWXKosFeUkjgokSZqjrfscDrdhPBwOdRAErK2tIYSgO0qJ1kO0cUfBVwAeJTYpR2k9xrqZXxRK/ttLijTXn0D1hXPlypU4z3PjnCPLMpRSdBOHClVVaz+rtZ+vM0t94CZ+xjm08eTaLoADBFLQbscta4tHMwK3b992WuvB9BzISo8hwM7AJ2CT4B5tHLp0FKUlLy1F6chLN7nqydxYt/LsMNbSS7Kn2/fe3Z2VoOqDrlKKhw8fMqaOfPlNrPVYNxnGTVb4/4gKBPEgw5Xmk5lujkAniiKCIKDwdc6vnyPJDXYJ1B87eaYaELT2B7uDLP30CAFjzDd5njMcZQzrm7wUnSEv3ZEQy51+KgKVoixLegfJ7l/v/+yLZQKy0+n0G40GHXuB9Qs/OAQ//mg9GdwvzADY3+uVSa/94bxuSmCt1Wo9PdvYKLjwRlR7sUGa6VPAnV6EEPT39v++/fGv/wysARkcvmUj4KUf/viXvzXnX3kTQmGtCb4NYIsal0RfG++Gj/7w3vuU6R7QBcw8AYAzwDnghcp49tsgUEnBpB4jIAZm6V31kTf9BTvpr+l5xQD2mV7fy3ch/wOaS3SBUd52ywAAAABJRU5ErkJggg==');
}
nav li.save {
/*   background-image:url('images/save-32.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADrUlEQVRYhb2XTYgcRRTHf1XTM7NJbzIokk2MKwiBbAwe/EIIeDAXJQdz8RJEIoh48OBFUA8K3iJR2CxGMSc9iZggYYMSjB/4ESRIYrK4sKvCRpFBxEFnsrv9Wc9Dd/X0THdvDpnJg6GrX8+r/7/+772uLnXguTffBw6LGEQMYgwSriG6yYAvG0uJz46l4Ccfk/riKPhw4ZuTzwKeo7Q+/PQT+2nUHQQBgXfnZjnz+jOMwj5aUURKM1FTAHiex+yxdw4BrwFtDdCoO8wePcKxo2+MBDRvf/zZBuDE8TlOHJ+j2WzaR7cCTQ0kK08tPx6Fra6uDzr60zuAcqzzhRdfylIA4Ox+YCQE5OxvAOx75LGkRoYW6NhBt7eGiMFI8odo6ceREDAmmU9EECmq60AiexCGmLRaYYQKfPpLnwBFElkKLLhlPCoFLGAZeEYgkceMR4EzS30iQoUCjFEBW3Ql4AMExqbA/GI6v1R3gYiMTYFMAAs+JML4FZCfUx5F8D6Bm9AFtgZKizBpkTEpwEJGZMMivHk1UFGEeQWcep1XTl5gz917ASFp4SQ4iU+vucLKv2iSnhf++e8aUzu2pzzS+OspEMcxDz28n513TqO1vqHFu7cl1ziO++TLukAQjDGEUUgcxYgIv69c7ectv8JcMVX5ivepipW7oUAQBBhjBiYWEaIoYu1aN2OflzJPLpPXguV8zYlNaF3beDcsA0fg8oXviaPohlLRaDQ4eOgprly6XPEiyskzLHscRZz6YA7X3Yzv+3Q6HTqdDvV6Hdd1mZycxHVdjDF4nofneWitOf3ZV5yaP8f0rj1sbbWo1Wobf5CUgVvJXHczAAeffD4LfPvIy2itUUqhlOrnXASlFHtndvHx6bMDYJJ10RCBKvCynE1N3wWAUgqtddYpyX5ismdKqUKslLTBQAoK4DIcDBObXIBs9faaJ1xJoGQz0NnkJeB5BYbVKAO/HoGyb4LsTXP7jm0F8IHP9eHAnAJA1kWV4CVzAGiJ44XzF5dobd3Czu1ThY6wZvObJ2B/wwW4UQ0UdsOVxfMH4vjBz8WYmX33zdBqbRlg+9MP39Lr9QjDkPfeepVut0utViMMQ3zfz1IQBAFBEGT3vu8XCNx/7z0Fn7P43Sd/rf779+Mij87/erW9Oztc2gOlewfLy8uFwPX19YIvb+12ciS7eOkKYoQvv/gaezj113rngAgQq1MduAXYBkySq40xWQR0gHY+UXVgIr2WV9HoTAAf8P4HNKuB/1Ce1moAAAAASUVORK5CYII=');
}
nav li.info {
/*   background-image:url('images/info-32.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAG9UlEQVRYhZ2XbYgdVxnHf+c5M3Pf9u7Nxiab3c0m2yR3a+mHJhYaBFFLWoRUiiv1Q02hQgtStBTrp6KCHzTWKhLBD0ULSRv84NKmRrBpSarSpijBhDRpXpp0Nbslu9nN3k32vr/NHD/M3Jm5ezcae+Cwd5Yz5/9//s//ec4ZxW2O/MMHJ8A8gKjtCr05l8tsAkWxVJ0xxswY3DNeu/7e1JtPHQLagHc7+6r/AboG+F42m3p2dPiO3PCGAbKZFPUWlGsuruuhBYzXZrlUo3CzzOJSsdhslF+qXDu5b/bErxcA91MRyO9+ZSKbTe/ffs9YbnRkHVevN5hbarFws921zgR/+1KKtA1JG24ul5hfLBTrpdlnpo48PQk0b6XIqgTyu189sG3L0BP379jKv+aaTM02aLVN1xoDoFT3BgqU8okkxGPxxhKl4txrl97Y8yRQWU2NHgL53a8e2Hlf/omR4Q2culRmueISh+4A3zeeARSnLpejbcLdFKIgJVCtFblZ+Pcbl/74+JNAcSUJfSvw42eLVBteD7hSiue+Mczzezby1c8PkE1r/n6hAqJAKRBBKf93C4VlJ7GczN3ZsV13FS68/hbQIsocEoG/MrFty1AI3mqbcJUBjFL+xsD4aCokNT6aAlGozlRBaoJnVyl0qp9kbuPXxh588ZtAJo4r4Ls9m03vv3/HVk5dKveAh7lWgCjmlpohgbmlFirIvQ8qiA5+62gms2vJDN37Qm7sS3cCTlcKPjP+9ed37tj2lULZ4upiqwtcheAqnKc+rjK90OTdsyVePrKIEokpoHxFlERpUf6z1rZjpdbrpY/+dBxoAMYCyGZTz24cWcexfy73RE4IHiihFOW6x5snlkOp/f/HSYbLuwxkp/tIDow9BvwSvyqqVv7hgxOjw3fkrl5v0HLNKrJHmz736BDjG5MRqWB8+zczYBSeMUEpEvollFoUCoOd7u/bvOsnj0y/88P9QN0CHhgeHGCm0IpWBxFEkfsbjm9M8rl8hpWjUvdQopDAhCp8J1rT8gzKgKgkidzoTmASKAnC9oE1fWGHM4CK13Uge73p8eODV9nzwlQPAW0JliXozrQ1lu3/tmyNZWu0JShLSDkJrPTaPJAGbEuhN5eq7up5R1FreFTrfj84P11HdG/z1JZECgRGXJkGA2AMjhK0nd4AJABt5XKZTZVa1Jw60rdcw3K5hWtAdFBaWiFaWDnEEiRGQDrV0CFh/LI2BmxtSKT7B/FLUVugaHteV/Tlqkux6iJahTUtIiFAjwIBQdH+OiUxBRRh3zOewXFMJwgNiFUsVWe0Mps60S8VW9SaJoxCVHdkt0qBBOqI9t+Jd0VffYPxIJMy1Gvlhc67lsHMKGU2oeD6jSaNlok6mRDmVILOJqspEBDoKKFEEIkpEMhvPEMi4WLajXn8Q8mzjHHP3FiufKFZ19Qanh9hzERRiyVQYBUPaOW7X0voh7AzEhFI24a226JVW5rCvyO4Ytz6e7PzRWxxY6BxcHrIrOYB3VWGguVobFtjOZ0pDGSFUrlJvXD5NH4rduXjPz91qFKtFjMJhQ42VyjiHU3FIloF3486iD6qfcFyJCSQSGjWZjXz18uVK0d/9DegCrQEaDfqxZfqjSr9qShvKmIQRX8LBTrmjKtgBdHbgRIbBjSFpTrF2XOHA/AK0BbAq1w7ta9aKRWzCYOtu1vpytl9wvgjLNMYCcuOSGT7NOtzcP5ioTLz172TwDJQAzwBmD2xb6FWuvpMvVEk6/jR9+AoePm7o5z8xdYeAke/P8iLj+aiNAXpsGxNMqnJD2k+PF/k2geHf1WdPzcL3Ag8EN5M3KkjT082qtdfw6uS0YETAiX8k/G/3uCD9b5HREBEsB3F3SOamekyF0+fO3bl7R8cAxaBEsHdML6rAH3jE78/YKc3TbgqS9tSgbF0dNjYkcl0aDYd5dwWLMci26cZH9JcmS5z/OjJY2d+++BeYA6YBcoE1/T4pdQA7cLFQ2+vzT90l7adz6IS0GnBOspzvDWLCEpLaETLEgZzipF+j9Mf3ODk+6ePnf3dQ3uBeeBaHHwlgQ6JVuHC629lBu/5JJHp/yJKO0o7aAnKNHYmxM+H/pSwLqsYWaMoLlV4/x/XKh+9+4efX5r81oEYeM+1/FaJ1UAmN/blO9ff+/h3nDVbHhOnr89JpEg5CRJJjZ3QOAkhnRKSCUXb9VguN5mfL1WKc+cOf/KXn01W5j+cDXJe4HY/TFZ4wgGywMDmXT99JLFmdKeVGshrJ70hme4fVCLUa5UF4zbmW7XCVH3x8ulYk1nGd3uJ//fTbBU1EkAK/06fDp4dohS6AUiDqMnUgudP93G6yhDAAuwAWBOVsRcAufhfPrf9ef4ftt9z+yX+fk8AAAAASUVORK5CYII=');
}
nav li.undo {
/*   background-image:url('images/undo-32.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAG9ElEQVR42r1Xe3BUZxX/3bt3n8nuZmFZ8oKWVggZqhmEKLZOsYXWRpry7sPiKKJTxzoVLagzOsUWHBynTPWPOrY+plVpRFLSQBsrMNLSOn1ASUKaJ+xustlN9v3e7O7dvft57t1LWzHF0JlwZs7ezPc6v/M7j+8Lh08oSze/uBwo2cBxy8GYjTGplzQ+0vHgKZqWSNlMzuGuyuiW9ts48N8go+t1Oq1Vq9XCoDeA0wjIZqcgSQx5UQSTxK5CLvb0xWM7TtK2wpXAcEta/9qTDnR/eeLdA1F18TTeti/neM1Tep129fx5NlisVRC0BpQgIJUtgpXoII4nKxzy+RzS6RSymRiKYubtfHJ8t+vVR96hY4rTAeGW3PMCY6XiQHigbUPM9Y/Ry0E0bjnyuCAIj123wAG73Y4pUYNALI9kpoCiVCLDxAlfVo2Gg1YQIAhacCWGTCqE7FQslYu7dzpf+W4bHZcnLV0GoI3V11RhfCI8TCBaY84uBUTj1o4qAvya1VzR1LB4IQrMAOdEBqmMpASOU5QjYzwEjQZEgCI8z6AhMPKYjljKphNIxP2YCg085Hr1+wdpSfajILiG9YfYxq80493uC/ASiNDAC62WBTfHTfbGE4651qbFn1qEiWgR3lCWPC5vEjQ8LJV6GHRahdUixV6SoISAJ8PgiG1OUoBoBT2yqSSiUW863N/eEjj3h/doU+5SOLiGDYfYprtvpgOKONtDICYjw7xGW5zvsC1bQsadk3kEY6KymtHPHIsBZpMWBTGLRCIKkZJOKpUUVnheAw0ZNFXOhd5oIoYkAkSZwukRDfuRjHnPDbZtuJuOCl8KNdew8TDbuG4VRjxTuL5ah+4+J0TyaNnSG+GaFBGKi6BwEsUcHDYjdHRgNBpCKpXIZCMjndHho11x9788cunZFrfU2JduWKe33bBVbzBX2uy1lKxyfpTAihwmfG5EnSd2jL++70Van5R94ho2tbP1LavwVl8cc6061M/TYionIpjk4SPayzzxqLWbUCrmEQhOIh0ZPel9c//T2ciFSZpNkKZIRTWsOgphbd0tjz5pstbfOs9BIHRyXggIB0OI+i++MXho8zZa55f3cNRQWOudn8fbA3GF4iqzjmjWYXAspXgua429gvzLU474EB89/ZTn9Sc6VRojqvG82nxkoSSAntS8bNuxgyZz9e3VtXXQaBlyVDkTvjG4/7nrlpTvTJ+8lwAcYevu/BzODCYUb0tkUVINy2qlZDPRZh8ZDztPycaPqOhDpBm1vqcTwdG0beH8ld/usdvrzRVmo0w4JryjCPZ3POx981eHZQe4pVs6WMuaZrw3klB2lT5iXBA0cFQZ4fV6EAtePHnhpe37aIlPBTB1eU1PB6Lx/sMPV8y54deVthqyz5BNhEC5+NyFjm/uoflJjuqd3fGlZvQ6E0pdXzIus2HQa1FJOuH3IZ0Muzyn9uzI+Htk6mIzMK7IdWv3VVfduGayao6cCzpk4mFEPGf+TAD20rSXALzEbl+9Ev3upAKAqSczFUSJaSBQAqUTfuSz8RH/2WfuiQx1uj6ubU8j/Ge+9drLFltti7HSojSmWNDV2/98ywM05+Ea7+1kq7+4Ap6AzCgnh0lhQCwwxNKS0nx0dOloKRziVACFfGLYf/b3rdRURmcKggDsr7A6fmKxUStPxhELuM6///xdX6MpNwE4yr7QfBM1Ew5Fcl3+5kSGOLVcSSqPUccvt176K5+NQMwnCcSzreH3D88IxKe3H7/PYHb8zV5Th0QkjKinu2Po71/9OU2Nco33HWXyTSZbUL68+lUs8kpYPvxyH6wrSbnhvj+tuVXNh8KVGTh1h94057ijrg7xcBhh9zt/GW7/+i9pakx+D1hIF5BaZxhTWeT0kGtf7gVBlHv7x0rTQ2+s1RmtJ6rr6xEY9yEw0LFn7MRjbUoS0o98oxjV79UIUz2Xb7filRY2feffa/UEwFE9H5M+H9zHf/pAdOiVtyCX4VUa/USy/HtnNhuM5vZKcyVCfm+w57erNtGwkzR0TQB89pHuvWaL9WcSlVRkvLtz8OC9+1QA8WsCYMXO80dNhorWrJiDq+tH24h++U0g36BT1wTAykf7x/SCfmEyfPF43x/vepyG3CjfJcVZB7DiB+cXcYLeJees++XdD0YGj/Wq3qehXE+z7f2uoR9yPH9ATPq6en932y9oaBTl0lUqZ9YBNP94pJecv37w4P1b075zXtV7+Rpnsw5g5a7+RbxgcCXcp3cOH9p+moYmUH7EfNA3ZhfA7qEnSmLKeO43zc+hHPMALuuaswagefdwFSsV9p49cNN+lJ9pcZSp/+9/TGaRAPlsA6kJ5Qfr/xifbQBQPZdVwoeP1msK4P/KfwB2AjGhIXKxdwAAAABJRU5ErkJggg==');
}
section {
  margin-left:230px;
  margin-top:45px;
}
section h1 {
  background-color:grey;
  margin:0px;
  padding:5px 0px 5px 5px;
  position:fixed;
  top:0px;
  z-index:2;
  color:white;
  width:100%;
  height:35px;
}
section article {
  padding-left:10px;
  padding-top:10px;
  overflow-x:auto;
}

section ul {
  list-style-type: none;
  margin:0px;
  padding:0px;
}
section li {
  margin-top:3px;
}
section li span {
  display: inline-block;
  width:400px;
  margin-right:3px;
  padding-left:5px;
  padding-right:5px;
  padding-top:2px;
  padding-bottom:3px;
  position:relative;
}
section li a {
  display:inline-block;
  background-color:grey;
  margin-right:3px;
  padding-left:5px;
  padding-right:5px;
  padding-top:2px;
  padding-bottom:3px;
}
section li a:hover {
  background-color:lightgrey;
} 
section .button {
  display:inline-block;
  height:16px;
  width:16px;
  font-size:0%;
  background-color:transparent;
  padding:0px;
  position:absolute;
}
section .button:hover {
  background-color:transparent;
  border-right:none;
  opacity: 0.4;
  filter: alpha(opacity=40); /* For IE8 and earlier */
}
section .moveup {
/*   background-image:url('images/arrow-up-16.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApElEQVQ4jc3RsQpBARSH8V83k8FskEEeQQbpTp7C6E1kkAwewSijhzDJaJJBkicwGMTilm7XdV0lp/7TOd93Oh3+vcqofCOYYpYXbuCKG1p5BMsHfMMKwSdw9wmO0ssKF3FIEJxQyiLoJ8BRRu/gKs4pggvqaYJ5Chxl8QoOY4M7DDHANtbrxOEAaxwxQTNhQQNj7LFBIX57KNuvA7RRyzD7g7oDSqo5eSqN/7gAAAAASUVORK5CYII=');
  right:62px;
}
/*.moveup:hover {
  background-image:url('images/arrow-up-16-white.png');
  background-color:transparent;
}*/
section .movedown {
/*   background-image:url('images/arrow-down-16.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jcXSMWpCQRRG4Y9olcLaQiwkna1YCFq5ipTZiVgESeESLCWli7ASy1TBQoxYp7CwkKRwHsTH+HxRxB8uAzP3HO4ww71TCGsNdXzh5wzzgHbo+042i/jAEm9oRMAmhlhjHkRH6QZrUp/o4xWL1Fnn1HiTVGOs3rPu94RdBrxFNUsAgwxB7xwMJWwi8AqPeQTwEhE854U5PNHsDzz9D5ykFeC9+L/IlTFGl8JQQfkawe3zC/XOPR1kYs0YAAAAAElFTkSuQmCC');
  right:42px;
}
/*.movedown:hover {
  background-image:url('images/arrow-down-16-white.png');
  background-color:transparent;
}*/
section .edit {
/*   background-image:url('images/edit4-16.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAlpJREFUeNqEk01IVFEUx//3fczHG7NxGmfCMQl1GkKrhblKglbVpnCbEBm1GFftChSESHDRpk0lobWR2rZpIYioGUNBQoiMBmIxUun4pnG+evPevNt5vrGxTOfC4XIv9/f/n3vOvYxzjmqDMYaJDjmqZPQeB8M52lqieNIZ54+YJWCq7w8U2Hp5fSyWQm/o8yYijRfAQs348moUqfXkHamauxDr6/e21vd21HYBbR9hxJchrXEcO+q3BKJ7BISntyuLM3I/BPcDtHTDr7TAcKr4kctBezuHptVvEBgiwr7WpyQbDneDe1rA1EnI2gpcfhmrDQFMBOpQMDH7f4F2gkVlFzwFZBaAUgb+72k0OTlYqw9KrWNsbw3aLGeCTxCslOH0PGBqwDJFHggHJTRo4nPPB+3FXxkI01EbjlwluBksNU0t+FSBc3SohpCCOeiRXDe3mR3YnIwOQ/TYsJV2ahbILlLaBYKLBNN78dDxvDmIlHn/j6muzmNlvG9Yklx3cfIKeI0Fz9iwkS07m4AiknNpAD8rsDWk+ZEbblF29kE8BO4+TvAcFWwHLtiwuwxv8aF/SyYVNO18qP2SI3E4gMbYKFDvBBw6PVaC85S200qb4OxeeFsgV9QuHgmflRWvDwnaaFwaJwE3OTKaYRVsgO4/tO9L1Ux+S/EGhVx8BK7sayQiPXQF6pXEkM/qDw+C7Rr86nSfXngDaXPV3EgWjKT6rDSzoRp1DvHxZV/gXtWfeq27y8irX3lQ3ljLafzdetqMTS0WY7oBKgK0XUG9hF6eS/SLDUvgtwADABpUBfyzD66iAAAAAElFTkSuQmCC');
  right:22px;
}
section .delete {
/*   background-image:url('images/delete-16.png'); */
  background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGeYUxB9wAAACBjSFJNAAB6JQAAgIMAAPn/AACA6AAAUggAARVYAAA6lwAAF2/XWh+QAAADFklEQVR42qSRS2icVRxHz//e+30z40zSNI1NJ5M0aWpj0hCToEiRqAhWS5G2ii7ERVdioSC4E7pyI5SutIsufCJaFIoQRLJQKVpKwaRYA1XTF01MWpukdJLM8/vuw0VF3HvgtzmrHxw5uWPHrvGDBz7u6u3uvvDRJ58uXr3xjktTnEBOQQZIAOcDOE+kVfuD/f3vbhvY9dyN8xdOm7GXDn0zvm/vw/HaXdSzE8fOrZWL1/+8fURpxX+xzpPRes/A2OiHW4eHB27PL8xvNGqXTDYTt6ryKmZ9hd5NJiru6Xvj+2b5qemVxhNBSTkA1ntVatt0Zmxs7FBZqdr01NTRtNH8IADyXrFILjJvPTby0LGhgt2il25SWy7z81+N1Ys1P5QTBoeiaLJUKrVfrtWn55ZuTeTiOMm3tlKrrCOndvZTW1nFJE3aI94fKegjHd5FSdMzV3eVnCNXMEbPeP/ZPesOiyiiOCaXz1OrrKNEBBMZspmYlVr65tnlxs5za+7XtbqjZEMh57z+yboTd7w/jNYEQAARQQCTpgn1pEnTWoxSVIW7SRoi5z0uQFYLmxXPLHuFDQBCYi3NahV8QD/eqNNMU3wIaOgZ9H5ut/O9VRFmjf62JSP94wXVvZBKx5plSgSch6a1JB5UCAFECNA54Nxsv/NbrBYuRerLRSUv/JjKy+tZ7V7cHh9VwiMuQOD+kwAouZ9ZDTg/0xdCm4mFP4y6eQt5NQaanskzd+xrsRZ5ssNMhuAxEv6dkgBF5z4fCr47m9WsRNr+7uV5HcAFMEDDhq++nm8e3503fdti9br84w2ggndbh9rbXikUYsgJM5YTqedKCGA9BAJZBUsN//Yv99Iro3lzXAhoQANqc6FwoO/pCdM22Iu0xCFj5FRPTtGVVXRmFaLAC0QaZjfsfnHhgU6tDuZFKIigqkm6mB0doWP/Xih1+Yb19dQHEh+wIRADERADAa7/VncnuxTDPRp6NOhHrb2WeLevZXtP8YezF08vlCtf1FNPNfVUUo8SRaQEEUGL0IDvanC+AmEDkBAC/4e/BwACT2zMWyQBIAAAAABJRU5ErkJggg==');
  right:2px;
}
section input.numeric {
  width:60px;
}

section input.twodigits {
  width:30px;
}

section td {
    background-color: white;
    padding: 2px;
    padding-left: 5px;
    padding-right: 5px;
}
section table {
    background-color: grey;
    margin-top:10px;
    margin-left:10px;
}


section ul.lineList {
  margin:auto;
  margin-left:0px;
  background-color:grey;
  width:auto;
  padding-left:30px;
  
}
section ul.lineList li {
  display:inline-block;
  color:white;
  background-color:dimgrey;
  padding:5px;
  padding-left:10px;
  padding-right:10px;
  margin-top:0px;
/*   margin-left:2px; */
  margin-right:1px;
/*   border:1px black solid; */
/*   border-bottom:none; */
  border-radius:10px 10px 0px 0px;
}
section ul.lineList li:hover {
  color:black;
  background-color:white;
}
section ul.lineList li.selectedTab {
  color:black;
  background-color:white;
}
section article.noTopMargin {
  margin-top:0px;
  padding-top:0px;
  padding-left:0px;
}
    </style>
  </head>
  
  <body>
    <script type="text/javascript">
    /* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.1.20151003
 *
 * By Eli Grey, http://eligrey.com
 * License: MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */

/*global self */
/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

var saveAs = saveAs || (function(view) {
  "use strict";
  // IE <10 is explicitly unsupported
  if (typeof navigator !== "undefined" && /MSIE [1-9]\./.test(navigator.userAgent)) {
    return;
  }
  var
      doc = view.document
      // only get URL when necessary in case Blob.js hasn't overridden it yet
    , get_URL = function() {
      return view.URL || view.webkitURL || view;
    }
    , save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a")
    , can_use_save_link = "download" in save_link
    , click = function(node) {
      var event = new MouseEvent("click");
      node.dispatchEvent(event);
    }
    , is_safari = /Version\/[\d\.]+.*Safari/.test(navigator.userAgent)
    , webkit_req_fs = view.webkitRequestFileSystem
    , req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem
    , throw_outside = function(ex) {
      (view.setImmediate || view.setTimeout)(function() {
        throw ex;
      }, 0);
    }
    , force_saveable_type = "application/octet-stream"
    , fs_min_size = 0
    // See https://code.google.com/p/chromium/issues/detail?id=375297#c7 and
    // https://github.com/eligrey/FileSaver.js/commit/485930a#commitcomment-8768047
    // for the reasoning behind the timeout and revocation flow
    , arbitrary_revoke_timeout = 500 // in ms
    , revoke = function(file) {
      var revoker = function() {
        if (typeof file === "string") { // file is an object URL
          get_URL().revokeObjectURL(file);
        } else { // file is a File
          file.remove();
        }
      };
      if (view.chrome) {
        revoker();
      } else {
        setTimeout(revoker, arbitrary_revoke_timeout);
      }
    }
    , dispatch = function(filesaver, event_types, event) {
      event_types = [].concat(event_types);
      var i = event_types.length;
      while (i--) {
        var listener = filesaver["on" + event_types[i]];
        if (typeof listener === "function") {
          try {
            listener.call(filesaver, event || filesaver);
          } catch (ex) {
            throw_outside(ex);
          }
        }
      }
    }
    , auto_bom = function(blob) {
      // prepend BOM for UTF-8 XML and text/* types (including HTML)
      if (/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
        return new Blob(["\ufeff", blob], {type: blob.type});
      }
      return blob;
    }
    , FileSaver = function(blob, name, no_auto_bom) {
      if (!no_auto_bom) {
        blob = auto_bom(blob);
      }
      // First try a.download, then web filesystem, then object URLs
      var
          filesaver = this
        , type = blob.type
        , blob_changed = false
        , object_url
        , target_view
        , dispatch_all = function() {
          dispatch(filesaver, "writestart progress write writeend".split(" "));
        }
        // on any filesys errors revert to saving with object URLs
        , fs_error = function() {
          if (target_view && is_safari && typeof FileReader !== "undefined") {
            // Safari doesn't allow downloading of blob urls
            var reader = new FileReader();
            reader.onloadend = function() {
              var base64Data = reader.result;
              target_view.location.href = "data:attachment/file" + base64Data.slice(base64Data.search(/[,;]/));
              filesaver.readyState = filesaver.DONE;
              dispatch_all();
            };
            reader.readAsDataURL(blob);
            filesaver.readyState = filesaver.INIT;
            return;
          }
          // don't create more object URLs than needed
          if (blob_changed || !object_url) {
            object_url = get_URL().createObjectURL(blob);
          }
          if (target_view) {
            target_view.location.href = object_url;
          } else {
            var new_tab = view.open(object_url, "_blank");
            if (new_tab == undefined && is_safari) {
              //Apple do not allow window.open, see http://bit.ly/1kZffRI
              view.location.href = object_url
            }
          }
          filesaver.readyState = filesaver.DONE;
          dispatch_all();
          revoke(object_url);
        }
        , abortable = function(func) {
          return function() {
            if (filesaver.readyState !== filesaver.DONE) {
              return func.apply(this, arguments);
            }
          };
        }
        , create_if_not_found = {create: true, exclusive: false}
        , slice
      ;
      filesaver.readyState = filesaver.INIT;
      if (!name) {
        name = "download";
      }
      if (can_use_save_link) {
        object_url = get_URL().createObjectURL(blob);
        setTimeout(function() {
          save_link.href = object_url;
          save_link.download = name;
          click(save_link);
          dispatch_all();
          revoke(object_url);
          filesaver.readyState = filesaver.DONE;
        });
        return;
      }
      // Object and web filesystem URLs have a problem saving in Google Chrome when
      // viewed in a tab, so I force save with application/octet-stream
      // http://code.google.com/p/chromium/issues/detail?id=91158
      // Update: Google errantly closed 91158, I submitted it again:
      // https://code.google.com/p/chromium/issues/detail?id=389642
      if (view.chrome && type && type !== force_saveable_type) {
        slice = blob.slice || blob.webkitSlice;
        blob = slice.call(blob, 0, blob.size, force_saveable_type);
        blob_changed = true;
      }
      // Since I can't be sure that the guessed media type will trigger a download
      // in WebKit, I append .download to the filename.
      // https://bugs.webkit.org/show_bug.cgi?id=65440
      if (webkit_req_fs && name !== "download") {
        name += ".download";
      }
      if (type === force_saveable_type || webkit_req_fs) {
        target_view = view;
      }
      if (!req_fs) {
        fs_error();
        return;
      }
      fs_min_size += blob.size;
      req_fs(view.TEMPORARY, fs_min_size, abortable(function(fs) {
        fs.root.getDirectory("saved", create_if_not_found, abortable(function(dir) {
          var save = function() {
            dir.getFile(name, create_if_not_found, abortable(function(file) {
              file.createWriter(abortable(function(writer) {
                writer.onwriteend = function(event) {
                  target_view.location.href = file.toURL();
                  filesaver.readyState = filesaver.DONE;
                  dispatch(filesaver, "writeend", event);
                  revoke(file);
                };
                writer.onerror = function() {
                  var error = writer.error;
                  if (error.code !== error.ABORT_ERR) {
                    fs_error();
                  }
                };
                "writestart progress write abort".split(" ").forEach(function(event) {
                  writer["on" + event] = filesaver["on" + event];
                });
                writer.write(blob);
                filesaver.abort = function() {
                  writer.abort();
                  filesaver.readyState = filesaver.DONE;
                };
                filesaver.readyState = filesaver.WRITING;
              }), fs_error);
            }), fs_error);
          };
          dir.getFile(name, {create: false}, abortable(function(file) {
            // delete file if it already exists
            file.remove();
            save();
          }), abortable(function(ex) {
            if (ex.code === ex.NOT_FOUND_ERR) {
              save();
            } else {
              fs_error();
            }
          }));
        }), fs_error);
      }), fs_error);
    }
    , FS_proto = FileSaver.prototype
    , saveAs = function(blob, name, no_auto_bom) {
      return new FileSaver(blob, name, no_auto_bom);
    }
  ;
  // IE 10+ (native saveAs)
  if (typeof navigator !== "undefined" && navigator.msSaveOrOpenBlob) {
    return function(blob, name, no_auto_bom) {
      if (!no_auto_bom) {
        blob = auto_bom(blob);
      }
      return navigator.msSaveOrOpenBlob(blob, name || "download");
    };
  }

  FS_proto.abort = function() {
    var filesaver = this;
    filesaver.readyState = filesaver.DONE;
    dispatch(filesaver, "abort");
  };
  FS_proto.readyState = FS_proto.INIT = 0;
  FS_proto.WRITING = 1;
  FS_proto.DONE = 2;

  FS_proto.error =
  FS_proto.onwritestart =
  FS_proto.onprogress =
  FS_proto.onwrite =
  FS_proto.onabort =
  FS_proto.onerror =
  FS_proto.onwriteend =
    null;

  return saveAs;
}(
     typeof self !== "undefined" && self
  || typeof window !== "undefined" && window
  || this.content
));
// `self` is undefined in Firefox for Android content script context
// while `this` is nsIContentFrameMessageManager
// with an attribute `content` that corresponds to the window

if (typeof module !== "undefined" && module.exports) {
  module.exports.saveAs = saveAs;
} else if ((typeof define !== "undefined" && define !== null) && (define.amd != null)) {
  define([], function() {
    return saveAs;
  });
}
/**
 * http://www.openjs.com/scripts/events/keyboard_shortcuts/
 * Version : 2.01.B
 * By Binny V A
 * License : BSD
 */
shortcut = {
  'all_shortcuts':{},//All the shortcuts are stored in this array
  'add': function(shortcut_combination,callback,opt) {
    var k, code;
    //Provide a set of default options
    var default_options = {
      'type':'keydown',
      'propagate':false,
      'disable_in_input':false,
      'target':document,
      'keycode':false
    }
    if(!opt) opt = default_options;
    else {
      for(var dfo in default_options) {
        if(typeof opt[dfo] == 'undefined') opt[dfo] = default_options[dfo];
      }
    }

    var ele = opt.target;
    if(typeof opt.target == 'string') ele = document.getElementById(opt.target);
    var ths = this;
    shortcut_combination = shortcut_combination.toLowerCase();

    //The function to be called at keypress
    var func = function(e) {
      e = e || window.event;
      
      if(opt['disable_in_input']) { //Don't enable shortcut keys in Input, Textarea fields
        var element;
        if(e.target) element=e.target;
        else if(e.srcElement) element=e.srcElement;
        if(element.nodeType==3) element=element.parentNode;

        if(element.tagName == 'INPUT' || element.tagName == 'TEXTAREA') return;
      }
  
      //Find Which key is pressed
      if (e.keyCode) code = e.keyCode;
      else if (e.which) code = e.which;
      var character = String.fromCharCode(code).toLowerCase();
      
      if(code == 188) character=","; //If the user presses , when the type is onkeydown
      if(code == 190) character="."; //If the user presses , when the type is onkeydown

      var keys = shortcut_combination.split("+");
      //Key Pressed - counts the number of valid keypresses - if it is same as the number of keys, the shortcut function is invoked
      var kp = 0;
      
      //Work around for stupid Shift key bug created by using lowercase - as a result the shift+num combination was broken
      var shift_nums = {
        "`":"~",
        "1":"!",
        "2":"@",
        "3":"#",
        "4":"$",
        "5":"%",
        "6":"^",
        "7":"&",
        "8":"*",
        "9":"(",
        "0":")",
        "-":"_",
        "=":"+",
        ";":":",
        "'":"\"",
        ",":"<",
        ".":">",
        "/":"?",
        "\\":"|"
      }
      //Special Keys - and their codes
      var special_keys = {
        'esc':27,
        'escape':27,
        'tab':9,
        'space':32,
        'return':13,
        'enter':13,
        'backspace':8,
  
        'scrolllock':145,
        'scroll_lock':145,
        'scroll':145,
        'capslock':20,
        'caps_lock':20,
        'caps':20,
        'numlock':144,
        'num_lock':144,
        'num':144,
        
        'pause':19,
        'break':19,
        
        'insert':45,
        'home':36,
        'delete':46,
        'end':35,
        
        'pageup':33,
        'page_up':33,
        'pu':33,
  
        'pagedown':34,
        'page_down':34,
        'pd':34,
  
        'left':37,
        'up':38,
        'right':39,
        'down':40,
  
        'f1':112,
        'f2':113,
        'f3':114,
        'f4':115,
        'f5':116,
        'f6':117,
        'f7':118,
        'f8':119,
        'f9':120,
        'f10':121,
        'f11':122,
        'f12':123
      }
  
      var modifiers = { 
        shift: { wanted:false, pressed:false},
        ctrl : { wanted:false, pressed:false},
        alt  : { wanted:false, pressed:false},
        meta : { wanted:false, pressed:false} //Meta is Mac specific
      };
                        
      if(e.ctrlKey) modifiers.ctrl.pressed = true;
      if(e.shiftKey)  modifiers.shift.pressed = true;
      if(e.altKey)  modifiers.alt.pressed = true;
      if(e.metaKey)   modifiers.meta.pressed = true;
                        
      for(var i=0; k=keys[i],i<keys.length; i++) {
        //Modifiers
        if(k == 'ctrl' || k == 'control') {
          kp++;
          modifiers.ctrl.wanted = true;

        } else if(k == 'shift') {
          kp++;
          modifiers.shift.wanted = true;

        } else if(k == 'alt') {
          kp++;
          modifiers.alt.wanted = true;
        } else if(k == 'meta') {
          kp++;
          modifiers.meta.wanted = true;
        } else if(k.length > 1) { //If it is a special key
          if(special_keys[k] == code) kp++;
          
        } else if(opt['keycode']) {
          if(opt['keycode'] == code) kp++;

        } else { //The special keys did not match
          if(character == k) kp++;
          else {
            if(shift_nums[character] && e.shiftKey) { //Stupid Shift key bug created by using lowercase
              character = shift_nums[character]; 
              if(character == k) kp++;
            }
          }
        }
      }
      
      if(kp == keys.length && 
            modifiers.ctrl.pressed == modifiers.ctrl.wanted &&
            modifiers.shift.pressed == modifiers.shift.wanted &&
            modifiers.alt.pressed == modifiers.alt.wanted &&
            modifiers.meta.pressed == modifiers.meta.wanted) {
        callback(e);
  
        if(!opt['propagate']) { //Stop the event
          //e.cancelBubble is supported by IE - this will kill the bubbling process.
          e.cancelBubble = true;
          e.returnValue = false;
  
          //e.stopPropagation works in Firefox.
          if (e.stopPropagation) {
            e.stopPropagation();
            e.preventDefault();
          }
          return false;
        }
      }
    }
    this.all_shortcuts[shortcut_combination] = {
      'callback':func, 
      'target':ele, 
      'event': opt['type']
    };
    //Attach the function with the event
    if(ele.addEventListener) ele.addEventListener(opt['type'], func, false);
    else if(ele.attachEvent) ele.attachEvent('on'+opt['type'], func);
    else ele['on'+opt['type']] = func;
  },

  //Remove the shortcut - just specify the shortcut and I will remove the binding
  'remove':function(shortcut_combination) {
    shortcut_combination = shortcut_combination.toLowerCase();
    var binding = this.all_shortcuts[shortcut_combination];
    delete(this.all_shortcuts[shortcut_combination])
    if(!binding) return;
    var type = binding['event'];
    var ele = binding['target'];
    var callback = binding['callback'];

    if(ele.detachEvent) ele.detachEvent('on'+type, callback);
    else if(ele.removeEventListener) ele.removeEventListener(type, callback, false);
    else ele['on'+type] = false;
  }
}
    
    // -------------------------------------------------------------------------------------- //
//                                                                                        //
//                  Ensemble de fonction ayant trait au rendu graphique.                  //
//               Ces fonction générales n'ont pas spécialement à être placé               //
//                       au sein de la classe des project de cablage                      //
//                                                                                        //
// -------------------------------------------------------------------------------------- //

var dialogBoxes = new function () {
  this.list = [];
};

// ------------------------------------------------ //
// ---------- Quelques fonctions de base ---------- //
// ------------------------------------------------ //
dialogBoxes.findPos = function (el){
 var x = 0, y = 0;
 if(el.offsetParent) {
   x = el.offsetLeft;
   y = el.offsetTop;
   while(el = el.offsetParent)   {
     x += el.offsetLeft;
     y += el.offsetTop;
    }
  }
  return {'x':x, 'y':y};
}
     
dialogBoxes.getMousePos = function (e){
  var posx = 0;
  var posy = 0;
  if (!e) var e = window.event;
  if (e.pageX || e.pageY)  {
    posx = e.pageX;
    posy = e.pageY;
  }
  else if (e.clientX || e.clientY) {
    posx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
    posy = e.clientY + document.body.scrollTop  + document.documentElement.scrollTop;
  }
  return {'x':posx, 'y':posy};
}
  
dialogBoxes.addEvent = function (element, event, func){
  if (element.addEventListener) {
    element.addEventListener(event, func, false);
  }
  else {
   element.attachEvent('on' + event, func);
  }
}

dialogBoxes.removeEvent = function (element, event, func) {
  if (element.removeEventListener) {
    element.removeEventListener(event, func, false);
  }
  else {
   element.detachEvent('on' + event, func);
  }
}

//     http://stackoverflow.com/questions/4976936/get-the-available-browser-window-size-clientheight-clientwidth-consistently-ac
dialogBoxes.getWindowSize = (function() {
  var docEl = document.documentElement,
      IS_BODY_ACTING_ROOT = docEl && docEl.clientHeight === 0;

  // Used to feature test Opera returning wrong values 
  // for documentElement.clientHeight. 
  function isDocumentElementHeightOff () { 
      var d = document,
          div = d.createElement('div');
      div.style.height = "2500px";
      d.body.insertBefore(div, d.body.firstChild);
      var r = d.documentElement.clientHeight > 2400;
      d.body.removeChild(div);
      return r;
  }

  if (typeof document.clientWidth == "number") {
     return function () {
       return { width: document.clientWidth, height: document.clientHeight };
     };
  } else if (IS_BODY_ACTING_ROOT || isDocumentElementHeightOff()) {
      var b = document.body;
      return function () {
        return { width: b.clientWidth, height: b.clientHeight };
      };
  } else {
      return function () {
        return { width: docEl.clientWidth, height: docEl.clientHeight };
      };
  }
})();

// ------------------------------------------------ //
// ---------- Boite de dialogue standard ---------- //
// ------------------------------------------------ //

// ----- fermeture de la boite de dialogue...
dialogBoxes.close = function(dialog_box_id, destructionFunction)
{
  var old_dialog_box = document.getElementById(dialog_box_id);
  if (old_dialog_box)
  {
    old_dialog_box.parentNode.removeChild(old_dialog_box);
  }
  if(destructionFunction)
  {
    destructionFunction();
  }
}

// ----- Ouverture de la boirte de dialogue
dialogBoxes.open = function(dialog_box_id, insideDOMelem, windowTitle,destructionFunction)
{
  var old_dialog_box = document.getElementById(dialog_box_id);
  if (old_dialog_box)
  {
    old_dialog_box.parentNode.removeChild(old_dialog_box);
  }
  var closeButtonBase64  = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAkCAYAAADl9UilAAAAGXRFWHRTb2Z0d2FyZQBBZG9i";
      closeButtonBase64 += "ZSBJbWFnZVJlYWR5ccllPAAABG1JREFUeNrMWE1IW1sQniQ3SdPn04pWC/K6URRa/1o3LgS3ivi3ELoTKerC/z9QREErgv";
      closeButtonBase64 += "iDgq7EP6zg0k0tFldirbzFK+WtRHChvoUPNcXE1sT8dOb03HBM7r1JaG7bgY/c5EzmfHdmzpwzxwB3xRAGsRB/GASIiISM";
      closeButtonBase64 += "CBOHWXiOFTmRgJfjVnj2yeOSQIwI0HcL4h6Hlf9m4qRjIT5OwoNwI24QX/mzh48xYrKn6NmG+APxJ8d9gVwsiREBF+ILws";
      closeButtonBase64 += "FxzQkGQmrkkz9A/IXIr6ioeHFwcPDe6XRe+nUSh8NhpzloLpqTz/2Ac2FOMHEvPUI8bWxsrLu5uXH6f5LQXM3NzS9pbs6B";
      closeButtonBase64 += "uJgMPMkpZImI1MPDw+mMjIzC3d1dWFpagouLC9BDkpKSoK6uDoqKiuDo6Ojv9PT0Vvz5DGGnEMvEKJ+SEWkul+uNxWKx1d";
      closeButtonBase64 += "bWgt1uBz0lISEBVldX4fb21oVzluJP/yHOKeckoUTQs5VI0Z8uzs9Bb7FfXrJPs9ls5bkllyijJNQnmRwTr8+naVSSJPB4";
      closeButtonBase64 += "PLHkKTuJ8RHrmFEsCV6vV9VCfX09ZGVlQX9/P2DoVfU6OzvZ+NzcXCTEjAIxkIJ2AAhHrKWlBaqqqtjzyMgI9PX1KZLr7u";
      closeButtonBase64 += "6GkpKS78YNBpiZmYnUcwbQKppELBjt7e0BUiR5eXkwNjbGwirqtba2QmlpaUAPaxX7r5JNLfcpE8P8EfH0yRMoKysL0cvJ";
      closeButtonBase64 += "yYHx8XGQTCam19TUBJWVlSF65eXl8PzZsxC7URPz4NuI+OfjRxgaGgKfwqLIzc2FyakpaEOv1NTUKNqbnp6GD/v7IXa1Vo";
      closeButtonBase64 += "Kqx4Ll7eYmuDGfhl+9oiV+Z4zCSlCSqclJWF9fj3qJqnpMSbbevQOH0wmTOJnVag07wRR68vXaWtS1Qz2U6DE17OzssFzS";
      closeButtonBase64 += "KhUkExMTsLy8rGkrpsQIe3t7sImhVZOzszPY2NgIayf6VamwtEWQx6qrq1UNp6amwuLiItsPtezE1GN4TGHEwklmZibMz8";
      closeButtonBase64 += "+DzWbTP5RUPKn6RyrZ2dksz9TIxSSUVL3b2toU9Xt6emBgYEBxLD8/n4WVSkykoZS0PCZKWloaNDQ0KOr29vayc5X8QqOj";
      closeButtonBase64 += "oyE6BQUFUFhYCNvb2z9WLoLf7Pj4mFX1q6urO3qDg4OwsLAQ0KOc6urqCrFH3t7a2oo6+f2RhHIftxSR3PDwMMzOzobo0Z";
      closeButtonBase64 += "G8o6MjYIvycg2LbISr0i+G0s/bKl+4Yw+Row25uLhY8yhDOUUFOD4+HlZWViJt6+SGl519aF+JRzxEPMbG5S0NxMXFwc8Q";
      closeButtonBase64 += "bBHlMxudk04Q/yOupKDO2OV2u7/SuT8xMRHOdT73Jycns09qRngDLF8X+OQc8/IW/cvp6em/8uabkpLCjjl6gGzTHCQnJy";
      closeButtonBase64 += "efeFfu5lwgpOGl5vN3aHhVrwiw8f1wfX39WS9CZJvmEK4IHotXBGLrZv5NLlVYnhmEeiZeQ9n4NZTlF11D+dQu7iSBkN4X";
      closeButtonBase64 += "dx6RkDxuiOCq06jWe/4AORBJKF11fhNgAIJW92K2HFLLAAAAAElFTkSuQmCC";
      
  var eSection   = document.createElement('section');
  var eh1        = document.createElement('h1');
  var eImg       = document.createElement('img');
  var eArticle   = document.createElement('article');
  
  eSection.id                          = dialog_box_id;
  eSection.style.display               = "block";
  eSection.style.border                = "1px solid black";
  eSection.style.borderRadius          = "5px";
  eSection.style.padding               = "0px";
  eSection.style.paddingTop            = "0px";
  eSection.style.backgroundColor       = "white";
  eSection.style.zIndex                = "10";
  eSection.style.position              = "absolute";
  eSection.style.margin                = "0px";
  
  eh1.style.position        = "relative";
  eh1.style.fontSize        = "15px";
  eh1.style.margin          = "0px";
  eh1.style.padding         = "0px 20px";
  eh1.style.height          = "20px";
  eh1.style.width           = "auto";
  eh1.style.backgroundColor = "#39637F";
  eh1.style.cursor          = "move";
  eh1.style.borderBottom    = "2px solid black";
  eh1.id                    = dialog_box_id+"Move";
  
  eImg.id                 = dialog_box_id+"Close"
  eImg.src                = closeButtonBase64;
  eImg.height             = 20;
  eImg.style.cursor       = "pointer";
  eImg.style.position     = "absolute";
  eImg.style.right        = "10px";
  eImg.style.display      = "inline-block";
  eImg.onclick            = function(){dialogBoxes.close(dialog_box_id, destructionFunction);}
  
  eArticle.style.margin           = "10px";
  eArticle.appendChild(insideDOMelem);
      
  if(windowTitle != undefined) eh1.appendChild(document.createTextNode(windowTitle));
  eh1.appendChild(eImg);
  eSection.appendChild(eh1);
  eSection.appendChild(eArticle);
  document.body.appendChild(eSection);
  
  if(typeof dialogBoxes.list[dialog_box_id] === 'undefined')
  {
    var dialog_box_top                   = Math.max(window.pageYOffset, Math.round(window.pageYOffset + (dialogBoxes.getWindowSize().height-eSection.offsetHeight)/2));
    var dialog_box_left                  = Math.max(window.pageXOffset, Math.round(window.pageXOffset + (dialogBoxes.getWindowSize().width -eSection.offsetWidth )/2));
    dialogBoxes.list[dialog_box_id]      = new dialogBoxes.boxElem();
    dialogBoxes.list[dialog_box_id].top  = dialog_box_top;
    dialogBoxes.list[dialog_box_id].left = dialog_box_left;
  }
  eSection.style.top                     = dialogBoxes.list[dialog_box_id].top +"px";
  eSection.style.left                    = dialogBoxes.list[dialog_box_id].left+"px";
  dialogBoxes.addEvent(document.getElementById(dialog_box_id+"Move"), "mousedown", dialogBoxes.moveEventInit);
  dialogBoxes.addEvent(document, "mousemove", dialogBoxes.moveEvent);
}

// ----- Génération d'un bouton "MOVE" ----- //
dialogBoxes.boxElem = function ()
{
  this.clicked     = false;
  this.internal_dx = 0;
  this.internal_dy = 0;
  this.top         = 0;
  this.left        = 0;
  
  this.setDxDy     = function(newDx, newDy)
  {
    this.internal_dx = newDx;
    this.internal_dy = newDy;
  }
}

dialogBoxes.moveEventInit =  function(e)
{
  var ev = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  
  var target           = ev.target || ev.srcElement;
  
  if (target.id.substring(target.id.length-5,target.id.length) != "Close")
  {
    var dialogBoxMove_id = target.id; //attention ce n'est pas un objet string ...
    var dialogBox_id     = dialogBoxMove_id.substring(0,dialogBoxMove_id.length-4);
    var dialogBox        = document.getElementById(dialogBox_id);

    var dialogBox_pos    = dialogBoxes.findPos(dialogBox);
    var mouse_pos        = dialogBoxes.getMousePos(ev);
    var internal_dx      = mouse_pos.x-dialogBox_pos.x;
    var internal_dy      = mouse_pos.y-dialogBox_pos.y;

    dialogBoxes.list[dialogBox_id].clicked     = true;
    dialogBoxes.list[dialogBox_id].internal_dx = internal_dx;
    dialogBoxes.list[dialogBox_id].internal_dy = internal_dy;

    return false;
  }
}

dialogBoxes.moveEvent = function (e)
{
  var ev = e || window.event;
  if (ev.preventDefault) {
    ev.preventDefault();}
  ev.returnValue = false;
  
  var dialogBox_id;
  var mouse_pos        = dialogBoxes.getMousePos(ev);
  var graphic_pos      = dialogBoxes.findPos(document.body);
  for(dialogBox_id in dialogBoxes.list)
  {
    if(dialogBoxes.list[dialogBox_id].clicked)
    {
      dialogBoxes.list[dialogBox_id].top  = (mouse_pos.y - graphic_pos.y - dialogBoxes.list[dialogBox_id].internal_dy);
      dialogBoxes.list[dialogBox_id].left = (mouse_pos.x - graphic_pos.x - dialogBoxes.list[dialogBox_id].internal_dx);
      var dialogBoxElem                   = document.getElementById(dialogBox_id);
      dialogBoxElem.style.top             = (mouse_pos.y - graphic_pos.y - dialogBoxes.list[dialogBox_id].internal_dy)+"px";
      dialogBoxElem.style.left            = (mouse_pos.x - graphic_pos.x - dialogBoxes.list[dialogBox_id].internal_dx)+"px";
    }
  }
  return false;
}

dialogBoxes.moveEventEnd = function (e)
{
  var dialogBox_id;
  for(dialogBox_id in dialogBoxes.list)
  {
    dialogBoxes.list[dialogBox_id].clicked = false;
  }
  return false;
}

dialogBoxes.addEvent(document, "mouseup", dialogBoxes.moveEventEnd);




var eventRanking = new function() {
  
  this.EventInfo = function(id, name, date, location, description) {// Info générales :
    this.id               = id;
    this.name             = name;
    this.date             = date;
    this.location         = location;
    this.description      = description;
  };
  this.Formula = function(id, eventId, pos, name, formula, format) {
    this.id               = id;
    this.eventId          = eventId;
    this.pos              = pos;
    this.name             = name;
    this.formula          = formula;
    this.format           = format;
  };
  this.ChallengeType = function(id, eventId, pos, name, description, ptMax, color) {// : Liste des types d'épreuves
    this.id               = id;
    this.eventId          = eventId;
    this.pos              = pos;
    this.name             = name;
    this.description      = description;
    this.ptMax            = ptMax;// (peut être négatif en pour d'éventuelles pénalités)
    this.color            = color;
  };
  this.Challenge = function(id, eventId, pos, name, ptMax, typeId, formulaId) { // : Liste des épreuves :
    this.id               = id;
    this.eventId          = eventId;
    this.pos              = pos;
    this.name             = name;
    this.ptMax            = ptMax;
    this.typeId           = typeId;
    this.formulaId        = formulaId;
  };
  // Type d'unité scoute (Scouts, Guides ou Mixtes)
  this.Category = function(id, eventId, pos, name, color) {
    this.id               = id;
    this.eventId          = eventId;
    this.pos              = pos;
    this.name             = name;
    this.color            = color;
  };
  // Nom de l'unité scoute
  this.Group = function(id, eventId, pos, name, number, category, description) {
    this.id               = id;
    this.eventId          = eventId;
    this.pos              = pos;
    this.name             = name;
    this.number           = number;
    this.category         = category;
    this.description      = description;
  };
  this.Team = function(id, eventId, pos, name, group, playersNb) {// : Liste des équipes :
    this.id               = id;
    this.eventId          = eventId;
    this.pos              = pos;
    this.name             = name;
    this.group            = group;
    this.playersNb        = playersNb;
  };
  this.ScoreFormat = function(id, name, getInputElemFct, getFormatedValueFct, getFloatFct) {
    this.id               = id;
    this.name             = name;
    this.getInputElem     = getInputElemFct;
    this.getFormatedValue = getFormatedValueFct;
    this.getFloat         = getFloatFct;
  };
  this.ScoreOrdering = function(id, name, orderFct) {
    this.id               = id;
    this.name             = name;
    this.getReorder       = orderFct;
  };
  this.ScoreType = function(id,  name, calculate, getValueFct) {
    this.id               = id;
    this.name             = name;
    this.calculate        = calculate;
    this.getValue         = getValueFct;
  };
  // Elements du tableau de points
  this.Score = function(id, eventId, teamId, challengeId, value, type) {
    this.id               = id;
    this.eventId          = eventId;
    this.teamId           = teamId;
    this.challengeId      = challengeId;
    this.value            = value;
    this.type             = type;
  };

  
  this.actualEventId    = 0;
  
  this.eventsInfo       = new this.EventInfo(0, "Mafeking", "Aujourd'hui", "Au local", "Ce sera SUPER !");
  this.teams            = [];
  this.challengeTypes   = [];
  this.challenges       = [];
  this.groups           = [];
  this.categories       = [];
  this.formulae         = [];
  this.scores           = [];
  
  this.scoreFormats     = [];
  this.scoreTypes       = [];
  this.scoreFilters     = new function () {
    this.challengeOrder              = 1;
    this.reversedTeamOrder           = false;
    this.reversedChallengeOrder      = false;
    this.reversedChallengeTypeOrder  = false;
    this.showChallenges              = true;
    this.showChallengeTypes          = true;
    this.showTotal                   = true;
    this.challengesHide              = [];
    this.challengeOrderFcts          = [];
    this.hiddenChallengeTypes        = [];
    this.hiddenCategories            = [];
  };
  
  this.graphics         = new function () {
    this.actualPage       = "main";
    this.filters          = [];
    this.ordering         = 'teamNum';
    this.tableSubview     = 'edit';
    this.displayOnly      = false;
    this.fastDisplay      = false;
  };
  this.storage          = new function () {
    this.history          = [];
    this.maxHistoryElem   = 100;
  };
};

eventRanking.setEventInfo     = function(id, name, date, location, description) {
//     if (id == "") id = getNewId(this.eventsInfo);
//     this.eventsInfo[id] = new EventInfo(id, name, date, loaction, description, this);
//     return id;
  if (id == "") id = 0;
  this.eventsInfo = new eventRanking.EventInfo(parseInt(id), name, date, location, description);
  this.actualEventId    = parseInt(id);
  return parseInt(id);
};
eventRanking.addFormula      = function(id, pos, name, formula, format) {
  if (id == "" || parseInt(id) == 0) {
    id  = this.getNewId(this.formulae);
    pos = this.getNewPos(this.formulae);}
  this.formulae[parseInt(id)] = new eventRanking.Formula(parseInt(id), this.actualEventId, parseInt(pos), name, formula, format);
  return id;
};
eventRanking.addChallengeType = function(id, pos, name, description, ptMax, color) {
  if (id == "" || parseInt(id) == 0) {
    id  = this.getNewId(this.challengeTypes);
    pos = this.getNewPos(this.challengeTypes);}
  this.challengeTypes[parseInt(id)] = new eventRanking.ChallengeType(parseInt(id), this.actualEventId, parseInt(pos), name, description, ptMax, color);
  return id;
};
eventRanking.addChallenge     = function(id, pos, name, ptMax, typeId, formulaId) {
  if (id == "" || parseInt(id) == 0) {
    id  = this.getNewId(this.challenges);
    pos = this.getNewPos(this.challenges);};
  this.challenges[parseInt(id)] = new eventRanking.Challenge(parseInt(id), this.actualEventId, parseInt(pos), name, ptMax, parseInt(typeId), parseInt(formulaId));
  return id;
};
eventRanking.addCategory      = function(id, pos, name, color) {
  if (id == "" || parseInt(id) == 0) {
    id  = this.getNewId(this.categories);
    pos = this.getNewPos(this.categories);;}
  this.categories[parseInt(id)]     = new eventRanking.Category(parseInt(id), this.actualEventId, parseInt(pos), name, color);
  return id;
};
eventRanking.addGroup         = function(id, pos, name, number, category, description) {
  if (id == "" || parseInt(id) == 0) {
    id  = this.getNewId(this.groups);
    pos = this.getNewPos(this.groups);};
  this.groups[parseInt(id)]     = new eventRanking.Group(parseInt(id), this.actualEventId, parseInt(pos), name, number, category, description);
  return id;
};
eventRanking.addTeam          = function(id, pos, name, group, playersNb) {
  if (id == "" || parseInt(id) == 0) {
    id  = this.getNewId(this.teams);
    pos = this.getNewPos(this.teams);
  }
  this.teams[parseInt(id)] = new eventRanking.Team(parseInt(id), this.actualEventId, parseInt(pos), name, parseInt(group), parseInt(playersNb));
  return id;
};
eventRanking.addScore     = function(id, teamId, challengeId, value, type) {
  if (id == "" || parseInt(id) == 0) {
    id = this.getNewId(this.scores);}
  this.scores[parseInt(id)]     = new eventRanking.Score(parseInt(id), this.actualEventId, parseInt(teamId), parseInt(challengeId), value, type);
  return id;
};


eventRanking.getOrderedFormulae = function () {
  var tmp = [], it1;
  for (it1 in eventRanking.formulae) {if(eventRanking.formulae[it1] != undefined) if(eventRanking.formulae[it1].eventId == eventRanking.actualEventId) tmp[eventRanking.formulae[it1].pos] = eventRanking.formulae[it1];}
  return tmp;
};
eventRanking.getOrderedChallengeTypes = function () {
  var tmp = [], it1;
  for (it1 in eventRanking.challengeTypes) {if(eventRanking.challengeTypes[it1] != undefined) if(eventRanking.challengeTypes[it1].eventId == eventRanking.actualEventId) tmp[eventRanking.challengeTypes[it1].pos] = eventRanking.challengeTypes[it1];}
  return tmp;
};
eventRanking.getOrderedChallenges = function () {
  var tmp = [], it1;
  for (it1 in eventRanking.challenges) {if(eventRanking.challenges[it1] != undefined) if(eventRanking.challenges[it1].eventId == eventRanking.actualEventId) tmp[eventRanking.challenges[it1].pos] = eventRanking.challenges[it1];}
  return tmp;
};
eventRanking.getOrderedCategories = function () {
  var tmp = [], it1;
  for (it1 in eventRanking.categories) {if(eventRanking.categories[it1] != undefined) if(eventRanking.categories[it1].eventId == eventRanking.actualEventId) tmp[eventRanking.categories[it1].pos] = eventRanking.categories[it1];}
  return tmp;
};
eventRanking.getOrderedGroups = function () {
  var tmp = [], it1;
  for (it1 in eventRanking.groups) {if(eventRanking.groups[it1] != undefined) if(eventRanking.groups[it1].eventId == eventRanking.actualEventId) tmp[eventRanking.groups[it1].pos] = eventRanking.groups[it1];}
  return tmp;
};
eventRanking.getOrderedTeams = function () {
  var tmp = [], it1;
  for (it1 in eventRanking.teams) {if(eventRanking.teams[it1] != undefined) if(eventRanking.teams[it1].eventId == eventRanking.actualEventId) tmp[eventRanking.teams[it1].pos] = eventRanking.teams[it1];}
  return tmp;
};
eventRanking.getScoresTeamChallenge = function () {
  var tmp = [], it1;
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined) {
      if(eventRanking.scores[it1].eventId == eventRanking.actualEventId && eventRanking.teams[eventRanking.scores[it1].teamId] != undefined && eventRanking.challenges[eventRanking.scores[it1].challengeId] != undefined) {
        if(tmp[eventRanking.scores[it1].teamId] == undefined) tmp[eventRanking.scores[it1].teamId] = [];
        tmp[eventRanking.scores[it1].teamId][eventRanking.scores[it1].challengeId] = eventRanking.scores[it1];
      }
    }
  }
  return tmp;
};
eventRanking.getScoresChallengeTeam = function () {
  var tmp = [], it1;
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined) {
      if(eventRanking.scores[it1].eventId == eventRanking.actualEventId && eventRanking.teams[eventRanking.scores[it1].teamId] != undefined && eventRanking.challenges[eventRanking.scores[it1].challengeId] != undefined)
        tmp[eventRanking.scores[it1].challengeId][eventRanking.scores[it1].teamId] = eventRanking.scores[it1];
    }
  }
  return tmp;
};



eventRanking.Formula.prototype.getListElem      = function () {
  var tmp = document.createElement('span');
  tmp.style.backgroundColor = "lightgrey";
  tmp.appendChild(document.createTextNode(this.name));
  return tmp;
};
eventRanking.ChallengeType.prototype.getListElem      = function () {
  var tmp = document.createElement('span');
  tmp.style.backgroundColor = this.color;
  tmp.appendChild(document.createTextNode(this.name));
  return tmp;
};
eventRanking.Challenge.prototype.getListElem      = function () {
  var tmp = document.createElement('span');
  if(eventRanking.challengeTypes[this.typeId] != undefined) tmp.style.backgroundColor = eventRanking.challengeTypes[this.typeId].color;
  tmp.appendChild(document.createTextNode(this.name));
  return tmp;
};
eventRanking.Challenge.prototype.getListElem2      = function () {
  var tmp = document.createElement('SPAN');
  if(eventRanking.challengeTypes[this.typeId] != undefined) tmp.style.backgroundColor = eventRanking.challengeTypes[this.typeId].color;
  tmp.appendChild(document.createTextNode(this.name));
  if(eventRanking.formulae[this.formulaId] != undefined) {
    var tmp2 = document.createElement('SPAN');
    tmp2.appendChild(document.createTextNode(' '+eventRanking.formulae[this.formulaId].name));
    tmp2.style.fontSize = 'smaller';
    tmp2.style.display = 'inline';
    tmp.appendChild(tmp2);
  }
  return tmp;
};
eventRanking.Category.prototype.getListElem      = function () {
  var tmp = document.createElement('span');
  tmp.style.backgroundColor = this.color;
  tmp.appendChild(document.createTextNode(this.name));
  return tmp;
};
eventRanking.Group.prototype.getListElem      = function () {
  var tmp = document.createElement('span');
  if(eventRanking.categories[this.category] != undefined)
    tmp.style.backgroundColor = eventRanking.categories[this.category].color;
  tmp.appendChild(document.createTextNode(this.name + ' ('+this.number + ')'));
  return tmp;
};
eventRanking.Team.prototype.getListElem      = function () {
  var tmp = document.createElement('span');
  if (eventRanking.groups[this.group] != undefined)
    if(eventRanking.categories[eventRanking.groups[this.group].category] != undefined)
      tmp.style.backgroundColor = eventRanking.categories[eventRanking.groups[this.group].category].color;
//   tmp.appendChild(document.createTextNode(this.pos + ' ' + this.name + ' ('+eventRanking.groups[this.group].name+')'));
  tmp.appendChild(document.createTextNode(this.name + ' ('+eventRanking.groups[this.group].name+')'));
  return tmp;
};



eventRanking.EventInfo.prototype.getFormElem      = function () {
  
  var fEventInfo   = document.createElement('form');
  var iId          = document.createElement('input');
  var iName        = document.createElement('input');
  var iDate        = document.createElement('input');
  var iDescription = document.createElement('textarea');
  var iLocation    = document.createElement('input');
  var iSubmit      = document.createElement('input');
  
  iId.type          = 'hidden';
  iName.type        = 'text';
  iDate.type        = 'text';
  iLocation.type    = 'text';
  iDescription.name = 'description';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iName.name        = 'name';
  iDate.name        = 'date';
  iLocation.name    = 'location';
  iDescription.name = 'description';
  
  iId.value          = this.id;
  iName.value        = this.name;
  iDate.value        = this.date;
  iDescription.value = this.description;
  iLocation.value    = this.location;
  iSubmit.value      = 'Save';
  
  fEventInfo.appendChild(iId);
  fEventInfo.appendChild(document.createTextNode("Nom de l'événement:"));
  fEventInfo.appendChild(iName);
  fEventInfo.appendChild(document.createElement('br'));
  fEventInfo.appendChild(document.createTextNode("Date :"));
  fEventInfo.appendChild(iDate);
  fEventInfo.appendChild(document.createElement('br'));
  fEventInfo.appendChild(document.createTextNode("Localisation :"));
  fEventInfo.appendChild(iLocation);
  fEventInfo.appendChild(document.createElement('br'));
  fEventInfo.appendChild(document.createTextNode("Description :"));
  fEventInfo.appendChild(iDescription);
  fEventInfo.appendChild(document.createElement('br'));
  fEventInfo.appendChild(iSubmit);
  
  fEventInfo.onsubmit   = eventRanking.graphics.setEventInfoEvent;
  
  return fEventInfo;
};
eventRanking.Formula.prototype.getFormElem      = function () {
  var it1;
  var fFormula       = document.createElement('form');
  var iId            = document.createElement('input');
  var iPos           = document.createElement('input');
  var iName          = document.createElement('input');
  var iFormula       = document.createElement('input');
  var sFormat        = document.createElement('select');
  var iSubmit        = document.createElement('input');
  
  iId.type          = 'hidden';
  iPos.type         = 'hidden';
  iName.type        = 'text';
  iFormula.type     = 'text';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iPos.name         = 'pos';
  iName.name        = 'name';
  iFormula.name     = 'formula';
  sFormat.name      = 'format';
  
  iId.value          = this.id;
  iPos.value         = this.pos;
  iName.value        = this.name;
  iFormula.value     = this.formula;
  for(it1 in eventRanking.scoreFormats) {
    var oFormat = document.createElement('option');
    oFormat.value = eventRanking.scoreFormats[it1].id;
    oFormat.appendChild(document.createTextNode(eventRanking.scoreFormats[it1].name));
    if(this.format == eventRanking.scoreFormats[it1].id) oFormat.selected = 'selected';
    sFormat.appendChild(oFormat);
  }
  iSubmit.value      = 'Save';
  
  iFormula.style.fontFamily = '"Courier New", Courier, monospace';
  iFormula.style.width = '400px';
  
  fFormula.appendChild(iId);
  fFormula.appendChild(iPos);
  fFormula.appendChild(document.createTextNode("Nom :"));
  fFormula.appendChild(iName);
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("Formule :"));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(iFormula);
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("Formatage des points :"));
  fFormula.appendChild(sFormat);
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(iSubmit);
  
  
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("Variables remplacées par leurs valeurs :"));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("- Différent pour chaque équipe : "));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("        VAL (points de l'équipe), PLAYERS (nb de participants)"));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("- Identique pour toutes les équipes : "));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("        MIN, MAX, MEAN, MED (médiane)"));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("Fonctions supportées :"));
  fFormula.appendChild(document.createElement('br'));
  fFormula.appendChild(document.createTextNode("abs(x), exp(x), sqrt(x), log(x), pow(x,y), sin(x), cos(x), tan(x), asin(x), acos(x), atan(x)"));
  
//   formula = formula.replace("min", min);
//   formula = formula.replace("max", max);
//   formula = formula.replace("mean", mean);
//   formula = formula.replace("med", med);
//   formula = formula.replace("val", val);
//   formula = formula.replace("players", players);
  
  fFormula.onsubmit   = eventRanking.graphics.setFormulaEvent;
  
  return fFormula;
};
eventRanking.ChallengeType.prototype.getFormElem      = function () {
  var fChallengeType = document.createElement('form');
  var iId            = document.createElement('input');
  var iPos           = document.createElement('input');
  var iName          = document.createElement('input');
  var iDescription   = document.createElement('textarea');
  var iPtMax         = document.createElement('input');
  var iColor         = document.createElement('input');
  var iSubmit        = document.createElement('input');
  
  iId.type          = 'hidden';
  iPos.type         = 'hidden';
  iName.type        = 'text';
  iPtMax.type       = 'text';
  iColor.type       = 'color';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iPos.name         = 'pos';
  iName.name        = 'name';
  iDescription.name = 'description';
  iPtMax.name       = 'ptMax';
  iColor.name       = 'color';
  
  iId.value          = this.id;
  iPos.value         = this.pos;
  iName.value        = this.name;
  iDescription.value = this.description;
  iPtMax.value       = this.ptMax;
  iColor.value       = this.color;
  iSubmit.value      = 'Save';
  
  fChallengeType.appendChild(iId);
  fChallengeType.appendChild(iPos);
  fChallengeType.appendChild(document.createTextNode("Nom :"));
  fChallengeType.appendChild(iName);
  fChallengeType.appendChild(document.createElement('br'));
  fChallengeType.appendChild(document.createTextNode("Description :"));
  fChallengeType.appendChild(iDescription);
  fChallengeType.appendChild(document.createElement('br'));
  fChallengeType.appendChild(document.createTextNode("Points Max :"));
  fChallengeType.appendChild(iPtMax);
  fChallengeType.appendChild(document.createElement('br'));
  fChallengeType.appendChild(document.createTextNode("Couleur de fond :"));
  fChallengeType.appendChild(iColor);
  fChallengeType.appendChild(document.createElement('br'));
  fChallengeType.appendChild(iSubmit);
  
  fChallengeType.onsubmit   = eventRanking.graphics.setChallengeTypeEvent;
  
  return fChallengeType;
};
eventRanking.Challenge.prototype.getFormElem      = function () {
    
  var it1;
  var orderedChallengeType = eventRanking.getOrderedChallengeTypes();
  var orderedFormulae      = eventRanking.getOrderedFormulae();
  var nbChallengeTypes     = orderedChallengeType.length;
  var nbFormulae           = orderedFormulae.length;
  
  var fChallenge     = document.createElement('form');
  var iId            = document.createElement('input');
  var iPos           = document.createElement('input');
  var iName          = document.createElement('input');
  var iPtMax         = document.createElement('input');
  var iTypeId        = document.createElement('select');
  var iFormulaId     = document.createElement('select');
  var iSubmit        = document.createElement('input');
  
  iId.type          = 'hidden';
  iPos.type         = 'hidden';
  iName.type        = 'text';
  iPtMax.type       = 'text';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iPos.name         = 'pos';
  iName.name        = 'name';
  iPtMax.name       = 'ptMax';
  iTypeId.name      = 'typeId';
  iFormulaId.name   = 'formulaId';
  
  iId.value          = this.id;
  iPos.value         = this.pos;
  iName.value        = this.name;
  iPtMax.value       = this.ptMax;
  for(it1=1; it1<nbChallengeTypes; it1++) {
    if(orderedChallengeType[it1] != undefined) {
      var iOption = document.createElement('option');
      iOption.value = orderedChallengeType[it1].id;
      iOption.appendChild(document.createTextNode(orderedChallengeType[it1].name));
      if(orderedChallengeType[it1].id == this.typeId) iOption.selected = "selected";
      iTypeId.appendChild(iOption);
    }
  }
  for(it1 =1; it1<nbFormulae; it1++) {
    if(orderedFormulae[it1] != undefined) {
      var iOption = document.createElement('option');
      iOption.value = orderedFormulae[it1].id;
      iOption.appendChild(document.createTextNode(orderedFormulae[it1].name));
      if(orderedFormulae[it1].id == this.formulaId) iOption.selected = "selected";
      iFormulaId.appendChild(iOption);
    }
  }
  iSubmit.value      = 'Save';
  
  fChallenge.appendChild(iId);
  fChallenge.appendChild(iPos);
  fChallenge.appendChild(document.createTextNode("Nom :"));
  fChallenge.appendChild(iName);
  fChallenge.appendChild(document.createElement('br'));
  fChallenge.appendChild(document.createTextNode("Type d'épreuve :"));
  fChallenge.appendChild(iTypeId);
  fChallenge.appendChild(document.createElement('br'));
  fChallenge.appendChild(document.createTextNode("Formule de calcul de points :"));
  fChallenge.appendChild(iFormulaId);
  fChallenge.appendChild(document.createElement('br'));
  fChallenge.appendChild(document.createTextNode("Pondération des points (pour le type d'épreuve) :"));
  fChallenge.appendChild(iPtMax);
  fChallenge.appendChild(document.createElement('br'));
  fChallenge.appendChild(iSubmit);
  
  fChallenge.onsubmit   = eventRanking.graphics.setChallengeEvent;
  
  return fChallenge;
};
eventRanking.Category.prototype.getFormElem      = function () {
  var fCategories  = document.createElement('form');
  var iId          = document.createElement('input');
  var iPos         = document.createElement('input');
  var iName        = document.createElement('input');
  var iColor       = document.createElement('input');
  var iSubmit      = document.createElement('input');
  
  iId.type          = 'hidden';
  iPos.type         = 'hidden';
  iName.type        = 'text';
  iColor.type       = 'color';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iPos.name         = 'pos';
  iName.name        = 'name';
  iColor.name       = 'color';
  
  iId.value          = this.id;
  iPos.value         = this.pos;
  iName.value        = this.name;
  iColor.value       = this.color;
  iSubmit.value      = 'Save';
  
  fCategories.appendChild(iId);
  fCategories.appendChild(iPos);
  fCategories.appendChild(document.createTextNode("Nom :"));
  fCategories.appendChild(iName);
  fCategories.appendChild(document.createElement('br'));
  fCategories.appendChild(document.createTextNode("Couleur de fond :"));
  fCategories.appendChild(iColor);
  fCategories.appendChild(document.createElement('br'));
  fCategories.appendChild(iSubmit);
  
  fCategories.onsubmit   = eventRanking.graphics.setCategoryEvent;
  
  return fCategories;
};
eventRanking.Group.prototype.getFormElem      = function () {
  var it1;
  var orderedCategories = eventRanking.getOrderedCategories();
  var nbCategories      = orderedCategories.length;
  
  var fGroup         = document.createElement('form');
  var iId            = document.createElement('input');
  var iPos           = document.createElement('input');
  var iName          = document.createElement('input');
  var iNumber        = document.createElement('input');
  var iCategory      = document.createElement('select');
  var iDescription   = document.createElement('textarea');
  var iSubmit        = document.createElement('input');
  
  iId.type          = 'hidden';
  iPos.type         = 'hidden';
  iName.type        = 'text';
  iNumber.type      = 'text';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iPos.name         = 'pos';
  iName.name        = 'name';
  iNumber.name      = 'number';
  iCategory.name    = 'category';
  iDescription.name = 'description';
  
  iId.value          = this.id;
  iPos.value         = this.pos;
  iName.value        = this.name;
  iNumber.value      = this.number;
  iDescription.value = this.description;
  for(it1=0; it1<nbCategories; it1++) {
    if(orderedCategories[it1] != undefined) {
      var iOption = document.createElement('option');
      iOption.value = orderedCategories[it1].id;
      iOption.appendChild(document.createTextNode(orderedCategories[it1].name));
      if(orderedCategories[it1].id == this.category) iOption.selected = "selected";
      iCategory.appendChild(iOption);
    }
  }
  iSubmit.value      = 'Save';
  
  fGroup.appendChild(iId);
  fGroup.appendChild(iPos);
  fGroup.appendChild(document.createTextNode("Nom :"));
  fGroup.appendChild(iName);
  fGroup.appendChild(document.createElement('br'));
  fGroup.appendChild(document.createTextNode("Numéro d'unité :"));
  fGroup.appendChild(iNumber);
  fGroup.appendChild(document.createElement('br'));
  fGroup.appendChild(document.createTextNode("Catégorie :"));
  fGroup.appendChild(iCategory);
  fGroup.appendChild(document.createElement('br'));
  fGroup.appendChild(document.createTextNode("Description :"));
  fGroup.appendChild(iDescription);
  fGroup.appendChild(document.createElement('br'));
  fGroup.appendChild(iSubmit);
  
  fGroup.onsubmit   = eventRanking.graphics.setGroupEvent;
  
  return fGroup;
};
eventRanking.Team.prototype.getFormElem      = function () {
  var it1;
  var orderedGroups  = eventRanking.getOrderedGroups();
  var nbGroups       = orderedGroups.length;
  
  var fTeam          = document.createElement('form');
  var iId            = document.createElement('input');
  var iName          = document.createElement('input');
  var iPos           = document.createElement('input');
  var iGroup         = document.createElement('select');
  var iPlayersNb     = document.createElement('input');
  var iSubmit        = document.createElement('input');
  
  iId.type          = 'hidden';
  iName.type        = 'text';
  iPos.type         = 'hidden';
  iPlayersNb.type   = 'number';
  iSubmit.type      = 'submit';
  
  iId.name          = 'id';
  iName.name        = 'name';
  iPos.name         = 'pos';
  iGroup.name       = 'group';
  iPlayersNb.name   = 'playersNb';
  iPlayersNb.min    = 0;
  iPlayersNb.step   = 1;
  
  iId.value          = this.id;
  iName.value        = this.name;
  iPos.value         = this.pos;
  for(it1=0; it1<nbGroups; it1++) {
    if(orderedGroups[it1] != undefined) {
      var iOption = document.createElement('option');
      iOption.value = orderedGroups[it1].id;
      iOption.appendChild(document.createTextNode(orderedGroups[it1].name));
      if(orderedGroups[it1].id == this.group) iOption.selected = "selected";
      iGroup.appendChild(iOption);
    }
  }
  iPlayersNb.value   = this.playersNb;
  iSubmit.value      = 'Save';
  
  fTeam.appendChild(iId);
  fTeam.appendChild(iPos);
  fTeam.appendChild(document.createTextNode("Nom :"));
  fTeam.appendChild(iName);
  fTeam.appendChild(document.createElement('br'));
  fTeam.appendChild(document.createTextNode("Troupe :"));
  fTeam.appendChild(iGroup);
  fTeam.appendChild(document.createElement('br'));
  fTeam.appendChild(document.createTextNode("Nombre de participants :"));
  fTeam.appendChild(iPlayersNb);
  fTeam.appendChild(document.createElement('br'));
  fTeam.appendChild(iSubmit);
  
  fTeam.onsubmit   = eventRanking.graphics.setTeamEvent;
  
  return fTeam;
};


eventRanking.scoreFilters.getFormElem = function() {
  var it1;
  var maxFilterOrder   = eventRanking.getNewId(eventRanking.scoreFilters.challengeOrderFcts);
  var fFilter          = document.createElement('form');
  var sScoresOrder     = document.createElement('select');
  var iRevChallenge    = document.createElement('input');
  var iRevType         = document.createElement('input');
  var iShowChallenges  = document.createElement('input');
  var iShowTypes       = document.createElement('input');
  var iShowTotal       = document.createElement('input');
  var iSubmit          = document.createElement('input');
  
  iRevChallenge.type   = "checkbox";
  iRevType.type        = "checkbox";
  iShowChallenges.type = "checkbox";
  iShowTypes.type      = "checkbox";
  iShowTotal.type      = "checkbox";
  iSubmit.type         = 'submit';
  
  sScoresOrder.name    = 'scoreOrder';
  iRevChallenge.name   = 'isReversedChallenge';
  iRevType.name        = 'isReversedChallengeType';
  iShowChallenges.name = 'showChallenges';
  iShowTypes.name      = 'showChallengeTypes';
  iShowTotal.name      = 'showTotal';
  
  
  for(it1=0;it1<maxFilterOrder;it1++) {
    if(eventRanking.scoreFilters.challengeOrderFcts[it1] != undefined) {
      var oScoreOrder = document.createElement('option');
      oScoreOrder.value = eventRanking.scoreFilters.challengeOrderFcts[it1].id;
      oScoreOrder.appendChild(document.createTextNode(eventRanking.scoreFilters.challengeOrderFcts[it1].name));
      if(it1 == eventRanking.scoreFilters.challengeOrder) oScoreOrder.selected = 'selected';
      sScoresOrder.appendChild(oScoreOrder);
    }
  }
  iRevChallenge.checked   = eventRanking.scoreFilters.reversedChallengeOrder;
  iRevType.checked        = eventRanking.scoreFilters.reversedChallengeTypeOrder;
  iShowChallenges.checked = eventRanking.scoreFilters.showChallenges;
  iShowTypes.checked      = eventRanking.scoreFilters.showChallengeTypes;
  iShowTotal.checked      = eventRanking.scoreFilters.showTotal;
  iSubmit.value           = 'Rafraîchir';
  
  fFilter.appendChild(document.createTextNode('Ordres d\'affichage des épreuves :'));
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('- Ordre des points :'));
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(sScoresOrder);
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('- '));
  fFilter.appendChild(iRevChallenge);
  fFilter.appendChild(document.createTextNode(' Ordre des épreuves inversé'));
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('- '));
  fFilter.appendChild(iRevType);
  fFilter.appendChild(document.createTextNode(' Ordre des catégories d\'épreuve inversé'));
  fFilter.appendChild(document.createElement('br'));
  
  
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('Afficher les types de points suivants:'));
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('- '));
  fFilter.appendChild(iShowChallenges);
  fFilter.appendChild(document.createTextNode(' Épreuves'));
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('- '));
  fFilter.appendChild(iShowTypes);
  fFilter.appendChild(document.createTextNode(' Sous-totaux (catégories)'));
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('- '));
  fFilter.appendChild(iShowTotal);
  fFilter.appendChild(document.createTextNode(' Total'));
  fFilter.appendChild(document.createElement('br'));
  
  
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('Afficher les catégories d\'épreuve suivantes :'));
  fFilter.appendChild(document.createElement('br'));
  
  var it1;
  var orderedChallengeType = eventRanking.getOrderedChallengeTypes();
  var nbChallengeTypes     = orderedChallengeType.length;
  for(it1=1; it1<nbChallengeTypes; it1++) {
    if(orderedChallengeType[it1] != undefined) {
      var iHideChallengeTypes       = document.createElement('input');
      iHideChallengeTypes.type      = "checkbox";
      iHideChallengeTypes.name      = 'isHiddenChallengeType'+orderedChallengeType[it1].id;
      iHideChallengeTypes.checked   = (eventRanking.scoreFilters.hiddenChallengeTypes.indexOf(orderedChallengeType[it1].id) == -1)?1:0;
      
//       fFilter.appendChild(document.createTextNode('- '+ orderedChallengeType[it1].name));
      fFilter.appendChild(document.createTextNode('- '));
      fFilter.appendChild(iHideChallengeTypes);
      fFilter.appendChild(orderedChallengeType[it1].getListElem());
      fFilter.appendChild(document.createElement('br'));
      
    }
  }
  
  fFilter.appendChild(document.createElement('br'));
  fFilter.appendChild(document.createTextNode('Afficher les catégories d\'équipes suivantes :'));
  fFilter.appendChild(document.createElement('br'));
  
  var orderedCategories = eventRanking.getOrderedCategories();
  var nbCategories      = orderedCategories.length;
  for(it1=0; it1<nbCategories; it1++) {
    if(orderedCategories[it1] != undefined) {
      var iHideCategories       = document.createElement('input');
      iHideCategories.type      = "checkbox";
      iHideCategories.name      = 'isHiddenCategory'+orderedCategories[it1].id;
      iHideCategories.checked   = (eventRanking.scoreFilters.hiddenCategories.indexOf(orderedCategories[it1].id) == -1)?1:0;
      
//       fFilter.appendChild(document.createTextNode('- '+ orderedCategories[it1].name));
      fFilter.appendChild(document.createTextNode('- '));
      fFilter.appendChild(iHideCategories);
      fFilter.appendChild(orderedCategories[it1].getListElem());
      fFilter.appendChild(document.createElement('br'));
    }
  }
  
  fFilter.appendChild(iSubmit);
  
  fFilter.onsubmit = eventRanking.graphics.setFiltersEvents;
  
  return fFilter;
};




eventRanking.getNewId = function(some_array) {
  var id = 0, it1;
  for (it1 in some_array) if(some_array[it1] != undefined) id = Math.max(id, parseInt(some_array[it1].id));
  return id+1;
};
eventRanking.getMaxId = function(some_array) {
  var id = 0, it1;
  for (it1 in some_array) if(some_array[it1] != undefined) id = Math.max(id, parseInt(some_array[it1].id));
  return id;
};
eventRanking.getNewPos = function(some_array) {
  var pos = 0, it1;
  for (it1 in some_array) if(some_array[it1] != undefined) pos = Math.max(pos, parseInt(some_array[it1].pos));
  return pos+1;
};
eventRanking.getMaxPos = function(some_array) {
  var pos = 0, it1;
  for (it1 in some_array) if(some_array[it1] != undefined) pos = Math.max(pos, parseInt(some_array[it1].pos));
  return pos;
};




eventRanking.graphics.refresh = function (){
  var list = document.body;
  // As long as "list" has a child node, remove it
  while (list.hasChildNodes()) {  
      list.removeChild(list.firstChild);
  }
  
  var eHeader = document.createElement('header');
  var eH1     = document.createElement('h1');
  var eH2     = document.createElement('h2');
  var eNav    = document.createElement('nav');
  var eUl1    = document.createElement('ul');
  var eUl2    = document.createElement('ul');
  
  var eLi11 = document.createElement('li');
  var eLi12 = document.createElement('li');
  var eLi13 = document.createElement('li');
  var eLi14 = document.createElement('li');
  var eLi15 = document.createElement('li');
  
  var eLi21 = document.createElement('li');
  var eLi22 = document.createElement('li');
  var eLi23 = document.createElement('li');
  var eLi24 = document.createElement('li');
  var eLi25 = document.createElement('li');
  var eLi26 = document.createElement('li');
  var eLi27 = document.createElement('li');
  
  eH1.appendChild(document.createTextNode(eventRanking.eventsInfo.name));
  eH2.appendChild(document.createTextNode("Classement"));
  
  eUl1.className = "lineList";
  eUl2.className = "columnList";
  
  eLi11.appendChild(document.createTextNode("Nouveau"));
  eLi11.className = 'button new';
  eLi11.onclick = eventRanking.storage.newEvent;
  eLi12.appendChild(document.createTextNode("Ouvrir"));
  eLi12.className = 'button open';
  eLi12.onclick = function() {dialogBoxes.open("openFileForm", eventRanking.storage.openForm(), "Sélectionnez le fichier de classement (.json)")};
  eLi13.appendChild(document.createTextNode("Sauvegarder"));
  eLi13.className = 'button save';
  eLi13.onclick = eventRanking.storage.saveEvent;
  eLi14.appendChild(document.createTextNode("Informations"));
  eLi14.className = 'button info';
  eLi14.onclick = function() {dialogBoxes.open("editEventInfo", eventRanking.eventsInfo.getFormElem(), "Information à propos de l'événement");};
  eLi15.appendChild(document.createTextNode("Undo"));
  eLi15.className = 'button undo';
  eLi15.onclick = eventRanking.storage.undo;
  
  eLi21.appendChild(document.createTextNode("Types d'épreuves"));
  if(eventRanking.graphics.actualPage == "ChallengeTypesList") eLi21.className = "selectedTab";
  eLi21.onclick = function() {    eventRanking.graphics.actualPage = "ChallengeTypesList";  eventRanking.graphics.refresh();  };
  eLi22.appendChild(document.createTextNode("Épreuves"));
  if(eventRanking.graphics.actualPage == "ChallengesList")     eLi22.className = "selectedTab";
  eLi22.onclick = function() {    eventRanking.graphics.actualPage = "ChallengesList";          eventRanking.graphics.refresh();  };
  eLi23.appendChild(document.createTextNode("Catégories"));
  if(eventRanking.graphics.actualPage == "CategoriesList")     eLi23.className = "selectedTab";
  eLi23.onclick = function() {    eventRanking.graphics.actualPage = "CategoriesList";      eventRanking.graphics.refresh();  };
  eLi24.appendChild(document.createTextNode("Troupes/Compagnies"));
  if(eventRanking.graphics.actualPage == "GroupsList")         eLi24.className = "selectedTab";
  eLi24.onclick = function() {    eventRanking.graphics.actualPage = "GroupsList";          eventRanking.graphics.refresh();  };
  eLi25.appendChild(document.createTextNode("Équipes"));
  if(eventRanking.graphics.actualPage == "TeamsList")          eLi25.className = "selectedTab";
  eLi25.onclick = function() {    eventRanking.graphics.actualPage = "TeamsList";          eventRanking.graphics.refresh();  };
  eLi26.appendChild(document.createTextNode("Formules"));
  if(eventRanking.graphics.actualPage == "FormulaeList")       eLi26.className = "selectedTab";
  eLi26.onclick = function() {    eventRanking.graphics.actualPage = "FormulaeList";          eventRanking.graphics.refresh();  };
  eLi27.appendChild(document.createTextNode("Grille de points"));
  if(eventRanking.graphics.actualPage == "ScoreGrid" || eventRanking.graphics.actualPage == "main")       eLi27.className = "selectedTab";
  eLi27.onclick = function() {    eventRanking.graphics.actualPage = "ScoreGrid";           eventRanking.graphics.refresh();  };
  
  if(eventRanking.graphics.displayOnly != true)
    eUl1.appendChild(eLi11);
  eUl1.appendChild(eLi12);
  if(eventRanking.graphics.displayOnly != true)
    eUl1.appendChild(eLi13);
  eUl1.appendChild(eLi14);
  if(eventRanking.graphics.displayOnly != true)
    eUl1.appendChild(eLi15);
  
  eUl2.appendChild(eLi27);
  eUl2.appendChild(eLi21);
  eUl2.appendChild(eLi22);
  eUl2.appendChild(eLi26);
  eUl2.appendChild(eLi23);
  eUl2.appendChild(eLi24);
  eUl2.appendChild(eLi25);
  
  eNav.appendChild(eUl1);
  if(eventRanking.graphics.displayOnly != true)
    eNav.appendChild(eUl2);
  
  eHeader.appendChild(eH1);
  eHeader.appendChild(eH2);
  eHeader.appendChild(eNav);
  
  if(eventRanking.graphics.displayOnly == true) eventRanking.graphics.actualPage   = "ScoreGrid";
  if(eventRanking.graphics.displayOnly == true) eventRanking.graphics.tableSubview = 'view';
    
  var eSection   = document.createElement('section');
  var eSectionH1 = document.createElement('h1');
  var eArticle   = document.createElement('article');
  switch (eventRanking.graphics.actualPage){ 
    case "main" :
      eventRanking.repairScores();
      eSectionH1.appendChild(document.createTextNode("Grille de points"));
      eArticle.appendChild(eventRanking.graphics.menuScores());
      eArticle.appendChild(eventRanking.graphics.tableScores());
      eArticle.className = "noTopMargin";
//       eSectionH1.appendChild(document.createTextNode('Test Page'));
//       eArticle.appendChild(document.createTextNode("Hello World"));
    break;
    case "FormulaeList" :
      eSectionH1.appendChild(document.createTextNode("Liste de formules pour le comptage des points"));
      eArticle.appendChild(eventRanking.graphics.listFormulae());
    break;
    case "ChallengeTypesList" :
      eSectionH1.appendChild(document.createTextNode("Liste des Types d'épreuves"));
      eArticle.appendChild(eventRanking.graphics.listChallengeTypes());
    break;
    case "ChallengesList" :
      eSectionH1.appendChild(document.createTextNode("Liste des épreuves"));
      eArticle.appendChild(eventRanking.graphics.listChallenges());
    break;
    case "CategoriesList" :
      eSectionH1.appendChild(document.createTextNode("Liste des catégories"));
      eArticle.appendChild(eventRanking.graphics.listCategories());
    break;
    case "GroupsList" :
      eSectionH1.appendChild(document.createTextNode("Liste des troupes/compagnies"));
      eArticle.appendChild(eventRanking.graphics.listGroups());
    break;
    case "TeamsList" :
      eSectionH1.appendChild(document.createTextNode("Liste des équipes"));
      eArticle.appendChild(eventRanking.graphics.listTeams());
    break;
    case "ScoreGrid" :
      eventRanking.repairScores();
      eSectionH1.appendChild(document.createTextNode("Grille de points"));
      eArticle.appendChild(eventRanking.graphics.menuScores());
      eArticle.appendChild(eventRanking.graphics.tableScores());
      eArticle.className = "noTopMargin";
    break;
    default :
      eSectionH1.appendChild(document.createTextNode('Test Page'));
      eArticle.appendChild(document.createTextNode("Hello World"));
    break;
  }
  eSection.appendChild(eSectionH1);
  eSection.appendChild(eArticle);
  
  document.body.appendChild(eHeader);
  document.body.appendChild(eSection);
};


eventRanking.graphics.listFormulae = function() {
  var it1;
  var ulFormulae = document.createElement('ul');
  var formulaeOrdered = eventRanking.getOrderedFormulae();
  for(it1 = 1; it1 < eventRanking.getNewPos(formulaeOrdered); it1++) {
    var id = formulaeOrdered[it1].id;
    var liFormula = document.createElement('li');
    var spanFormula = formulaeOrdered[it1].getListElem();
    
    var aMoveUp          = document.createElement('a');
    aMoveUp.dataset.id   = id;
    aMoveUp.className    = 'button moveup';
    aMoveUp.appendChild(document.createTextNode('moveup'));
    aMoveUp.onclick      = eventRanking.graphics.moveUpFormula;
    
    var aMoveDown        = document.createElement('a');
    aMoveDown.className  = 'button movedown';
    aMoveDown.dataset.id = id;
    aMoveDown.onclick    = eventRanking.graphics.moveDownFormula;
    aMoveDown.appendChild(document.createTextNode('movedown'));
    
    
    var aEdit            = document.createElement('a');
    aEdit.dataset.id     = id;
    aEdit.className      = 'button edit';
    aEdit.appendChild(document.createTextNode('edit'));
    aEdit.onclick        = eventRanking.graphics.openEditFormula;
    
    var aDelete = document.createElement('a');
    aDelete.dataset.id   = id;
    aDelete.className    = 'button delete';
    aDelete.appendChild(document.createTextNode('delete'));
    aDelete.onclick = eventRanking.graphics.deleteFormulaEvent;
    
    spanFormula.appendChild(aMoveUp);
    spanFormula.appendChild(aMoveDown);
    spanFormula.appendChild(aEdit);
    spanFormula.appendChild(aDelete);
    liFormula.appendChild(spanFormula);
    ulFormulae.appendChild(liFormula);
  }
  var liLink = document.createElement('li');
  var aLink  = document.createElement('a');
  aLink.onclick = function() {
    var tmp;
    var newFormula = new eventRanking.Formula("0", "", "", "Pondération simple", "VAL/MAX", "float");
    dialogBoxes.open('newChallengeType', newFormula.getFormElem(), "Nouvelle formule");
  };
  aLink.appendChild(document.createTextNode("nouveau"));
  liLink.appendChild(aLink);
  
  ulFormulae.appendChild(liLink);
  return ulFormulae;
};
eventRanking.graphics.listChallengeTypes = function() {
  var it1;
  var ulChallengeTypes = document.createElement('ul');
  var challengeTypesOrdered = eventRanking.getOrderedChallengeTypes();
  for(it1 = 1; it1 < eventRanking.getNewPos(challengeTypesOrdered); it1++) {
    var id = challengeTypesOrdered[it1].id;
    var liChallengeType = document.createElement('li');
    var spanChallengeType = challengeTypesOrdered[it1].getListElem();
    
    var aMoveUp          = document.createElement('a');
    aMoveUp.dataset.id   = id;
    aMoveUp.className    = 'button moveup';
    aMoveUp.appendChild(document.createTextNode('moveup'));
    aMoveUp.onclick      = eventRanking.graphics.moveUpChallengeType;
    
    var aMoveDown        = document.createElement('a');
    aMoveDown.className  = 'button movedown';
    aMoveDown.dataset.id = id;
    aMoveDown.onclick    = eventRanking.graphics.moveDownChallengeType;
    aMoveDown.appendChild(document.createTextNode('movedown'));
    
    
    var aEdit            = document.createElement('a');
    aEdit.dataset.id     = id;
    aEdit.className      = 'button edit';
    aEdit.appendChild(document.createTextNode('edit'));
    aEdit.onclick        = eventRanking.graphics.openEditChallengeType;
    
    var aDelete = document.createElement('a');
    aDelete.dataset.id   = id;
    aDelete.className    = 'button delete';
    aDelete.appendChild(document.createTextNode('delete'));
    aDelete.onclick = eventRanking.graphics.deleteChallengeTypeEvent;
    
    spanChallengeType.appendChild(aMoveUp);
    spanChallengeType.appendChild(aMoveDown);
    spanChallengeType.appendChild(aEdit);
    spanChallengeType.appendChild(aDelete);
    liChallengeType.appendChild(spanChallengeType);
    ulChallengeTypes.appendChild(liChallengeType);
  }
  var liLink = document.createElement('li');
  var aLink  = document.createElement('a');
  aLink.onclick = function() {
    var tmp;
    var newChallengeType = new eventRanking.ChallengeType("0", "", "", "3e jours", "Le moment relax de fin de Mafeking", '100', '#7FFFD4');
    dialogBoxes.open('newChallengeType', newChallengeType.getFormElem(), "Nouveau type d'épreuve");
  };
  aLink.appendChild(document.createTextNode("nouveau"));
  liLink.appendChild(aLink);
  
  ulChallengeTypes.appendChild(liLink);
  return ulChallengeTypes;
};
eventRanking.graphics.listChallenges = function() {
  var it1;
  var ulChallengeslist = document.createElement('ul');
  var challengesOrdered = eventRanking.getOrderedChallenges();
  for(it1 = 1; it1 < eventRanking.getNewPos(challengesOrdered); it1++) {
    var id = challengesOrdered[it1].id;
    var liChallenge = document.createElement('li');
    var spanChallenge = challengesOrdered[it1].getListElem2();
    
    var aMoveUp          = document.createElement('a');
    aMoveUp.dataset.id   = id;
    aMoveUp.className    = 'button moveup';
    aMoveUp.appendChild(document.createTextNode('moveup'));
    aMoveUp.onclick      = eventRanking.graphics.moveUpChallenge;
    
    var aMoveDown        = document.createElement('a');
    aMoveDown.className  = 'button movedown';
    aMoveDown.dataset.id = id;
    aMoveDown.onclick    = eventRanking.graphics.moveDownChallenge;
    aMoveDown.appendChild(document.createTextNode('movedown'));
    
    
    var aEdit            = document.createElement('a');
    aEdit.dataset.id     = id;
    aEdit.className      = 'button edit';
    aEdit.appendChild(document.createTextNode('edit'));
    aEdit.onclick        = eventRanking.graphics.openEditChallenge;
    
    var aDelete = document.createElement('a');
    aDelete.dataset.id   = id;
    aDelete.className    = 'button delete';
    aDelete.appendChild(document.createTextNode('delete'));
    aDelete.onclick = eventRanking.graphics.deleteChallengeEvent;
    
    spanChallenge.appendChild(aMoveUp);
    spanChallenge.appendChild(aMoveDown);
    spanChallenge.appendChild(aEdit);
    spanChallenge.appendChild(aDelete);
    liChallenge.appendChild(spanChallenge);
    ulChallengeslist.appendChild(liChallenge);
  }
  var liLink = document.createElement('li');
  var aLink  = document.createElement('a');
  aLink.onclick = function() {
    var tmp;
    var newChallenge = new eventRanking.Challenge("0", "", "", "Karting", "1", 1, 1);
    dialogBoxes.open('newChallengeType', newChallenge.getFormElem(), "Nouvelle épreuve");
  };
  aLink.appendChild(document.createTextNode("nouveau"));
  liLink.appendChild(aLink);
  
  ulChallengeslist.appendChild(liLink);
  return ulChallengeslist;
};
eventRanking.graphics.listCategories = function() {
  var it1;
  var ulCategoriesList = document.createElement('ul');
  var orderedCategories = eventRanking.getOrderedCategories();
  for(it1 = 1; it1 < eventRanking.getNewPos(orderedCategories); it1++) {
    var id = orderedCategories[it1].id;
    var liCategory = document.createElement('li');
    var spanCategory = orderedCategories[it1].getListElem();
    
    var aMoveUp        = document.createElement('a');
    aMoveUp.dataset.id = id;
    aMoveUp.className  = 'button moveup';
    aMoveUp.appendChild(document.createTextNode('moveup'));
    aMoveUp.onclick    = eventRanking.graphics.moveUpCategory;
    
    var aMoveDown        = document.createElement('a');
    aMoveDown.dataset.id = id;
    aMoveDown.className  = 'button movedown';
    aMoveDown.appendChild(document.createTextNode('movedown'));
    aMoveDown.onclick    = eventRanking.graphics.moveDownCategory;
    
    var aEdit = document.createElement('a');
    aEdit.dataset.id = id;
    aEdit.className  = 'button edit';
    aEdit.appendChild(document.createTextNode('edit'));
    aEdit.onclick = eventRanking.graphics.openEditCategory;
    
    var aDelete = document.createElement('a');
    aDelete.dataset.id = id;
    aDelete.className  = 'button delete';
    aDelete.appendChild(document.createTextNode('delete'));
    aDelete.onclick = eventRanking.graphics.deleteCategoryEvent;
    
    spanCategory.appendChild(aMoveUp);
    spanCategory.appendChild(aMoveDown);
    spanCategory.appendChild(aEdit);
    spanCategory.appendChild(aDelete);
    liCategory.appendChild(spanCategory);
    ulCategoriesList.appendChild(liCategory);
  }
  var liLink = document.createElement('li');
  var aLink  = document.createElement('a');
  aLink.onclick = function() {
    var tmp;
    var newCategory = new eventRanking.Category("0", "", "", "Scouts", '#B0C4DE');
    dialogBoxes.open('newCategory', newCategory.getFormElem(), 'Nouvelle catégorie');
  };
  aLink.appendChild(document.createTextNode("nouveau"));
  liLink.appendChild(aLink);
  
  ulCategoriesList.appendChild(liLink);
  return ulCategoriesList;
};
eventRanking.graphics.listGroups = function() {
  var it1;
  var ulGroupsList = document.createElement('ul');
  var orderedGroups = eventRanking.getOrderedGroups();
  for(it1 = 1; it1 < eventRanking.getNewPos(orderedGroups); it1++) {
    var id = orderedGroups[it1].id;
    var liGroups = document.createElement('li');
    var spanGroups = orderedGroups[it1].getListElem();
    
    var aMoveUp        = document.createElement('a');
    aMoveUp.dataset.id = id;
    aMoveUp.className  = 'button moveup';
    aMoveUp.appendChild(document.createTextNode('moveup'));
    aMoveUp.onclick    = eventRanking.graphics.moveUpGroup;
    
    var aMoveDown        = document.createElement('a');
    aMoveDown.dataset.id = id;
    aMoveDown.className  = 'button movedown';
    aMoveDown.appendChild(document.createTextNode('movedown'));
    aMoveDown.onclick    = eventRanking.graphics.moveDownGroup;
    
    var aEdit = document.createElement('a');
    aEdit.dataset.id = id;
    aEdit.className  = 'button edit';
    aEdit.appendChild(document.createTextNode('edit'));
    aEdit.onclick = eventRanking.graphics.openEditGroup;
    
    var aDelete = document.createElement('a');
    aDelete.dataset.id = id;
    aDelete.className  = 'button delete';
    aDelete.appendChild(document.createTextNode('delete'));
    aDelete.onclick = eventRanking.graphics.deleteGroupEvent;
    
    spanGroups.appendChild(aMoveUp);
    spanGroups.appendChild(aMoveDown);
    spanGroups.appendChild(aEdit);
    spanGroups.appendChild(aDelete);
    liGroups.appendChild(spanGroups);
    ulGroupsList.appendChild(liGroups);
  }
  var liLink = document.createElement('li');
  var aLink  = document.createElement('a');
  aLink.onclick = function() {
    var tmp;
    var newGroup = new eventRanking.Group("0", "", "", "La Malaise", "SV042", 1, "Les grosses nouilles") 
    dialogBoxes.open('newCategory', newGroup.getFormElem(), 'Nouvelle troupe/compagnie');
  };
  aLink.appendChild(document.createTextNode("nouveau"));
  liLink.appendChild(aLink);
  
  ulGroupsList.appendChild(liLink);
  return ulGroupsList;
};
eventRanking.graphics.listTeams = function() {
  var it1;
  var ulTeamsList = document.createElement('ul');
  var orderedTeams = eventRanking.getOrderedTeams();
  for(it1 = 1; it1 < eventRanking.getNewPos(orderedTeams); it1++) {
    var id = orderedTeams[it1].id;
    var liTeams = document.createElement('li');
    var spanTeams = orderedTeams[it1].getListElem();
    
    var aMoveUp        = document.createElement('a');
    aMoveUp.dataset.id = id;
    aMoveUp.className  = 'button moveup';
    aMoveUp.appendChild(document.createTextNode('moveup'));
    aMoveUp.onclick    = eventRanking.graphics.moveUpTeam;
    
    var aMoveDown        = document.createElement('a');
    aMoveDown.dataset.id = id;
    aMoveDown.className  = 'button movedown';
    aMoveDown.appendChild(document.createTextNode('movedown'));
    aMoveDown.onclick    = eventRanking.graphics.moveDownTeam;
    
    var aEdit = document.createElement('a');
    aEdit.dataset.id = id;
    aEdit.className  = 'button edit';
    aEdit.appendChild(document.createTextNode('edit'));
    aEdit.onclick = eventRanking.graphics.openEditTeam;
    
    var aDelete = document.createElement('a');
    aDelete.dataset.id = id;
    aDelete.className  = 'button delete';
    aDelete.appendChild(document.createTextNode('delete'));
    aDelete.onclick = eventRanking.graphics.deleteTeamEvent;
    
    spanTeams.appendChild(aMoveUp);
    spanTeams.appendChild(aMoveDown);
    spanTeams.appendChild(aEdit);
    spanTeams.appendChild(aDelete);
    liTeams.appendChild(spanTeams);
    ulTeamsList.appendChild(liTeams);
  }
  var liLink = document.createElement('li');
  var aLink  = document.createElement('a');
  aLink.onclick = function() {
    var tmp;
    var newTeam = new eventRanking.Team("0", "", "", "Loutre", 1, 7) 
    dialogBoxes.open('newCategory', newTeam.getFormElem(), 'Nouvelle équipe');
  };
  aLink.appendChild(document.createTextNode("nouveau"));
  liLink.appendChild(aLink);
  
  ulTeamsList.appendChild(liLink);
  return ulTeamsList;
};


eventRanking.graphics.menuScores = function() {
  var eUl  = document.createElement('ul');
  var eLi1 = document.createElement('li');
  var eLi2 = document.createElement('li');
  var eLi3 = document.createElement('li');
  
  var eLi4 = document.createElement('li');
  
  eUl.className = "lineList";
  
  if(eventRanking.graphics.displayOnly != true) {
    eLi1.appendChild(document.createTextNode("Éditer"));
    if(eventRanking.graphics.tableSubview == "edit")       eLi1.className = "selectedTab";
    eLi1.onclick = function() {    eventRanking.graphics.tableSubview = "edit";           eventRanking.graphics.refresh();  };
    eLi2.appendChild(document.createTextNode("Voir (calculé)"));
    if(eventRanking.graphics.tableSubview == "view")       eLi2.className = "selectedTab";
    eLi2.onclick = function() {    eventRanking.graphics.tableSubview = "view";           eventRanking.graphics.refresh();  };
    eLi3.appendChild(document.createTextNode("Points spéciaux"));
    if(eventRanking.graphics.tableSubview == "type")       eLi3.className = "selectedTab";
    eLi3.onclick = function() {    eventRanking.graphics.tableSubview = "type";           eventRanking.graphics.refresh();  };
    eUl.appendChild(eLi1);
    eUl.appendChild(eLi2);
    eUl.appendChild(eLi3);
  }
  
  eLi4.appendChild(document.createTextNode("Filtres"));
  eLi4.onclick = eventRanking.graphics.openEditFilters;
  eUl.appendChild(eLi4);
  return eUl;
};



eventRanking.graphics.tableScores = function() {
  // check if there is enough data...
  if (eventRanking.getMaxId(eventRanking.teams) > 0 &&
      eventRanking.getMaxId(eventRanking.challengeTypes) > 0 &&
      eventRanking.getMaxId(eventRanking.challenges) > 0 &&
      eventRanking.getMaxId(eventRanking.groups) > 0 &&
      eventRanking.getMaxId(eventRanking.categories) > 0 &&
      eventRanking.getMaxId(eventRanking.formulae) > 0) {
  
    var it1, it2;
    var scoreTable = eventRanking.scoreFilters.createScoresTable();
    scoreTable     = eventRanking.scoreFilters.sortRankingTable(scoreTable);
    scoreTable     = eventRanking.scoreFilters.orderChallenges(scoreTable);
    scoreTable     = eventRanking.scoreFilters.hideElements(scoreTable);
    
    var eTable   = document.createElement('table');
    var eTr = document.createElement('tr');
    if(scoreTable[0] != undefined){
      eTr.appendChild(scoreTable[0].team.titleElem);
      for (it2=0; it2<scoreTable[0].scores.length; it2++) {
        if(scoreTable[0].scores[it2] != undefined) {
          if(eventRanking.graphics.tableSubview == 'view' && scoreTable[0].scores[it2].viewElem != undefined) eTr.appendChild(scoreTable[0].scores[it2].titleElem);
          if(eventRanking.graphics.tableSubview == 'edit' && scoreTable[0].scores[it2].editElem != undefined) eTr.appendChild(scoreTable[0].scores[it2].titleElem);
          if(eventRanking.graphics.tableSubview == 'type' && scoreTable[0].scores[it2].typeElem != undefined) eTr.appendChild(scoreTable[0].scores[it2].titleElem);
        }
      }
      eTable.appendChild(eTr);
      for (it1=0; it1<scoreTable.length; it1++) {
        if(scoreTable[it1] != undefined) {
          eTr = document.createElement('tr');
          eTr.appendChild(scoreTable[it1].team.tableElem);
          for (it2=0; it2<scoreTable[it1].scores.length; it2++) {
            if(scoreTable[0].scores[it2] != undefined) {
              if(eventRanking.graphics.tableSubview == 'view' && scoreTable[it1].scores[it2].viewElem != undefined) eTr.appendChild(scoreTable[it1].scores[it2].viewElem);
              if(eventRanking.graphics.tableSubview == 'edit' && scoreTable[it1].scores[it2].editElem != undefined) eTr.appendChild(scoreTable[it1].scores[it2].editElem);
              if(eventRanking.graphics.tableSubview == 'type' && scoreTable[it1].scores[it2].typeElem != undefined) eTr.appendChild(scoreTable[it1].scores[it2].typeElem);
            }
          }
          eTable.appendChild(eTr);
        }
      }
    }
    return eTable
  }
  else {
    return document.createTextNode('Erreur : Il reste des éléments à encoder pour pouvoir afficher le classement.');
  }
};



eventRanking.graphics.setEventInfoEvent = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  var id             = target.elements.namedItem("id").value;
  var name           = target.elements.namedItem("name").value;
  var date           = target.elements.namedItem("date").value;
  var location       = target.elements.namedItem("location").value;
  var description    = target.elements.namedItem("description").value;
  eventRanking.setEventInfo(id, name, date, description, location);
  eventRanking.graphics.refresh();
  eventRanking.storage.setInHistory();
};


eventRanking.graphics.moveUpFormula           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.formulae[target.dataset.id].moveUp();
  eventRanking.graphics.refresh();
  eventRanking.storage.setInHistory();
};
eventRanking.graphics.moveDownFormula           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.formulae[target.dataset.id].moveDown();
  eventRanking.graphics.refresh();
  eventRanking.storage.setInHistory();
};
eventRanking.graphics.setFormulaEvent = function (e) {
  var ev        = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target    = ev.target || ev.srcElement;
  var id        = target.elements.namedItem("id").value;
  var pos       = target.elements.namedItem("pos").value;
  var name      = target.elements.namedItem("name").value;
  var formula   = target.elements.namedItem("formula").value;  
  var format    = target.elements.namedItem("format").value;
  
  eventRanking.setScoresToFormulaFormat(id, format);
  
  eventRanking.addFormula(id, pos, name, formula, format);
  eventRanking.graphics.refresh();
  eventRanking.storage.setInHistory();
};
eventRanking.graphics.deleteFormulaEvent  = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  eventRanking.formulae[target.dataset.id].delete();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.openEditFormula = function(e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editFormula'+target.dataset.id, eventRanking.formulae[target.dataset.id].getFormElem(), "Edition de : "+eventRanking.formulae[target.dataset.id].name);
};


eventRanking.graphics.moveUpChallengeType           = function (e) {
  var ev = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.challengeTypes[target.dataset.id].moveUp();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.moveDownChallengeType           = function (e) {
  var ev = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.challengeTypes[target.dataset.id].moveDown();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.setChallengeTypeEvent = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  var id             = target.elements.namedItem("id").value;
  var pos            = target.elements.namedItem("pos").value;
  var name           = target.elements.namedItem("name").value;
  var description    = target.elements.namedItem("description").value;
  var ptMax          = target.elements.namedItem("ptMax").value;
  var color          = target.elements.namedItem("color").value;  
  eventRanking.addChallengeType(id, pos, name, description, ptMax, color);
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.deleteChallengeTypeEvent  = function (e) {
  var ev = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  eventRanking.challengeTypes[target.dataset.id].delete();
  eventRanking.graphics.refresh();
  eventRanking.storage.setInHistory();
};
eventRanking.graphics.openEditChallengeType = function(e) {
  var ev = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editChallengeType'+target.dataset.id, eventRanking.challengeTypes[target.dataset.id].getFormElem(), "Edition de : "+eventRanking.challengeTypes[target.dataset.id].name);
};


eventRanking.graphics.moveUpChallenge           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.challenges[target.dataset.id].moveUp();
  eventRanking.graphics.refresh();
  eventRanking.storage.setInHistory();
};
eventRanking.graphics.moveDownChallenge           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.challenges[target.dataset.id].moveDown();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.setChallengeEvent = function (e) {
  var ev        = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target    = ev.target || ev.srcElement;
  var id        = target.elements.namedItem("id").value;
  var pos       = target.elements.namedItem("pos").value;
  var name      = target.elements.namedItem("name").value;
  var ptMax     = target.elements.namedItem("ptMax").value;  
  var typeId    = target.elements.namedItem("typeId").value;  
  var formulaId = target.elements.namedItem("formulaId").value;
  eventRanking.setScoresToChallengeFormula(id, formulaId)
  eventRanking.addChallenge(id, pos, name, ptMax, typeId, formulaId);
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.deleteChallengeEvent  = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  eventRanking.challenges[target.dataset.id].delete();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.openEditChallenge = function(e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editChallenge'+target.dataset.id, eventRanking.challenges[target.dataset.id].getFormElem(), "Edition de : "+eventRanking.challenges[target.dataset.id].name);
};



eventRanking.graphics.moveUpCategory           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.categories[target.dataset.id].moveUp();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.moveDownCategory           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.categories[target.dataset.id].moveDown();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.setCategoryEvent = function (e) {
  var ev        = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target    = ev.target || ev.srcElement;
  var id             = target.elements.namedItem("id").value;
  var pos            = target.elements.namedItem("pos").value;
  var name           = target.elements.namedItem("name").value;
  var color          = target.elements.namedItem("color").value;  
  eventRanking.addCategory(id, pos, name, color);
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.deleteCategoryEvent  = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  eventRanking.categories[target.dataset.id].delete();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.openEditCategory = function(e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editCategory'+target.dataset.id, eventRanking.categories[target.dataset.id].getFormElem(), "Edition de : "+eventRanking.categories[target.dataset.id].name);
};


eventRanking.graphics.moveUpGroup           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.groups[target.dataset.id].moveUp();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.moveDownGroup           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.groups[target.dataset.id].moveDown();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.setGroupEvent = function (e) {
  var ev        = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target    = ev.target || ev.srcElement;
  var id             = target.elements.namedItem("id").value;
  var pos            = target.elements.namedItem("pos").value;
  var name           = target.elements.namedItem("name").value;
  var number         = target.elements.namedItem("number").value;  
  var category       = target.elements.namedItem("category").value;  
  var description    = target.elements.namedItem("description").value;  
  eventRanking.addGroup(id, pos, name, number, category, description);
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.deleteGroupEvent  = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  eventRanking.groups[target.dataset.id].delete();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.openEditGroup = function(e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editGroup'+target.dataset.id, eventRanking.groups[target.dataset.id].getFormElem(), "Edition de : "+eventRanking.groups[target.dataset.id].name);
};



eventRanking.graphics.moveUpTeam           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.teams[target.dataset.id].moveUp();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.moveDownTeam           = function (e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  eventRanking.teams[target.dataset.id].moveDown();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.setTeamEvent = function (e) {
  var ev        = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target    = ev.target || ev.srcElement;
  var id        = target.elements.namedItem("id").value;
  var name      = target.elements.namedItem("name").value;
  var pos       = target.elements.namedItem("pos").value;  
  var group     = target.elements.namedItem("group").value;  
  var playersNb = target.elements.namedItem("playersNb").value;  
  eventRanking.addTeam(id, pos, name, group, playersNb);
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.deleteTeamEvent  = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  eventRanking.teams[target.dataset.id].delete();
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};
eventRanking.graphics.openEditTeam = function(e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editTeam'+target.dataset.id, eventRanking.teams[target.dataset.id].getFormElem(), "Edition de : "+eventRanking.teams[target.dataset.id].name);
};


eventRanking.graphics.setScoreEvent = function(e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  var elemId = target.getAttribute('id');
  var elemType = 'form';
  if(target.nodeName == 'INPUT' || target.nodeName == 'SELECT') {
    target = target.form;
    elemType = 'input';
  }
  var format = target.elements['format'].value;
  var value = eventRanking.scoreFormats[format].getFormatedValue(target);
  eventRanking.scores[target.elements['id'].value].value = value;
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
  if(elemType == 'input') {
    var tabableElems  = document.getElementsByClassName('tabable');
    var tabableLength = tabableElems.length-1;
    var it1 = 0, isSameElem = 0, newElemId = elemId;
   
    for (it1 = 0; it1 < tabableLength; it1++) {
      if(tabableElems[it1].getAttribute('id') == elemId) newElemId = tabableElems[it1+1].getAttribute('id');
    }
    document.getElementById(newElemId).focus();
  }
  else if (elemType == 'form') {
    var newElemId = 0;
    if (target.elements['int']   != undefined)  newElemId = target.elements['int'].id;
    if (target.elements['float'] != undefined)  newElemId = target.elements['float'].id;
    if (target.elements['hour']  != undefined)  newElemId = target.elements['hour'].id;
    if (target.elements['hour1'] != undefined)  newElemId = target.elements['hour1'].id;
    
    if(newElemId != 0) document.getElementById(newElemId).focus();
  }
};
eventRanking.graphics.setScoreTypeEvent = function(e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  if(target.nodeName == 'INPUT' || target.nodeName == 'SELECT') target = target.form;
  var type = target.elements['format'].value;
  eventRanking.scores[target.elements['id'].value].type = type;
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
};


eventRanking.graphics.setTableOrdering = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  if(eventRanking.graphics.ordering == target.dataset.ordering && eventRanking.scoreFilters.reversedTeamOrder == false) {
    eventRanking.scoreFilters.reversedTeamOrder = true;
  }
  else {
    eventRanking.scoreFilters.reversedTeamOrder = false;
  }
  eventRanking.graphics.ordering = target.dataset.ordering;
  eventRanking.graphics.refresh();
};

eventRanking.graphics.openEditFilters = function(e) {
  var ev     = e || window.event;
  var target = ev.target || ev.srcElement;
  dialogBoxes.open('editFilters', eventRanking.scoreFilters.getFormElem(), "Edition du filtre des Scores");
};

eventRanking.graphics.setFiltersEvents = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  if(target.nodeName == 'INPUT' || target.nodeName == 'SELECT') target = target.form;
  eventRanking.scoreFilters.challengeOrder             = target.elements['scoreOrder'].value;
  eventRanking.scoreFilters.reversedChallengeOrder     = target.elements['isReversedChallenge'].checked;
  eventRanking.scoreFilters.reversedChallengeTypeOrder = target.elements['isReversedChallengeType'].checked;
  eventRanking.scoreFilters.showChallenges             = target.elements['showChallenges'].checked;
  eventRanking.scoreFilters.showChallengeTypes         = target.elements['showChallengeTypes'].checked;
  eventRanking.scoreFilters.showTotal                  = target.elements['showTotal'].checked;
  eventRanking.scoreFilters.hiddenChallengeTypes = [];
  var it1;
  var orderedChallengeType = eventRanking.getOrderedChallengeTypes();
  var nbChallengeTypes     = orderedChallengeType.length;
  for(it1=1; it1<nbChallengeTypes; it1++) {
    if(orderedChallengeType[it1] != undefined) {
      if(target.elements['isHiddenChallengeType'+orderedChallengeType[it1].id].checked == 0) {
  eventRanking.scoreFilters.hiddenChallengeTypes.push(orderedChallengeType[it1].id);
      }
    }
  }
  eventRanking.scoreFilters.hiddenCategories = [];
  var orderedCategories = eventRanking.getOrderedCategories();
  var nbCategories      = orderedCategories.length;
  for(it1=0; it1<nbCategories; it1++) {
    if(orderedCategories[it1] != undefined) {
      if(target.elements['isHiddenCategory'+orderedCategories[it1].id].checked == 0) {
  eventRanking.scoreFilters.hiddenCategories.push(orderedCategories[it1].id);
      }
    }
  }
//   eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
  
};







eventRanking.EventInfo.prototype.setName          = function (name)        {this.name        = name;       };
eventRanking.EventInfo.prototype.setEventDate     = function (date)        {this.date        = date;       };
eventRanking.EventInfo.prototype.setLocation      = function (location)    {this.location    = location;   };
eventRanking.EventInfo.prototype.setDescrption    = function (description) {this.description = description;};
// eventRanking.EventInfo.prototype.reset            = function (id,name,location,description) {
//   this.id          = id;
//   this.name        = name;
//   this.date        = date;
//   this.location    = location;
//   this.description = description;
// };
eventRanking.EventInfo.prototype.getData          = function () {
  return {id:this.id, name:this.name, date:this.date, location:this.location, description:this.description};
};

  
eventRanking.Formula.prototype.setName          = function (name)       {this.name    = name;      };
eventRanking.Formula.prototype.setFormula       = function (formula)    {this.formula = formula;   };
eventRanking.Formula.prototype.setFormat        = function (format)     {this.format  = format;    };
eventRanking.Formula.prototype.getData          = function () {
  return {id:this.id, pos:this.pos, name:this.name, formula:this.formula, format:this.format};
};
eventRanking.Formula.prototype.moveUp           = function () {
  if (this.pos > 1) {
    var pos = this.pos;
    var orderedFormulae = eventRanking.getOrderedFormulae();
    var otherId = orderedFormulae[pos-1].id;
    eventRanking.formulae[otherId].pos = pos;
    this.pos = pos-1;
  }
};
eventRanking.Formula.prototype.moveDown         = function () {
  if (this.pos < eventRanking.getMaxPos(eventRanking.formulae)) {
    var pos = this.pos;
    var orderedFormulae = eventRanking.getOrderedFormulae();
    var otherId = orderedFormulae[pos+1].id;
    eventRanking.formulae[otherId].pos = pos;
    this.pos = pos+1;
  }
};
eventRanking.Formula.prototype.delete = function () {
  var pos = this.pos;
  var it1;
  for(it1 in eventRanking.formulae) {
    if(eventRanking.formulae[it1] != undefined) if(eventRanking.formulae[it1].pos > pos) eventRanking.formulae[it1].pos = eventRanking.formulae[it1].pos-1;
  }
  eventRanking.formulae[this.id] = undefined;
};


eventRanking.ChallengeType.prototype.setName          = function (name)       {this.name        = name;         };
eventRanking.ChallengeType.prototype.setPos           = function (pos)        {this.pos         = pos;          };
eventRanking.ChallengeType.prototype.setColor         = function (color)      {this.color       = color;        };
eventRanking.ChallengeType.prototype.setDescription   = function (description){this.description = description;};
eventRanking.ChallengeType.prototype.setPtMax         = function (ptMax)      {this.ptMax       = ptMax;      };
eventRanking.ChallengeType.prototype.getData          = function () {
  return {id:this.id, pos:this.pos, name:this.name, description:this.description, ptMax:this.ptMax, color:this.color};
};
eventRanking.ChallengeType.prototype.moveUp           = function () {
  if (this.pos > 1) {
    var pos = this.pos;
    var challengeTypes = eventRanking.getOrderedChallengeTypes();
    var otherId = challengeTypes[pos-1].id;
    eventRanking.challengeTypes[otherId].pos = pos;
    this.pos = pos-1;
  }
};
eventRanking.ChallengeType.prototype.moveDown         = function () {
  if (this.pos < eventRanking.getMaxPos(eventRanking.challengeTypes)) {
    var pos = this.pos;
    var challengeTypes = eventRanking.getOrderedChallengeTypes();
    var otherId = challengeTypes[pos+1].id;
    eventRanking.challengeTypes[otherId].pos = pos;
    this.pos = pos+1;
  }
};
eventRanking.ChallengeType.prototype.delete = function () {
  var pos = this.pos;
  var it1;
  for(it1 in eventRanking.challengeTypes) {
    if(eventRanking.challengeTypes[it1] != undefined) if(eventRanking.challengeTypes[it1].pos > pos) eventRanking.challengeTypes[it1].pos = eventRanking.challengeTypes[it1].pos-1;
  }
  eventRanking.challengeTypes[this.id] = undefined;
};

eventRanking.Challenge.prototype.setName          = function (name)       {this.name      = name;      };
eventRanking.Challenge.prototype.setPos           = function (pos)        {this.pos         = pos;          };
eventRanking.Challenge.prototype.setPtMax         = function (ptMax)      {this.ptMax     = ptMax;     };
eventRanking.Challenge.prototype.setTypeId        = function (typeId)     {this.typeId    = typeId;    };
eventRanking.Challenge.prototype.setFormulaId     = function (formulaId)  {this.formulaId = formulaId  };
eventRanking.Challenge.prototype.getData          = function () {
  return {id:this.id, pos:this.pos, name:this.name, ptMax:this.ptMax, typeId:this.typeId, formulaId:this.formulaId};
};
eventRanking.Challenge.prototype.moveUp           = function () {
  if (this.pos > 1) {
    var pos = this.pos;
    var orderedChallenges = eventRanking.getOrderedChallenges();
    var otherId = orderedChallenges[pos-1].id;
    eventRanking.challenges[otherId].pos = pos;
    this.pos = pos-1;
  }
};
eventRanking.Challenge.prototype.moveDown         = function () {
  if (this.pos < eventRanking.getMaxPos(eventRanking.challenges)) {
    var pos = this.pos;
    var orderedChallenges = eventRanking.getOrderedChallenges();
    var otherId = orderedChallenges[pos+1].id;
    eventRanking.challenges[otherId].pos = pos;
    this.pos = pos+1;
  }
};
eventRanking.Challenge.prototype.delete = function () {
  var pos = this.pos;
  var it1;
  for(it1 in eventRanking.challenges) {
    if(eventRanking.challenges[it1] != undefined) if(eventRanking.challenges[it1].pos > pos) eventRanking.challenges[it1].pos = eventRanking.challenges[it1].pos-1;
  }
  eventRanking.challenges[this.id] = undefined;
};

  
eventRanking.Category.prototype.setName          = function (name)        {this.name        = name;      };
eventRanking.Category.prototype.setPos           = function (pos)        {this.pos         = pos;          };
eventRanking.Category.prototype.setColor         = function (color)       {this.color       = color;     };
eventRanking.Category.prototype.getData          = function () {
  return {id:this.id, pos:this.pos, name:this.name, color:this.color};
};
eventRanking.Category.prototype.moveUp           = function () {
  if (this.pos > 1) {
    var pos = this.pos;
    var orderedCategories = eventRanking.getOrderedCategories();
    var otherId = orderedCategories[pos-1].id;
    eventRanking.categories[otherId].pos = pos;
    this.pos = pos-1;
  }
};
eventRanking.Category.prototype.moveDown         = function () {
  if (this.pos < eventRanking.getMaxPos(eventRanking.categories)) {
    var pos = this.pos;
    var orderedCategories = eventRanking.getOrderedCategories();
    var otherId = orderedCategories[pos+1].id;
    eventRanking.categories[otherId].pos = pos;
    this.pos = pos+1;
  }
};
eventRanking.Category.prototype.delete = function () {
  var pos = this.pos;
  var it1;
  for(it1 in eventRanking.categories) {
    if(eventRanking.categories[it1] != undefined) if(eventRanking.categories[it1].pos > pos) eventRanking.categories[it1].pos = eventRanking.categories[it1].pos-1;
  }
  eventRanking.categories[this.id] = undefined;
};


eventRanking.Group.prototype.setname          = function (name)        {this.name        = name;       };
eventRanking.Group.prototype.setPos           = function (pos)        {this.pos         = pos;          };
eventRanking.Group.prototype.setNumber        = function (number)      {this.number      = number;     };
eventRanking.Group.prototype.setCategory      = function (category)    {this.category    = category;   };
eventRanking.Group.prototype.setDescription   = function (description) {this.description = description;};
eventRanking.Group.prototype.getData          = function () {
  return {id:this.id, pos:this.pos, name:this.name, number:this.number, category:this.category, description:this.description};
};
eventRanking.Group.prototype.moveUp           = function () {
  if (this.pos > 1) {
    var pos = this.pos;
    var orderedGroups = eventRanking.getOrderedGroups();
    var otherId = orderedGroups[pos-1].id;
    eventRanking.groups[otherId].pos = pos;
    this.pos = pos-1;
  }
};
eventRanking.Group.prototype.moveDown         = function () {
  if (this.pos < eventRanking.getMaxPos(eventRanking.groups)) {
    var pos = this.pos;
    var orderedGroups = eventRanking.getOrderedGroups();
    var otherId = orderedGroups[pos+1].id;
    eventRanking.groups[otherId].pos = pos;
    this.pos = pos+1;
  }
};
eventRanking.Group.prototype.delete = function () {
  var pos = this.pos;
  var it1;
  for(it1 in eventRanking.groups) {
    if(eventRanking.groups[it1] != undefined) if(eventRanking.groups[it1].pos > pos) eventRanking.groups[it1].pos = eventRanking.groups[it1].pos-1;
  }
  eventRanking.groups[this.id] = undefined;
};


eventRanking.Team.prototype.setName          = function (name)       {this.name      = name;      };
eventRanking.Team.prototype.setGroup         = function (group)      {this.groups    = groups;    };
eventRanking.Team.prototype.setPlayersNb     = function (playersNb)  {this.playersNb = playersNb; };
eventRanking.Team.prototype.getData          = function () {
  return {id:this.id, pos:this.pos, name:this.name, group:this.group, playersNb:this.playersNb};
};
eventRanking.Team.prototype.moveUp           = function () {
  if (this.pos > 1) {
    var pos = this.pos;
    var orderedTeams = eventRanking.getOrderedTeams();
    var otherId = orderedTeams[pos-1].id;
    eventRanking.teams[otherId].pos = pos;
    this.pos = pos-1;
  }
};
eventRanking.Team.prototype.moveDown         = function () {
  if (this.pos < eventRanking.getMaxPos(eventRanking.teams)) {
    var pos = this.pos;
    var orderedTeams = eventRanking.getOrderedTeams();
    var otherId = orderedTeams[pos+1].id;
    eventRanking.teams[otherId].pos = pos;
    this.pos = pos+1;
  }
};
eventRanking.Team.prototype.delete = function () {
  var pos = this.pos;
  var it1;
  for(it1 in eventRanking.teams) {
    if(eventRanking.teams[it1] != undefined) if(eventRanking.teams[it1].pos > pos) eventRanking.teams[it1].pos = eventRanking.teams[it1].pos-1;
  }
  eventRanking.teams[this.id] = undefined;
};


  

eventRanking.Score.prototype.setValue         = function (value)       {this.value       = value;     };
eventRanking.Score.prototype.getData          = function () {
  return {id:this.id, teamId:this.teamId, challengeId:this.challengeId, value:this.value, type:this.type};
};



eventRanking.storage.setCookie = function(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
};
eventRanking.storage.getCookie = function (cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
    }
    return "";
};


eventRanking.storage.getJSON      = function () {
  var it1;
  var tmp               = {};
  tmp.eventInfo         = eventRanking.eventsInfo.getData();
  tmp.teams             = [];
  tmp.challengeTypes    = [];
  tmp.challenges        = [];
  tmp.groups            = [];
  tmp.categories        = [];
  tmp.formulae          = [];
  tmp.scores            = [];
  for (it1 in eventRanking.formulae      ) {if(eventRanking.formulae[it1]       != null && eventRanking.formulae[it1]       != undefined) if(eventRanking.formulae[it1].eventId       == eventRanking.actualEventId) tmp.formulae[it1]       = eventRanking.formulae[it1].getData();}
  for (it1 in eventRanking.challengeTypes) {if(eventRanking.challengeTypes[it1] != null && eventRanking.challengeTypes[it1] != undefined) if(eventRanking.challengeTypes[it1].eventId == eventRanking.actualEventId) tmp.challengeTypes[it1] = eventRanking.challengeTypes[it1].getData();}
  for (it1 in eventRanking.challenges    ) {if(eventRanking.challenges[it1]     != null && eventRanking.challenges[it1]     != undefined) if(eventRanking.challenges[it1].eventId     == eventRanking.actualEventId) tmp.challenges[it1]     = eventRanking.challenges[it1].getData();}
  for (it1 in eventRanking.categories    ) {if(eventRanking.categories[it1]     != null && eventRanking.categories[it1]     != undefined) if(eventRanking.categories[it1].eventId     == eventRanking.actualEventId) tmp.categories[it1]     = eventRanking.categories[it1].getData();}
  for (it1 in eventRanking.groups        ) {if(eventRanking.groups[it1]         != null && eventRanking.groups[it1]         != undefined) if(eventRanking.groups[it1].eventId         == eventRanking.actualEventId) tmp.groups[it1]         = eventRanking.groups[it1].getData();}
  for (it1 in eventRanking.teams         ) {if(eventRanking.teams[it1]          != null && eventRanking.teams[it1]          != undefined) if(eventRanking.teams[it1].eventId          == eventRanking.actualEventId) tmp.teams[it1]          = eventRanking.teams[it1].getData();}
  for (it1 in eventRanking.scores        ) {if(eventRanking.scores[it1]         != null && eventRanking.scores[it1]         != undefined) if(eventRanking.scores[it1].eventId         == eventRanking.actualEventId) tmp.scores[it1]         = eventRanking.scores[it1].getData();}
  
  return JSON.stringify(tmp);
};
eventRanking.storage.loadJSON         = function(JSONstring) {
  var it1;
  var tmp = JSON.parse(JSONstring);
  eventRanking.setEventInfo(tmp.eventInfo.id, tmp.eventInfo.name,tmp.eventInfo.date, tmp.eventInfo.location,tmp.eventInfo.description);
  eventRanking.teams            = [];
  eventRanking.challengeTypes   = [];
  eventRanking.challenges       = [];
  eventRanking.groups           = [];
  eventRanking.categories       = [];
  eventRanking.formulae         = [];
  eventRanking.scores           = [];
  for (it1 in tmp.formulae)       {if(tmp.formulae[it1]       != null && tmp.formulae[it1]       != undefined) eventRanking.addFormula       (tmp.formulae[it1].id,       tmp.formulae[it1].pos,        tmp.formulae[it1].name,          tmp.formulae[it1].formula,           tmp.formulae[it1].format);}
  for (it1 in tmp.challengeTypes) {if(tmp.challengeTypes[it1] != null && tmp.challengeTypes[it1] != undefined) eventRanking.addChallengeType (tmp.challengeTypes[it1].id, tmp.challengeTypes[it1].pos,  tmp.challengeTypes[it1].name,    tmp.challengeTypes[it1].description, tmp.challengeTypes[it1].ptMax, tmp.challengeTypes[it1].color);}
  for (it1 in tmp.challenges)     {if(tmp.challenges[it1]     != null && tmp.challenges[it1]     != undefined) eventRanking.addChallenge     (tmp.challenges[it1].id,     tmp.challenges[it1].pos,      tmp.challenges[it1].name,        tmp.challenges[it1].ptMax,           tmp.challenges[it1].typeId,    tmp.challenges[it1].formulaId);}
  for (it1 in tmp.categories)     {if(tmp.categories[it1]     != null && tmp.categories[it1]     != undefined) eventRanking.addCategory      (tmp.categories[it1].id,     tmp.categories[it1].pos,      tmp.categories[it1].name,        tmp.categories[it1].color);}
  for (it1 in tmp.groups)         {if(tmp.groups[it1]         != null && tmp.groups[it1]         != undefined) eventRanking.addGroup         (tmp.groups[it1].id,         tmp.groups[it1].pos,          tmp.groups[it1].name,            tmp.groups[it1].number,              tmp.groups[it1].category,      tmp.groups[it1].description);}
  for (it1 in tmp.teams)          {if(tmp.teams[it1]          != null && tmp.teams[it1]          != undefined) eventRanking.addTeam          (tmp.teams[it1].id,          tmp.teams[it1].pos,           tmp.teams[it1].name,             tmp.teams[it1].group,                tmp.teams[it1].playersNb);}
  for (it1 in tmp.scores)         {if(tmp.scores[it1]         != null && tmp.scores[it1]         != undefined) eventRanking.addScore         (tmp.scores[it1].id,         tmp.scores[it1].teamId,       tmp.scores[it1].challengeId,     tmp.scores[it1].value,               tmp.scores[it1].type);}
};

eventRanking.storage.setInHistory = function () {
  eventRanking.storage.setCookie('backup', eventRanking.storage.getJSON(), 7);
  eventRanking.storage.history.unshift(eventRanking.storage.getJSON());
//   eventRanking.storage.history.splice(eventRanking.storage.maxHistoryElem, 10);
  eventRanking.repairScores();
};


eventRanking.storage.newEvent = function () {
  var tmp = {eventInfo:{id:0, name:"Mafeking", date:"Aujourd'hui", location:"Au local", description:"Ce sera SUPER !"}};
  eventRanking.storage.loadJSON(JSON.stringify(tmp));
  eventRanking.storage.setInHistory();
  eventRanking.graphics.refresh();
  dialogBoxes.open('newTableConfirm', document.createTextNode('Nouveau classement généré... Toutes les données ont été nettoyées'), 'Nouveau classement');
};
eventRanking.storage.openEvent = function (e) {
  var ev     = e || window.event;
  if (ev.preventDefault) ev.preventDefault();
  ev.returnValue = false;
  var target = ev.target || ev.srcElement;
  var f      = target.elements.namedItem('loadFile').files[0];  //Retrieve the first (and only!) File from the FileList object
  if (f) {
    var r = new FileReader();
    r.readAsText(f);
    r.onload = function(e) {
      eventRanking.storage.loadJSON(e.target.result);
      eventRanking.storage.setInHistory();
      eventRanking.graphics.refresh(); 
      dialogBoxes.open('newTableConfirm', document.createTextNode('Fichier de classement chargé.'), 'Chargement réussi');

    };
  }
  else { 
    dialogBoxes.open("ErrorMsg", document.createTextNode("Error : Failed to load file."), "Erreur");
  }
};
eventRanking.storage.saveEvent = function () {
//   var url = 'data:text/json;charset=utf8,' + encodeURIComponent(eventRanking.storage.getJSON());
//   window.open(url, '_blank');
//   window.focus();
  var blob = new Blob([eventRanking.storage.getJSON()], {type: "application/json;charset=utf-8"});
  saveAs(blob, "classementMafeking.json");
};


eventRanking.storage.undo = function () {
  if(eventRanking.storage.history.length > 1) {
    if(eventRanking.storage.history[1] != undefined) {
      eventRanking.storage.history.shift();
      eventRanking.storage.loadJSON(eventRanking.storage.history[0]);
      eventRanking.storage.setCookie('backup', eventRanking.storage.getJSON(), 7);
      eventRanking.graphics.refresh();
    }
    else {
      dialogBoxes.open('UndoError', document.createTextNode("Vous êtes au bout de l'historique..."), "Erreur");
    }
  }
  else {
    dialogBoxes.open('UndoError', document.createTextNode("Vous êtes au bout de l'historique..."), "Erreur");
  }
};
eventRanking.storage.restore = function () {
  var backup_value = eventRanking.storage.getCookie('backup');
  if(backup_value != "") {
    eventRanking.storage.loadJSON(backup_value);
    eventRanking.storage.setInHistory();
    eventRanking.graphics.refresh();
  }
  else {
    eventRanking.storage.newEvent();
    dialogBoxes.open('RestoreError', document.createTextNode('Error : No values stored in cookie'), "Erreur");
  }
};


eventRanking.storage.openForm = function () {
  var fOpen = document.createElement('form');
  var iFile = document.createElement('input');
  var iSave = document.createElement('input');
  
  iFile.type   = 'file';
  iFile.name   = 'loadFile';
//   iFile.accept = "application/json|application/x-javascript|text/javascript|text/x-javascript|text/x-json";
  iFile.accept = ".json";
  
  iSave.type   = "submit";
  iSave.value  = "Ouvrir";
  
  fOpen.appendChild(document.createTextNode('Fichier de points : '));
  fOpen.appendChild(iFile);
  fOpen.appendChild(document.createElement('br'));
  fOpen.appendChild(iSave);
  
  fOpen.onsubmit = eventRanking.storage.openEvent;
  
  return fOpen;
};





eventRanking.Formula.prototype.getFormatedValue        = function (floatValue) {
  if (floatValue == undefined) floatValue = 0;
  return eventRanking.scoreFormats[this.format].getFormatedValue(floatValue);
};



eventRanking.ChallengeType.prototype.getPonderationFactor = function () {
  var it1;
  var challengePonderationSum = 0;
  for(it1 in eventRanking.challenges) {
    if(eventRanking.challenges[it1] != undefined) 
    if(eventRanking.challenges[it1].typeId == this.id)
      challengePonderationSum += parseFloat(eventRanking.challenges[it1].ptMax);
  }
  return parseFloat(this.ptMax)/challengePonderationSum;
};


eventRanking.Challenge.prototype.getMinFloatValue      = function () {
  var it1;
  var tmpScores = [];
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined)
    if(eventRanking.scores[it1].challengeId == this.id)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type] != undefined)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate) {
      var formatId = eventRanking.formulae[eventRanking.challenges[eventRanking.scores[it1].challengeId].formulaId].format;
      tmpScores.push(eventRanking.scoreFormats[formatId].getFloat(eventRanking.scores[it1].value));
    }
  }
  if(tmpScores.length > 0) {
    tmpScores.sort(function(a, b){return a-b});
    return tmpScores[0];
  }
  else {
    return 0;
  }
};
eventRanking.Challenge.prototype.getMaxFloatValue      = function () {
  var it1;
  var tmpScores = [];
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined)
    if(eventRanking.scores[it1].challengeId == this.id)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type] != undefined)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate){
      var formatId = eventRanking.formulae[eventRanking.challenges[eventRanking.scores[it1].challengeId].formulaId].format;
      tmpScores.push(eventRanking.scoreFormats[formatId].getFloat(eventRanking.scores[it1].value));
    }
  }
  tmpScores.sort(function(a, b){return b-a});
  return tmpScores[0];
};
eventRanking.Challenge.prototype.getMeanFloatValue     = function () {
  var it1;
  var tmpScores = [];
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined)
    if(eventRanking.scores[it1].challengeId == this.id)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type] != undefined)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate){
      var formatId = eventRanking.formulae[eventRanking.challenges[eventRanking.scores[it1].challengeId].formulaId].format;
      tmpScores.push(eventRanking.scoreFormats[formatId].getFloat(eventRanking.scores[it1].value));
    }
  }
  var scoresSum = 0;
  for (it1 in tmpScores) scoresSum += tmpScores[it1];
  return scoresSum/tmpScores.length;
};
eventRanking.Challenge.prototype.getMedianFloatValue   = function () {
  var it1;
  var tmpScores = [];
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined) 
    if(eventRanking.scores[it1].challengeId == this.id) 
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type] != undefined)
    if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate){
      var formatId = eventRanking.formulae[eventRanking.challenges[eventRanking.scores[it1].challengeId].formulaId].format;
      tmpScores.push(eventRanking.scoreFormats[formatId].getFloat(eventRanking.scores[it1].value));
    }
  }
  if(tmpScores.length > 0) {
    tmpScores.sort(function(a, b){return b-a});
    if(tmpScores.length%2 == 1)
      return tmpScores[(tmpScores.length-1)/2];
    if(tmpScores.length%2 == 0)
      return 0.5*(tmpScores[tmpScores.length/2]+tmpScores[tmpScores.length/2-1]);
  }
  else {
    return 0;
  }
};
eventRanking.Challenge.prototype.getPonderationFactor = function () {
  var it1;
  var tmpScores = [];
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined) 
      if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate)
        if(eventRanking.scores[it1].challengeId == this.id)
          tmpScores.push(eventRanking.scores[it1].evaluate());
  }
  tmpScores.sort(function(a, b){return b-a});
  if (tmpScores[0] == 0) {
    return 0;
  }
  else {
    return parseFloat(this.ptMax)/tmpScores[0];
  }
};



eventRanking.Team.prototype.getTotalScore = function () {
  var it1;
  var totalScore = 0;
  for (it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined)
    if(eventRanking.scores[it1].teamId == this.id)
      totalScore += parseFloat(eventRanking.scores[it1].getPonderatedValue());
  }
  return totalScore;
};
eventRanking.Team.prototype.getSubotalScore = function (challengeType) {
  var it1;
  var subtotalScore = 0;
  for (it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined)
    if(eventRanking.scores[it1].teamId == this.id)
    if(eventRanking.challenges[eventRanking.scores[it1].challengeId] != undefined)
    if(eventRanking.challenges[eventRanking.scores[it1].challengeId].typeId == challengeType)
      subtotalScore += parseFloat(eventRanking.scores[it1].getPonderatedValue());
  }
  return subtotalScore;
};


eventRanking.Score.prototype.getFloatValue    = function () {
  var formatId = eventRanking.formulae[eventRanking.challenges[this.challengeId].formulaId].format;
  return eventRanking.scoreFormats[formatId].getFloat(this.value);
};
eventRanking.Score.prototype.evaluate = function () {
  var formula = eventRanking.formulae[eventRanking.challenges[this.challengeId].formulaId].formula.toLowerCase()
  var min     = eventRanking.challenges[this.challengeId].getMinFloatValue();
  var max     = eventRanking.challenges[this.challengeId].getMaxFloatValue();
  var mean    = eventRanking.challenges[this.challengeId].getMeanFloatValue();
  var med     = eventRanking.challenges[this.challengeId].getMedianFloatValue();
  var players = eventRanking.challenges[this.challengeId].nbPlayers;
  var val     = parseFloat(this.getFloatValue());
  
  formula = formula.replace("min", min);
  formula = formula.replace("max", max);
  formula = formula.replace("mean", mean);
  formula = formula.replace("med", med);
  formula = formula.replace("val", val);
  formula = formula.replace("players", players);
  
  var abs  = function(value1) { return Math.abs(value1);};
  var exp  = function(value1) { return Math.exp(value1);};
  var sqrt = function(value1) { return Math.sqrt(value1);};
  var log  = function(value1) { return Math.log(value1);};
  var pow  = function(value1, value2) { return Math.pow(value1,value2);};
  var sin  = function(value1) { return Math.sin(value1);};
  var cos  = function(value1) { return Math.cos(value1);};
  var tan  = function(value1) { return Math.exp(value1);};
  var asin = function(value1) { return Math.acos(value1);};
  var acos = function(value1) { return Math.asin(value1);};
  var atan = function(value1) { return Math.atan(value1);};
  var pi   =  Math.PI;
  
  
//   console.log(formula);
  
  value = eval(formula);
//   console.log(value);
  
  if (!isNaN(value) && value < 0) {
//     var warning_text = document.createElement('P');
//     warning_text.appendChild(document.createTextNode("Attention ! Les points de l'équipe "));
//     warning_text.appendChild(eventRanking.teams[this.teamId].getListElem());
//     warning_text.appendChild(document.createTextNode(" à l'épreuve "));
//     warning_text.appendChild(eventRanking.challenges[this.challengeId].getListElem());
//     warning_text.appendChild(document.createTextNode(" sont négatif..."));
//     warning_text.appendChild(document.createElement('BR'));
//     warning_text.appendChild(document.createTextNode("Ceci peut mener à des résultats incohérents dans les calculs de points..."));
//     dialogBoxes.open('score'+this.id+'Warning', warning_text, 'Attention ! Possible erreur d\'encodage...');
    console.log("Attention ! Les points de l'équipe "+ eventRanking.teams[this.teamId].name + " à l'épreuve " + eventRanking.challenges[this.challengeId].name + " sont négatif.");
  }
  else if (isNaN(value))  {
//     var warning_text = document.createElement('P');
//     warning_text.appendChild(document.createTextNode("Attention ! Les points de l'équipe "));
//     warning_text.appendChild(eventRanking.teams[this.teamId].getListElem());
//     warning_text.appendChild(document.createTextNode(" à l'épreuve "));
//     warning_text.appendChild(eventRanking.challenges[this.challengeId].getListElem());
//     warning_text.appendChild(document.createTextNode(" ne donnent pas un chiffre, celui-ci a été remplécé par 0."));
//     warning_text.appendChild(document.createElement('BR'));
//     warning_text.appendChild(document.createTextNode("Ceci peut mener à des résultats incohérents dans les calculs de points..."));
//     dialogBoxes.open('scoreWarning', warning_text, 'Attention ! Possible erreur d\'encodage...');
    console.log('Warning : Le score #' +this.id+ ' est un NaN (équipe : '+eventRanking.teams[this.teamId].name+', épreuve : '+eventRanking.challenges[this.challengeId].name+').');
    value = 0;
  }
  return value;
};

eventRanking.Score.prototype.getPonderatedValue = function () {
  var initScore               = eventRanking.scoreTypes[this.type].getValue(this.evaluate(), this.challengeId);
  var challengeCorrection     = eventRanking.challenges[this.challengeId].getPonderationFactor();
  var challengeTypeCorrection = eventRanking.challengeTypes[eventRanking.challenges[this.challengeId].typeId].getPonderationFactor();
    
//   console.log(initScore);
//   console.log(challengeCorrection);
//   console.log(challengeTypeCorrection);

  return initScore*challengeCorrection*challengeTypeCorrection;
};

eventRanking.repairScores   = function() {
  var it1,it2;
  for(it1 in eventRanking.scores) {
    if(eventRanking.scores[it1] != undefined) {
      if(eventRanking.scores[it1].eventId != eventRanking.actualEventId || eventRanking.teams[eventRanking.scores[it1].teamId] == undefined || eventRanking.challenges[eventRanking.scores[it1].challengeId] == undefined)
        eventRanking.scores.splice(it1, 1);
    }
  }
  var orderedScores = eventRanking.getScoresTeamChallenge();
  for(it1 in eventRanking.teams) {
    for(it2 in eventRanking.challenges) {
      if(eventRanking.teams[it1] != undefined && eventRanking.challenges[it2] != undefined) {
        if(orderedScores[it1] == undefined) {
          var value = eventRanking.formulae[this.challenges[it2].formulaId].getFormatedValue();
          eventRanking.addScore("", it1, it2, value, 'normal');
        }
        else if(orderedScores[it1][it2] == undefined) {
          var value = eventRanking.formulae[this.challenges[it2].formulaId].getFormatedValue();
          eventRanking.addScore("", it1, it2, value, 'normal');
        }
      }
    }
  }
};

eventRanking.setScoresToFormulaFormat =  function (formulaId, newFormatId) {
  if(eventRanking.formulae[formulaId] != undefined) {
    var oldFormatId = eventRanking.formulae[formulaId].format
    if(oldFormatId != newFormatId && eventRanking.scoreFormats[oldFormatId] != undefined && eventRanking.scoreFormats[newFormatId] != undefined) {
      var it1;
      for(it1 in eventRanking.scores) {
        if(eventRanking.challenges[eventRanking.scores[it1].challengeId].formulaId == formulaId) {
          eventRanking.scores[it1].value = eventRanking.scoreFormats[newFormatId].getFormatedValue(eventRanking.scoreFormats[oldFormatId].getFloat(eventRanking.scores[it1].value));
        }
      }
      return true;
    }
  }
  return false;
};

eventRanking.setScoresToChallengeFormula =  function (challengeId, newFormulaId) {
  if(eventRanking.challenges[challengeId] != undefined) {
    var oldFormulaId = eventRanking.challenges[challengeId].formulaId;
    if(oldFormulaId != newFormulaId) 
    if(eventRanking.formulae[oldFormulaId] != undefined && eventRanking.formulae[oldFormulaId] != undefined) {
      var oldFormatId = eventRanking.formulae[oldFormulaId].format;
      var newFormatId = eventRanking.formulae[newFormulaId].format;
      if(oldFormatId != newFormatId) 
      if(oldFormatId != newFormatId && eventRanking.scoreFormats[oldFormatId] != undefined && eventRanking.scoreFormats[newFormatId] != undefined) {
        var it1;
        for(it1 in eventRanking.scores)
          if(eventRanking.scores[it1].challengeId == challengeId)
            eventRanking.scores[it1].value = eventRanking.scoreFormats[newFormatId].getFormatedValue(eventRanking.scoreFormats[oldFormatId].getFloat(eventRanking.scores[it1].value));
        return true;
      }
    }
  }
  return false;
};





eventRanking.scoreFilters.createScoresTable = function() {
  var it1, it2;
  var orderedTeams          = eventRanking.getOrderedTeams();
  var orderedChallenges     = eventRanking.getOrderedChallenges();
  var orderedChallengeTypes = eventRanking.getOrderedChallengeTypes();
  var orderedScores         = eventRanking.getScoresTeamChallenge();
  var nbTeams               = orderedTeams.length;
  var nbChallenges          = orderedChallenges.length;
  var nbChallengesTypes     = orderedChallengeTypes.length;
  var scoreTable            = [];
  
  for(it1 = 1; it1<nbTeams; it1++) {
    scoreTable[it1] = {
      'id'         : orderedTeams[it1].id,
      'pos'        : orderedTeams[it1].pos,
      'name'       : orderedTeams[it1].name,
      'elem'       : orderedTeams[it1].getTableNameElem(),
      'titleElem'  : orderedTeams[it1].getTableTitleElem(),
      'total'      : (eventRanking.graphics.fastDisplay)?0:orderedTeams[it1].getTotalScore(),
      'totalElem'  : orderedTeams[it1].getTableTotalElem(),
      'totalTitle' : orderedTeams[it1].getTableTotalTitleElem(),
//       'totalElem'  : document.createTextNode(orderedTeams[it1].getTotalScore().toFixed(0)),
      'challenges' : [],
      'subtotals'  : []
    }
    for(it2 = 1; it2 < nbChallenges; it2++) {
      // This is the parte that have to be modified in order to apply filters
//       var challengeId = orderedChallenges[it2].pos;
      var challengeId = orderedChallenges[it2].id;
      scoreTable[it1].challenges[challengeId] = {
        'id'       : orderedChallenges[it2].id,
        'pos'      : orderedChallenges[it2].pos,
        'name'     : orderedChallenges[it2].name,
        'elem'     : orderedChallenges[it2].getTableTitleElem(),
        'score'    : orderedScores[orderedTeams[it1].id][orderedChallenges[it2].id].getPonderatedValue(),
        'viewElem' : orderedScores[orderedTeams[it1].id][orderedChallenges[it2].id].getTableViewElem(),
        'editElem' : orderedScores[orderedTeams[it1].id][orderedChallenges[it2].id].getTableEditElem(),
        'typeElem' : orderedScores[orderedTeams[it1].id][orderedChallenges[it2].id].getTableTypeElem()
      };
    };
    for(it2 = 1; it2 < nbChallengesTypes; it2++) {
      // This is the parte that have to be modified in order to apply filters
      var subtotalId = orderedChallengeTypes[it2].id;
//       var subtotalId = orderedChallengeTypes[it2].pos;
      scoreTable[it1].subtotals[subtotalId] = {
        'id'       : orderedChallengeTypes[it2].id,
        'pos'      : orderedChallengeTypes[it2].pos,
        'name'     : orderedChallengeTypes[it2].name,
        'elem'     : orderedChallengeTypes[it2].getTableTitleElem(),
        'score'    : (eventRanking.graphics.fastDisplay)?0:orderedTeams[it1].getSubotalScore(orderedChallengeTypes[it2].id),
        'viewElem' : orderedTeams[it1].getTableSubtotalElem(orderedChallengeTypes[it2].id)
//         'viewElem' : document.createTextNode(orderedTeams[it1].getSubotalScore(orderedChallengeTypes[it2].id).toFixed(0))
      };
    };
  };
  return scoreTable;
};

eventRanking.scoreFilters.sortRankingTable = function(unsortedTable){
  // Sorting teams
  if(eventRanking.graphics.ordering == 'teamNum')  unsortedTable.sort(function(a, b){return parseInt(a.pos)-parseInt(b.pos)});
  if(eventRanking.graphics.ordering == 'teamName') unsortedTable.sort(
    function (a, b) {
      if(a.name < b.name) return -1;
      if(a.name > b.name) return 1;
      return 0;
    });
  if(eventRanking.graphics.ordering == 'total')    unsortedTable.sort(function(a, b){return b.total-a.total});
  if(eventRanking.graphics.ordering.substr(0,9) == 'challenge')  unsortedTable.sort(
    function(a, b){
      var id = parseInt(eventRanking.graphics.ordering.substr(9));
      return b.challenges[id].score-a.challenges[id].score;
    });
  if(eventRanking.graphics.ordering.substr(0,8) == 'subtotal')   unsortedTable.sort(
    function(a, b){
      var id = parseInt(eventRanking.graphics.ordering.substr(8));
      return b.subtotals[id].score-a.subtotals[id].score;
    });
  
  if(eventRanking.scoreFilters.reversedTeamOrder) unsortedTable.reverse();
  
  if(unsortedTable[0] == undefined) unsortedTable.shift();
  return unsortedTable;
};


eventRanking.scoreFilters.orderChallenges = function(unsortedTable) {
  // Sorting challenges
  var it1;
  for (it1 = 0; it1 < unsortedTable.length; it1++) {
    if(unsortedTable[it1] != undefined) {
      if(eventRanking.scoreFilters.reversedChallengeOrder) {
        unsortedTable[it1].challenges.sort(function(a,b) {return b.pos-a.pos;});
      }
      else {
        unsortedTable[it1].challenges.sort(function(a,b) {return a.pos-b.pos;});
      }
      if (eventRanking.scoreFilters.reverseCategoryOrder) {
        unsortedTable[it1].subtotals.sort( function(a,b) {return b.pos-a.pos;});
      }
      else {
        unsortedTable[it1].subtotals.sort( function(a,b) {return a.pos-b.pos;});
      }
    }
  }
  
  // Recreating new form of table structure, easier to reorder and filter...
  var sortedTable = [];
  var it1,it2;
  for(it1 = 0; it1< unsortedTable.length; it1++) {
    if(unsortedTable[it1] != undefined) {
      var nbChallenges = eventRanking.getMaxId(unsortedTable[it1].challenges);
      var nbChallengeTypes = eventRanking.getMaxId(unsortedTable[it1].subtotals);
      sortedTable[it1] = {
        team : {
          id        : unsortedTable[it1].id,
    group     : eventRanking.groups[eventRanking.teams[unsortedTable[it1].id].group].id,
    category  : eventRanking.categories[eventRanking.groups[eventRanking.teams[unsortedTable[it1].id].group].category].id,
          pos       : unsortedTable[it1].pos,
          name      : unsortedTable[it1].name,
          tableElem : unsortedTable[it1].elem,
          titleElem : unsortedTable[it1].titleElem,
        },
        scores : []
      };
      if(eventRanking.scoreFilters.showChallenges == true) {
        for (it2 = 0; it2 < nbChallenges; it2++) {
          if(unsortedTable[it1].challenges[it2] != undefined) {
            var thisChallengePos     = unsortedTable[it1].challenges[it2].pos;
            var thisChallengeTypePos = eventRanking.challengeTypes[eventRanking.challenges[unsortedTable[it1].challenges[it2].id].typeId].pos;
            sortedTable[it1].scores[it2]  = {
              id               : it2,
              elemType         : 'challenge',
              challengeId      : unsortedTable[it1].challenges[it2].id,
              challengeTypeId  : eventRanking.challenges[unsortedTable[it1].challenges[it2].id].typeId,
              challengePos     : eventRanking.scoreFilters.reversedChallengeOrder?(nbChallenges-thisChallengePos):thisChallengePos,
              challengeTypePos : eventRanking.scoreFilters.reversedChallengeTypeOrder?(nbChallengeTypes-thisChallengeTypePos):thisChallengeTypePos,
              name             : unsortedTable[it1].challenges[it2].name,
              value            : unsortedTable[it1].challenges[it2].score,
              titleElem        : unsortedTable[it1].challenges[it2].elem,
              viewElem         : unsortedTable[it1].challenges[it2].viewElem,
              editElem         : unsortedTable[it1].challenges[it2].editElem,
              typeElem         : unsortedTable[it1].challenges[it2].typeElem
            };
          }
        }
      }
      if(eventRanking.scoreFilters.showChallengeTypes == true) {
        for (it2=0; it2<nbChallengeTypes; it2++) {
          var thisChallengeTypePos = unsortedTable[it1].subtotals[it2].pos;
          if(unsortedTable[it1].subtotals[it2] != undefined) {
            sortedTable[it1].scores[nbChallenges+it2] = {
              id               : nbChallenges+it2,
              elemType         : 'challengeType',
              challengeId      : -1,
              challengeTypeId  : unsortedTable[it1].subtotals[it2].id,
              challengePos     : -1,
              challengeTypePos : eventRanking.scoreFilters.reversedChallengeTypeOrder?(nbChallengeTypes-thisChallengeTypePos):thisChallengeTypePos,
              name             : unsortedTable[it1].subtotals[it2].name,
              value            : unsortedTable[it1].subtotals[it2].score,
              titleElem        : unsortedTable[it1].subtotals[it2].elem,
              viewElem         : unsortedTable[it1].subtotals[it2].viewElem,
              editElem         : undefined,
              typeElem         : undefined
            };
          }
        }
      }
      if(eventRanking.scoreFilters.showTotal == true) {
        sortedTable[it1].scores[nbChallenges+nbChallengeTypes] = {
          id               : nbChallenges+nbChallengeTypes,
          elemType         : 'total',
          challengeTypeId  : -1,
          challengeId      : -1,
          challengePos     : -1,
          challengeTypePos : -1,
          name             : 'Total',
          value            : unsortedTable[it1].total,
          titleElem        : unsortedTable[it1].totalTitle,
          viewElem         : unsortedTable[it1].totalElem,
          editElem         : undefined,
          typeElem         : undefined
        };
      }
    }
  }
  for(it1 = 0; it1< unsortedTable.length; it1++) {
    if(unsortedTable[it1] != undefined) {
      sortedTable[it1].scores.sort(eventRanking.scoreFilters.challengeOrderFcts[eventRanking.scoreFilters.challengeOrder].getReorder);
    }
  }
//   console.log(sortedTable);
  return sortedTable;
};


eventRanking.scoreFilters.hideElements = function(unsortedTable) {
  var it1, it2;
  var nbTeams = unsortedTable.length;
  for(it1 = 0; it1<nbTeams; it1++) {
    if(unsortedTable[it1] != undefined) {
      var hideTeam = eventRanking.scoreFilters.hiddenCategories.indexOf(unsortedTable[it1].team.category) != -1;
      while (hideTeam) {
  unsortedTable.splice(it1,1);
  if(unsortedTable[it1] != undefined){
          hideTeam = eventRanking.scoreFilters.hiddenCategories.indexOf(unsortedTable[it1].team.category) != -1;
  }
        else {
    hideTeam = false;
  }
      }
    }
    if(unsortedTable[it1] != undefined) {
      var nbChallenges = unsortedTable[it1].scores.length;
      for(it2 = 0; it2 < nbChallenges; it2++) {
        if(unsortedTable[it1].scores[it2] != undefined) {
          var hideChallenge = eventRanking.scoreFilters.hiddenChallengeTypes.indexOf(unsortedTable[it1].scores[it2].challengeTypeId) != -1;
    while (hideChallenge) {
      unsortedTable[it1].scores.splice(it2,1);
      if(unsortedTable[it1].scores[it2] != undefined) {
        hideChallenge = eventRanking.scoreFilters.hiddenChallengeTypes.indexOf(unsortedTable[it1].scores[it2].challengeTypeId) != -1;
      }
      else {
        hideChallenge = false;
      }
    }
  }
      }
    }
  }
  
  
  //  eventRanking.scoreFilters.hiddenChallengeTypes        = [];
  //  eventRanking.scoreFilters.hiddenCategories            = [];
  //  var nbHiddenChallengeTypes = eventRanking.scoreFilters.hiddenChallengeTypes.length;
  // for (it1 = 0; it1 < it1_max; it1++) {
  //   if(eventRanking.scoreFilters.hiddenCategories[it1] != undefined)
  //     deteting bad entries : while(array.indexOf() >=0 ) array.splice(array.indexOf(), 1);
//   console.log(unsortedTable);
  return unsortedTable;
}
  
  
  
  
  
eventRanking.ChallengeType.prototype.getTableTitleElem      = function () {
  var arrow_up64   = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApElEQVQ4jc3RsQpBARSH8V83k8FskEEeQQbpTp7C6E1kkAwewSijhzDJaJJBkicwGMTilm7XdV0lp/7TOd93Oh3+vcqofCOYYpYXbuCKG1p5BMsHfMMKwSdw9wmO0ssKF3FIEJxQyiLoJ8BRRu/gKs4pggvqaYJ5Chxl8QoOY4M7DDHANtbrxOEAaxwxQTNhQQNj7LFBIX57KNuvA7RRyzD7g7oDSqo5eSqN/7gAAAAASUVORK5CYII=')";
  var arrow_down64 = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jcXSMWpCQRRG4Y9olcLaQiwkna1YCFq5ipTZiVgESeESLCWli7ASy1TBQoxYp7CwkKRwHsTH+HxRxB8uAzP3HO4ww71TCGsNdXzh5wzzgHbo+042i/jAEm9oRMAmhlhjHkRH6QZrUp/o4xWL1Fnn1HiTVGOs3rPu94RdBrxFNUsAgwxB7xwMJWwi8AqPeQTwEhE854U5PNHsDzz9D5ykFeC9+L/IlTFGl8JQQfkawe3zC/XOPR1kYs0YAAAAAElFTkSuQmCC')";

  
  var tmp = document.createElement('td');
  tmp.appendChild(document.createTextNode(this.name));
  tmp.appendChild(document.createElement('BR'));
  tmp.appendChild(document.createTextNode('(Soustotal)'));
  tmp.style.backgroundColor = this.color;
  tmp.style.fontWeight = 'bold';
  tmp.style.whiteSpace = "nowrap";
  
  tmp.dataset.ordering = 'subtotal'+this.id;
  tmp.onclick = eventRanking.graphics.setTableOrdering;
  tmp.style.textAlign = "center";
  tmp.style.paddingRight = "16px";
  if(eventRanking.graphics.ordering == 'subtotal'+this.id) {
    if(eventRanking.scoreFilters.reversedTeamOrder)
      tmp.style.backgroundImage    = arrow_down64;
//       tmp.style.backgroundImage    ='url("images/arrow-down-16.png")';
    else
      tmp.style.backgroundImage    = arrow_up64;
//       tmp.style.backgroundImage    ='url("images/arrow-up-16.png")';
    tmp.style.backgroundPosition = 'right bottom';
    tmp.style.backgroundRepeat   = 'no-repeat';
  }
  return tmp;
};
eventRanking.Challenge.prototype.getTableTitleElem      = function () {
  var arrow_up64   = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApElEQVQ4jc3RsQpBARSH8V83k8FskEEeQQbpTp7C6E1kkAwewSijhzDJaJJBkicwGMTilm7XdV0lp/7TOd93Oh3+vcqofCOYYpYXbuCKG1p5BMsHfMMKwSdw9wmO0ssKF3FIEJxQyiLoJ8BRRu/gKs4pggvqaYJ5Chxl8QoOY4M7DDHANtbrxOEAaxwxQTNhQQNj7LFBIX57KNuvA7RRyzD7g7oDSqo5eSqN/7gAAAAASUVORK5CYII=')";
  var arrow_down64 = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jcXSMWpCQRRG4Y9olcLaQiwkna1YCFq5ipTZiVgESeESLCWli7ASy1TBQoxYp7CwkKRwHsTH+HxRxB8uAzP3HO4ww71TCGsNdXzh5wzzgHbo+042i/jAEm9oRMAmhlhjHkRH6QZrUp/o4xWL1Fnn1HiTVGOs3rPu94RdBrxFNUsAgwxB7xwMJWwi8AqPeQTwEhE854U5PNHsDzz9D5ykFeC9+L/IlTFGl8JQQfkawe3zC/XOPR1kYs0YAAAAAElFTkSuQmCC')";

  
  var tmp = document.createElement('td');
  tmp.appendChild(document.createTextNode(this.name));
  if(eventRanking.challengeTypes[this.typeId] != undefined) {
    tmp.style.backgroundColor = eventRanking.challengeTypes[this.typeId].color;
    tmp.appendChild(document.createElement('br'));
    tmp.appendChild(document.createTextNode('('+eventRanking.challengeTypes[this.typeId].name+')'));
  }
  tmp.dataset.ordering = 'challenge'+this.id;
  tmp.onclick = eventRanking.graphics.setTableOrdering;
  tmp.style.textAlign = "center";
  tmp.style.paddingRight = "16px";
  tmp.style.whiteSpace = "nowrap";
  if(eventRanking.graphics.ordering == 'challenge'+this.id) {
    if(eventRanking.scoreFilters.reversedTeamOrder)
      tmp.style.backgroundImage    = arrow_down64;
//       tmp.style.backgroundImage    ='url("images/arrow-down-16.png")';
    else
      tmp.style.backgroundImage    = arrow_up64;
//       tmp.style.backgroundImage    ='url("images/arrow-up-16.png")';
    tmp.style.backgroundPosition = 'right bottom';
    tmp.style.backgroundRepeat   = 'no-repeat';
    }
  return tmp;
};



eventRanking.Team.prototype.getTableNameElem      = function () {
  var arrow_up64   = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApElEQVQ4jc3RsQpBARSH8V83k8FskEEeQQbpTp7C6E1kkAwewSijhzDJaJJBkicwGMTilm7XdV0lp/7TOd93Oh3+vcqofCOYYpYXbuCKG1p5BMsHfMMKwSdw9wmO0ssKF3FIEJxQyiLoJ8BRRu/gKs4pggvqaYJ5Chxl8QoOY4M7DDHANtbrxOEAaxwxQTNhQQNj7LFBIX57KNuvA7RRyzD7g7oDSqo5eSqN/7gAAAAASUVORK5CYII=')";
  var arrow_down64 = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jcXSMWpCQRRG4Y9olcLaQiwkna1YCFq5ipTZiVgESeESLCWli7ASy1TBQoxYp7CwkKRwHsTH+HxRxB8uAzP3HO4ww71TCGsNdXzh5wzzgHbo+042i/jAEm9oRMAmhlhjHkRH6QZrUp/o4xWL1Fnn1HiTVGOs3rPu94RdBrxFNUsAgwxB7xwMJWwi8AqPeQTwEhE854U5PNHsDzz9D5ykFeC9+L/IlTFGl8JQQfkawe3zC/XOPR1kYs0YAAAAAElFTkSuQmCC')";

  var tmp = document.createElement('td');
//   tmp.appendChild(document.createTextNode(this.pos + ' ' + this.name));
  tmp.appendChild(document.createTextNode(this.name));
  tmp.style.whiteSpace = "nowrap";
  if (eventRanking.groups[this.group] != undefined) {
    tmp.appendChild(document.createElement('br'));
    tmp.appendChild(document.createTextNode('('+eventRanking.groups[this.group].name+')'));
    if(eventRanking.categories[eventRanking.groups[this.group].category] != undefined) 
      tmp.style.backgroundColor = eventRanking.categories[eventRanking.groups[this.group].category].color;
  }
  return tmp;
};
eventRanking.Team.prototype.getTableTitleElem      = function () {
  var arrow_up64   = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApElEQVQ4jc3RsQpBARSH8V83k8FskEEeQQbpTp7C6E1kkAwewSijhzDJaJJBkicwGMTilm7XdV0lp/7TOd93Oh3+vcqofCOYYpYXbuCKG1p5BMsHfMMKwSdw9wmO0ssKF3FIEJxQyiLoJ8BRRu/gKs4pggvqaYJ5Chxl8QoOY4M7DDHANtbrxOEAaxwxQTNhQQNj7LFBIX57KNuvA7RRyzD7g7oDSqo5eSqN/7gAAAAASUVORK5CYII=')";
  var arrow_down64 = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jcXSMWpCQRRG4Y9olcLaQiwkna1YCFq5ipTZiVgESeESLCWli7ASy1TBQoxYp7CwkKRwHsTH+HxRxB8uAzP3HO4ww71TCGsNdXzh5wzzgHbo+042i/jAEm9oRMAmhlhjHkRH6QZrUp/o4xWL1Fnn1HiTVGOs3rPu94RdBrxFNUsAgwxB7xwMJWwi8AqPeQTwEhE854U5PNHsDzz9D5ykFeC9+L/IlTFGl8JQQfkawe3zC/XOPR1kYs0YAAAAAElFTkSuQmCC')";

  var tmp = document.createElement('td');
  tmp.appendChild(document.createTextNode('# / Nom'));
  tmp.dataset.ordering = 'teamNum';
  tmp.onclick = eventRanking.graphics.setTableOrdering;
  tmp.style.textAlign = "center";
  tmp.style.paddingRight = "16px";
  tmp.style.whiteSpace = "nowrap";
  if(eventRanking.graphics.ordering == 'teamNum') {
    if(eventRanking.scoreFilters.reversedTeamOrder)
      tmp.style.backgroundImage    = arrow_down64;
//       tmp.style.backgroundImage    ='url("images/arrow-down-16.png")';
    else
      tmp.style.backgroundImage    = arrow_up64;
//       tmp.style.backgroundImage    ='url("images/arrow-up-16.png")';
    tmp.style.backgroundPosition = 'right bottom';
    tmp.style.backgroundRepeat   = 'no-repeat';
  }
  return tmp;
};
eventRanking.Team.prototype.getTableTotalElem      = function () {
  var tmp = document.createElement('td');
  tmp.appendChild(document.createTextNode(this.getTotalScore().toFixed(0)));
  tmp.style.textAlign = "right";
  tmp.style.fontWeight = 'bold';
  return tmp;
};
eventRanking.Team.prototype.getTableTotalTitleElem      = function () {
  var arrow_up64   = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApElEQVQ4jc3RsQpBARSH8V83k8FskEEeQQbpTp7C6E1kkAwewSijhzDJaJJBkicwGMTilm7XdV0lp/7TOd93Oh3+vcqofCOYYpYXbuCKG1p5BMsHfMMKwSdw9wmO0ssKF3FIEJxQyiLoJ8BRRu/gKs4pggvqaYJ5Chxl8QoOY4M7DDHANtbrxOEAaxwxQTNhQQNj7LFBIX57KNuvA7RRyzD7g7oDSqo5eSqN/7gAAAAASUVORK5CYII=')";
  var arrow_down64 = "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jcXSMWpCQRRG4Y9olcLaQiwkna1YCFq5ipTZiVgESeESLCWli7ASy1TBQoxYp7CwkKRwHsTH+HxRxB8uAzP3HO4ww71TCGsNdXzh5wzzgHbo+042i/jAEm9oRMAmhlhjHkRH6QZrUp/o4xWL1Fnn1HiTVGOs3rPu94RdBrxFNUsAgwxB7xwMJWwi8AqPeQTwEhE854U5PNHsDzz9D5ykFeC9+L/IlTFGl8JQQfkawe3zC/XOPR1kYs0YAAAAAElFTkSuQmCC')";

  var tmp = document.createElement('td');
  tmp.appendChild(document.createTextNode('TOTAL'));
  tmp.dataset.ordering = 'total';
  tmp.onclick = eventRanking.graphics.setTableOrdering;
  tmp.style.fontWeight = 'bold';
  tmp.style.textAlign = "center";
  tmp.style.whiteSpace = "nowrap";
  tmp.style.paddingRight = "16px";
  if(eventRanking.graphics.ordering == 'total') {
    if(eventRanking.scoreFilters.reversedTeamOrder)
      tmp.style.backgroundImage    = arrow_down64;
//       tmp.style.backgroundImage    ='url("images/arrow-down-16.png")';
    else
      tmp.style.backgroundImage    = arrow_up64;
//       tmp.style.backgroundImage    ='url("images/arrow-up-16.png")';
    tmp.style.backgroundPosition = 'right bottom';
    tmp.style.backgroundRepeat   = 'no-repeat';
    }
  return tmp;
};
eventRanking.Team.prototype.getTableSubtotalElem      = function (challengeId) {
  var tmp = document.createElement('td');
  tmp.appendChild(document.createTextNode(this.getSubotalScore(challengeId).toFixed(0)));
  tmp.style.textAlign = "right";
  tmp.style.backgroundColor = "lightgrey";
  return tmp;
};



eventRanking.Score.prototype.getTableEditElem   = function () {
  var eTd    = document.createElement('td');
  var format = eventRanking.formulae[eventRanking.challenges[this.challengeId].formulaId].format;
  var fScore = document.createElement('form');
  var iId    = document.createElement('input');
  fScore.setAttribute('id','score'+this.id+'Form');
  iId.type = 'hidden';
  iId.name = 'id';
  iId.value = this.id;
  fScore.appendChild(iId);
  var iFormat  = document.createElement('input');
  iFormat.type = 'hidden';
  iFormat.name = 'format';
  iFormat.value = format;
  iFormat.className = "numeric";
  fScore.appendChild(iFormat);
  var iSubmit = document.createElement('input');
  iSubmit.type = 'submit';
  iSubmit.name = 'Save';
  iSubmit.style.display = "none";
  fScore.appendChild(iSubmit);
  if(this.value == 'mean' || this.value == 'min' || this.value == 'max' || this.value == 'zero') {
    var iValue  = document.createElement('input');
    iValue.type = 'text';
    iValue.name = 'value';
    iValue.value = this.value;
    iValue.className = "numeric";
    fScore.appendChild(iValue);
  }
  else {
    fScore = eventRanking.scoreFormats[format].getInputElem(this.value, fScore, eventRanking.graphics.setScoreEvent);
  }
  fScore.onsubmit = eventRanking.graphics.setScoreEvent;
  eTd.appendChild(fScore);
  eTd.style.whiteSpace = "nowrap";
  return eTd;
};

eventRanking.Score.prototype.getTableViewElem   = function () {
  var tmp = document.createElement('td');
  if(eventRanking.scoreTypes[this.type].calculate) {
    tmp.appendChild(document.createTextNode(this.getPonderatedValue().toFixed(0)));
  }
  else {
    tmp.appendChild(document.createTextNode(eventRanking.scoreTypes[this.type].name));
  }
  tmp.style.textAlign = "right";
  return tmp;
};

eventRanking.Score.prototype.getTableTypeElem   = function () {
  var eTd    = document.createElement('td');
  var format = eventRanking.formulae[eventRanking.challenges[this.challengeId].formulaId].format;
  var fScore = document.createElement('form');
  var iId    = document.createElement('input');
  var it1;
  iId.type = 'hidden';
  iId.name = 'id';
  iId.value = this.id;
  fScore.appendChild(iId);
  var sType  = document.createElement('select');
  sType.name = 'format';
  sType.onchange = eventRanking.graphics.setScoreTypeEvent;
  for(it1 in eventRanking.scoreTypes) {
    var oType = document.createElement('option');
    oType.value = eventRanking.scoreTypes[it1].id;
    oType.appendChild(document.createTextNode(eventRanking.scoreTypes[it1].name));
    if(eventRanking.scoreTypes[it1].id == this.type) oType.selected = "selected";
    sType.appendChild(oType);
  }
  fScore.appendChild(sType);
  
  var iSubmit = document.createElement('input');
  iSubmit.type = 'submit';
  iSubmit.name = 'Save';
  iSubmit.style.display = "none";
  fScore.appendChild(iSubmit);
  
  fScore.onsubmit = eventRanking.graphics.setScoreTypeEvent;
  eTd.appendChild(fScore);
  return eTd;
};





eventRanking.scoreFilters.challengeOrderFcts[1] = new eventRanking.ScoreOrdering(1, "Épreuves   - Catégories -  Total", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos+1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos+1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos+1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos+1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    
    if(a2 == b2) {
      return a1-b1; }
    else {
      return a2-b2; }
  });

eventRanking.scoreFilters.challengeOrderFcts[2] = new eventRanking.ScoreOrdering(2, "Total - Catégories -  Épreuves", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos-1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos-1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos-1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos-1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    
    if(a2 == b2) {
      return a1-b1; }
    else {
      return a2-b2; }
  });

eventRanking.scoreFilters.challengeOrderFcts[3] = new eventRanking.ScoreOrdering(3, "Total - Épreuves - Catégories", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos+1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos+1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos+1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos+1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      
    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      a2 = b2-1;    }
    if(b.challengeTypePos < 0 && b.challengePos < 0) {
      b2 = a2-1;    }
    
    if(a2 == b2) {
      return a1-b1; }
    else {
      return a2-b2; }
  });

eventRanking.scoreFilters.challengeOrderFcts[4] = new eventRanking.ScoreOrdering(4, "Catégories - Épreuves - Total", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos-1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos-1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos-1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos-1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      
    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      a2 = b2+1;    }
    if(b.challengeTypePos < 0 && b.challengePos < 0) {
      b2 = a2+1;    }
    
    if(a2 == b2) {
      return a1-b1; }
    else {
      return a2-b2; }
  });

eventRanking.scoreFilters.challengeOrderFcts[5] = new eventRanking.ScoreOrdering(5, "Épreuves - Total - Catégories", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos+1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos+1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos+1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos+1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      
    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      a1 = b1-1;    }
    if(b.challengeTypePos < 0 && b.challengePos < 0) {
      b1 = a1-1;    }
    
    if(a2 == b2) {
      return a1-b1; }
    else {
      return a2-b2; }
  });

eventRanking.scoreFilters.challengeOrderFcts[6] = new eventRanking.ScoreOrdering(6, " Catégories - Total - Épreuves", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos-1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos-1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos-1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos-1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      
    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      a1 = b1+1;    }
    if(b.challengeTypePos < 0 && b.challengePos < 0) {
      b1 = a1+1;    }
    
    if(a2 == b2) {
      return a1-b1; }
    else {
      return a2-b2; }
  });

eventRanking.scoreFilters.challengeOrderFcts[7] = new eventRanking.ScoreOrdering(7, "(Épreuves   et Catégories) -  Total", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos+1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos+1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos+1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos+1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    
    if(a1 == b1) {
      return a2-b2; }
    else {
      return a1-b1; }
  });

eventRanking.scoreFilters.challengeOrderFcts[8] = new eventRanking.ScoreOrdering(8, "Total - (Catégories et Épreuves)", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos-1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos-1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos-1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos-1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    
    if(a1 == b1) {
      return a2-b2; }
    else {
      return a1-b1; }
  });

eventRanking.scoreFilters.challengeOrderFcts[9] = new eventRanking.ScoreOrdering(9, "(Catégories et Épreuves) - Total", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos-1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos-1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos-1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos-1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      a1 = b1+1;    }
    if(b.challengeTypePos < 0 && b.challengePos < 0) {
      b1 = a1+1;    }
    
    if(a1 == b1) {
      return a2-b2; }
    else {
      return a1-b1; }
  });

eventRanking.scoreFilters.challengeOrderFcts[10] = new eventRanking.ScoreOrdering(10, "Total - (Épreuves et Catégories)", 
  function (a,b) {
    var a1,a2,b1,b2;
    if (a.challengeTypePos < 0) {
      if(b.challengeTypePos < 0) {
        a1 = 1; b1 = 1; }
      else {
        a1 = b.challengeTypePos+1; b1 = b.challengeTypePos;}}
    else if (b.challengeTypePos < 0) {
      a1 = a.challengeTypePos; b1 = a.challengeTypePos+1; }
    else {
      a1 = a.challengeTypePos; b1 = b.challengeTypePos;}
    if (a.challengePos < 0) {
      if(b.challengePos < 0) {
        a2 = 1; b2 = 1;  }
      else {
        a2 = b.challengePos+1; b2 = b.challengePos;}    }
    else if (b.challengePos < 0) {
      a2 = a.challengePos; b2 = a.challengePos+1;    }
    else {
      a2 = a.challengePos; b2 = b.challengePos;    }
    if(a.challengeTypePos < 0 && a.challengePos < 0) {
      a1 = b1-1;    }
    if(b.challengeTypePos < 0 && b.challengePos < 0) {
      b1 = a1-1;    }
    
    if(a1 == b1) {
      return a2-b2; }
    else {
      return a1-b1; }
  });

  
  
  
eventRanking.scoreTypes['normal'] =  new eventRanking.ScoreType('normal','Normal',  true,  function (value, challengeId){return value;});
eventRanking.scoreTypes['zero']   =  new eventRanking.ScoreType('zero',  'Zéro',    false, function (value, challengeId){return 0;});
eventRanking.scoreTypes['mean']   =  new eventRanking.ScoreType('mean',  'Moyenne', false, 
  function (value, challengeId){
    var it1;
    var tmpScores = [];
    for(it1 in eventRanking.scores) {
      if(eventRanking.scores[it1] != undefined)
      if(eventRanking.scores[it1].challengeId == challengeId)
      if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate)
        tmpScores.push(eventRanking.scores[it1].evaluate());
    }
    var scoresSum = 0;
    for (it1 in tmpScores) scoresSum += tmpScores[it1];
    return scoresSum/tmpScores.length;
  });
eventRanking.scoreTypes['med']    =  new eventRanking.ScoreType('med',   'Médiane', false, 
  function (value, challengeId){
    var it1;
    var tmpScores = [];
    for(it1 in eventRanking.scores) {
      if(eventRanking.scores[it1] != undefined)
      if(eventRanking.scores[it1].challengeId == challengeId)
      if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate)
        tmpScores.push(eventRanking.scores[it1].evaluate());
    }
    if(tmpScores.length > 0) {
      tmpScores.sort(function(a, b){return b-a});
      if(tmpScores.length%2 == 1)
        return tmpScores[(tmpScores.length-1)/2];
      if(tmpScores.length%2 == 0)
        return 0.5*(tmpScores[tmpScores.length/2]+tmpScores[tmpScores.length/2-1]);
    }
    else {
      return 0;
    }
  });
eventRanking.scoreTypes['min']    =  new eventRanking.ScoreType('min',   'Minimun', false, 
  function (value, challengeId){
    var it1;
    var tmpScores = [];
    for(it1 in eventRanking.scores) {
      if(eventRanking.scores[it1] != undefined)
      if(eventRanking.scores[it1].challengeId == challengeId)
      if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate)
        tmpScores.push(eventRanking.scores[it1].evaluate());
    }
    if(tmpScores.length > 0) {
      tmpScores.sort(function(a, b){return a-b});
      return tmpScores[0];
    }
    else {
      return 0;
    }
  });
eventRanking.scoreTypes['max']    =  new eventRanking.ScoreType('max',   'Maximum', false, 
  function (value, challengeId){
    var it1;
    var tmpScores = [];
    for(it1 in eventRanking.scores) {
      if(eventRanking.scores[it1] != undefined)
      if(eventRanking.scores[it1].challengeId == challengeId)
      if(eventRanking.scoreTypes[eventRanking.scores[it1].type].calculate)
        tmpScores.push(eventRanking.scores[it1].evaluate());
    }
    if(tmpScores.length > 0) {
      tmpScores.sort(function(a, b){return b-a});
      return tmpScores[0];
    }
    else {
      return 0;
    }
  });




eventRanking.scoreFormats['float']               = new eventRanking.ScoreFormat ('float', 'Nombre à virgule',
  function (formatedValue, elem, changeAction) {
    var elemId       = elem.getAttribute('id');
    var tmp          =  parseFloat(formatedValue);
    var iValue       = document.createElement('input');
    iValue.id        = elemId+'FloatInput';
    iValue.type      = 'number';
    iValue.name      = 'float';
    iValue.value     = tmp;
    iValue.step      = 0.001;
    iValue.className = "numeric tabable";
    iValue.onchange  = changeAction;
    elem.appendChild(iValue);
    return elem;
  },
  function (valueOrElem) {
    if(valueOrElem.nodeType === Node.ELEMENT_NODE && valueOrElem.tagName == 'FORM') {
      return  valueOrElem.elements['float'].value;
    }
    else if(valueOrElem == parseInt(valueOrElem) || valueOrElem == parseFloat(valueOrElem)) {
      return parseFloat(valueOrElem);
    }
    else {
      return false;
    }
  },
  function (formatedValue) {
      return parseFloat(formatedValue);
  }
);
eventRanking.scoreFormats['int']                 = new eventRanking.ScoreFormat ('int', 'Nombre entier',
  function (formatedValue, elem, changeAction) {
    var elemId       = elem.getAttribute('id');
    var tmp          = parseInt(formatedValue);
    var iValue       = document.createElement('input');
    iValue.id        = elemId+'IntInput';
    iValue.type      = 'number';
    iValue.name      = 'int';
    iValue.value     = tmp;
    iValue.step      = 1;
    iValue.className = "numeric tabable";
    iValue.onchange  = changeAction;
    elem.appendChild(iValue);
    return elem;
  },
  function (valueOrElem) {
    if(valueOrElem.nodeType === Node.ELEMENT_NODE && valueOrElem.tagName == 'FORM') {
      return  valueOrElem.elements['int'].value;
    }
    else if(valueOrElem == parseInt(valueOrElem) || valueOrElem == parseFloat(valueOrElem)) {
      return parseInt(valueOrElem);
    }
    else {
      return false;
    }
  },
  function (formatedValue) {
      return parseInt(formatedValue);
  }
);
eventRanking.scoreFormats['mm:ss']               = new eventRanking.ScoreFormat ('mm:ss', 'Temps (mm:ss)',
  function (formatedValue, elem, changeAction) {
    var elemId       = elem.getAttribute('id');
    var tmp          = formatedValue.split(':');
    var iMin         = document.createElement('input');
    var iSec         = document.createElement('input');
    iMin.id          = elemId+'iMinInput';
    iMin.type        = 'number';
    iMin.name        = 'min';
    iMin.value       = tmp[0];
    iMin.min         = 0;
    iMin.max         = 59;
    iMin.step        = 1;
    iMin.className   = "twodigits tabable";
    iMin.onchange    = changeAction;
    iSec.id          = elemId+'iSecInput';
    iSec.type        = 'number';
    iSec.name        = 'sec';
    iSec.value       = tmp[1];
    iSec.min         = 0;
    iSec.max         = 59;
    iSec.step        = 1;
    iSec.className   = "twodigits tabable";
    iSec.onchange    = changeAction;
    elem.appendChild(iMin);
    elem.appendChild(document.createTextNode('m'));
    elem.appendChild(iSec);
    elem.appendChild(document.createTextNode('s'));
    return elem;
  },
  function (valueOrElem) {
    if(valueOrElem.nodeType === Node.ELEMENT_NODE && valueOrElem.tagName == 'FORM') {
      return  valueOrElem.elements['min'].value+':'+valueOrElem.elements['sec'].value;
    }
    else if(valueOrElem == parseInt(valueOrElem) || valueOrElem == parseFloat(valueOrElem)) {
      var min = Math.floor(valueOrElem/60);
      var sec = Math.floor(valueOrElem%60);
      return min+':'+sec;
    }
    else {
      return false;
    }
  },
  function (formatedValue) {
      var tmp = formatedValue.split(':');
      return parseFloat(tmp[0])*60+parseFloat(tmp[1]);
  }
);
eventRanking.scoreFormats['hh:mm:ss']            = new eventRanking.ScoreFormat ('hh:mm:ss', 'Temps (hh:mm:ss)',
  function (formatedValue, elem, changeAction) {
    var elemId       = elem.getAttribute('id');
    var tmp          = formatedValue.split(':');
    var iHour        = document.createElement('input');
    var iMin         = document.createElement('input');
    var iSec         = document.createElement('input');
    iHour.id         = elemId+'iHourInput';
    iHour.type       = 'number';
    iHour.name       = 'hour';
    iHour.value      = tmp[0];
    iHour.min        = 0;
    iHour.max        = 23;
    iHour.step       = 1;
    iHour.className  = "twodigits tabable";
    iHour.onchange   = changeAction;
    iMin.id          = elemId+'iMinInput';
    iMin.type        = 'number';
    iMin.name        = 'min';
    iMin.value       = tmp[1];
    iMin.min         = 0;
    iMin.max         = 59;
    iMin.step        = 1;
    iMin.className   = "twodigits tabable";
    iMin.onchange    = changeAction;
    iSec.id          = elemId+'iSecInput';
    iSec.type        = 'number';
    iSec.name        = 'sec';
    iSec.value       = tmp[2];
    iSec.min         = 0;
    iSec.max         = 59;
    iSec.step        = 1;
    iSec.className   = "twodigits tabable";
    iSec.onchange    = changeAction;
    elem.appendChild(iHour);
    elem.appendChild(document.createTextNode('h'));
    elem.appendChild(iMin);
    elem.appendChild(document.createTextNode('m'));
    elem.appendChild(iSec);
    elem.appendChild(document.createTextNode('s'));
    return elem;
  },
  function (valueOrElem) {
    if(valueOrElem.nodeType === Node.ELEMENT_NODE && valueOrElem.tagName == 'FORM') {
      value =  valueOrElem.elements['hour'].value+':'+valueOrElem.elements['min'].value+':'+valueOrElem.elements['sec'].value;
    }
    else if(valueOrElem == parseInt(valueOrElem) || valueOrElem == parseFloat(valueOrElem)) {
      var hour = Math.floor(valueOrElem/3600);
      var min  = Math.floor(valueOrElem/60);
      var sec  = Math.floor(valueOrElem%60);
      return hour+':'+min+':'+sec;
    }
    else {
      return false;
    }
  },
  function (formatedValue) {
      var tmp = formatedValue.split(':');
      return parseFloat(tmp[0])*3600+parseFloat(tmp[1])*60+parseFloat(tmp[2]);
  }
);
eventRanking.scoreFormats['start.stop.hh:mm:ss'] = new eventRanking.ScoreFormat ('start.stop.hh:mm:ss', 'Temps (Start/Stop - hh:mm:ss)',
  function (formatedValue, elem, changeAction) {
    var elemId       = elem.getAttribute('id');
    var tmp          = formatedValue.split(/[.:]/);
    var iHour2       = document.createElement('input');
    var iMin2        = document.createElement('input');
    var iSec2        = document.createElement('input');
    var iHour1       = document.createElement('input');
    var iMin1        = document.createElement('input');
    var iSec1        = document.createElement('input');
    iHour2.id        = elemId+'iHour2Input';
    iHour2.type      = 'number';
    iHour2.name      = 'hour2';
    iHour2.value     = tmp[0];
    iHour2.min       = 0;
    iHour2.max       = 23;
    iHour2.step      = 1;
    iHour2.className = "twodigits tabable";
    iHour2.onchange  = changeAction;
    iMin2.id         = elemId+'iMin2Input';
    iMin2.type       = 'number';
    iMin2.name       = 'min2';
    iMin2.value      = tmp[1];
    iMin2.min        = 0;
    iMin2.max        = 59;
    iMin2.step       = 1;
    iMin2.className  = "twodigits tabable";
    iMin2.onchange   = changeAction;
    iSec2.id         = elemId+'iSec2Input';
    iSec2.type       = 'number';
    iSec2.name       = 'sec2';
    iSec2.value      = tmp[2];
    iSec2.min        = 0;
    iSec2.max        = 59;
    iSec2.step       = 1;
    iSec2.className  = "twodigits tabable";
    iSec2.onchange   = changeAction;
    iHour1.id        = elemId+'iHour1Input';
    iHour1.type      = 'number';
    iHour1.name      = 'hour1';
    iHour1.value     = tmp[3];
    iHour1.min       = 0;
    iHour1.max       = 23;
    iHour1.step      = 1;
    iHour1.className = "twodigits tabable";
    iHour1.onchange  = changeAction;
    iMin1.id         = elemId+'iMin1Input';
    iMin1.type       = 'number';
    iMin1.name       = 'min1';
    iMin1.value      = tmp[4];
    iMin1.min        = 0;
    iMin1.max        = 59;
    iMin1.step       = 1;
    iMin1.className  = "twodigits tabable";
    iMin1.onchange   = changeAction;
    iSec1.id         = elemId+'iSec1Input';
    iSec1.type       = 'number';
    iSec1.name       = 'sec1';
    iSec1.value      = tmp[5];
    iSec1.min        = 0;
    iSec1.max        = 59;
    iSec1.step       = 1;
    iSec1.className  = "twodigits tabable";
    iSec1.onchange   = changeAction;
    elem.appendChild(document.createTextNode('Start : '));
    elem.appendChild(iHour1);
    elem.appendChild(document.createTextNode('h'));
    elem.appendChild(iMin1);
    elem.appendChild(document.createTextNode('m'));
    elem.appendChild(iSec1);
    elem.appendChild(document.createTextNode('s'));
    elem.appendChild(document.createElement('br'));
    elem.appendChild(document.createTextNode('Stop : '));
    elem.appendChild(iHour2);
    elem.appendChild(document.createTextNode('h'));
    elem.appendChild(iMin2);
    elem.appendChild(document.createTextNode('m'));
    elem.appendChild(iSec2);
    elem.appendChild(document.createTextNode('s'));
    return elem;
  },
  function (valueOrElem) {
    if(valueOrElem.nodeType === Node.ELEMENT_NODE && valueOrElem.tagName == 'FORM') {
      return valueOrElem.elements['hour2'].value+':'+valueOrElem.elements['min2'].value+':'+valueOrElem.elements['sec2'].value+'.'+valueOrElem.elements['hour1'].value+':'+valueOrElem.elements['min1'].value+':'+valueOrElem.elements['sec1'].value;
    }
    else if(valueOrElem == parseInt(valueOrElem) || valueOrElem == parseFloat(valueOrElem)) {
      var hour = Math.floor(valueOrElem/3600);
      var min  = Math.floor(valueOrElem/60);
      var sec  = Math.floor(valueOrElem%60);
      return hour+':'+min+':'+sec+'.0:0:0';
    }
    else {
      return false;
    }
  },
  function (formatedValue) {
    var tmp = formatedValue.split(/[.:]/);
    return parseFloat(tmp[0])*3600+parseFloat(tmp[1])*60+parseFloat(tmp[2]) - parseFloat(tmp[3])*3600-parseFloat(tmp[4])*60-parseFloat(tmp[5]);
  }
);
eventRanking.scoreFormats['start.stop.mm:ss']    = new eventRanking.ScoreFormat ('start.stop.mm:ss', 'Temps (Start/Stop - mm:ss)',
  function (formatedValue, elem, changeAction) {
    var elemId       = elem.getAttribute('id');
    var tmp          = formatedValue.split(/[.:]/);
    var iMin2        = document.createElement('input');
    var iSec2        = document.createElement('input');
    var iMin1        = document.createElement('input');
    var iSec1        = document.createElement('input');
    iMin2.id         = elemId+'iMin2Input';
    iMin2.type       = 'number';
    iMin2.name       = 'min2';
    iMin2.value      = tmp[0];
    iMin2.min        = 0;
    iMin2.max        = 59;
    iMin2.step       = 1;
    iMin2.className  = "twodigits tabable";
    iMin2.onchange   = changeAction;
    iSec2.id         = elemId+'iSec2Input';
    iSec2.type       = 'number';
    iSec2.name       = 'sec2';
    iSec2.value      = tmp[1];
    iSec2.min        = 0;
    iSec2.max        = 59;
    iSec2.step       = 1;
    iSec2.className  = "twodigits tabable";
    iSec2.onchange   = changeAction;
    iMin1.id         = elemId+'iMin1Input';
    iMin1.type       = 'number';
    iMin1.name       = 'min1';
    iMin1.value      = tmp[2];
    iMin1.min        = 0;
    iMin1.max        = 59;
    iMin1.step       = 1;
    iMin1.className  = "twodigits tabable";
    iMin1.onchange   = changeAction;
    iSec1.id         = elemId+'iSec1Input';
    iSec1.type       = 'number';
    iSec1.name       = 'sec1';
    iSec1.value      = tmp[3];
    iSec1.min        = 0;
    iSec1.max        = 59;
    iSec1.step       = 1;
    iSec1.className  = "twodigits tabable";
    iSec1.onchange   = changeAction;
    elem.appendChild(document.createTextNode('Start : '));
    elem.appendChild(iMin1);
    elem.appendChild(document.createTextNode('m'));
    elem.appendChild(iSec1);
    elem.appendChild(document.createTextNode('s'));
    elem.appendChild(document.createElement('br'));
    elem.appendChild(document.createTextNode('Stop : '));
    elem.appendChild(iMin2);
    elem.appendChild(document.createTextNode('m'));
    elem.appendChild(iSec2);
    elem.appendChild(document.createTextNode('s'));
    return elem;
  },
  function (valueOrElem) {
    if(valueOrElem.nodeType === Node.ELEMENT_NODE && valueOrElem.tagName == 'FORM') {
      return  valueOrElem.elements['min2'].value+':'+valueOrElem.elements['sec2'].value+'.'+valueOrElem.elements['min1'].value+':'+valueOrElem.elements['sec1'].value;
    }
    else if(valueOrElem == parseInt(valueOrElem) || valueOrElem == parseFloat(valueOrElem)) {
      var min = Math.floor(valueOrElem/60);
      var sec = Math.floor(valueOrElem%60);
      return min+':'+sec+'.0:0';
    }
    else {
      return false;
    }
  },
  function (formatedValue) {
    var tmp = formatedValue.split(/[.:]/);
    return parseFloat(tmp[0])*60+parseFloat(tmp[1]) - parseFloat(tmp[2])*60-parseFloat(tmp[3]);
  }
);


// Windows/Linux
shortcut.add('ctrl+s', eventRanking.storage.saveEvent);
shortcut.add('ctrl+z', eventRanking.storage.undo);
shortcut.add('ctrl+o', function() {dialogBoxes.open("openFileForm", eventRanking.storage.openForm())});

// MacOSX
shortcut.add('meta+s', eventRanking.storage.saveEvent);
shortcut.add('meta+z', eventRanking.storage.undo);
shortcut.add('meta+o', function() {dialogBoxes.open("openFileForm", eventRanking.storage.openForm())});



      eventRanking.graphics.displayOnly = true;
      eventRanking.graphics.fastDisplay = true;
      eventRanking.storage.restore();
    </script>
  </body>
</html>
